    可编程控制器 Nano2ET TUU-6949使用说明书                   i 
  TOYOPUC-Nano 2ET TUU-6949使用说明书     1. 系统构成1  2. 设置与布线2  3. 以太网3  4. FL-net4  5. FL远程5  6. EtherNet/IP6  7. EtherCAT7  资料资                        
目录前言安全使用注意事项使用说明书修改记录相关使用说明书的结构目录1 系统构成 .............................................................................................................................................................. 1-11.1 概要 .......................................................................................................................................................... 1-11.2 各功能的特长............................................................................................................................................ 1-11.2.1 以太网功能的特长 ............................................................................................................................... 1-11.2.2 FL-net 功能的特长 .............................................................................................................................. 1-21.2.3 FL 远程功能的特长 ............................................................................................................................. 1-31.2.4 EtherNet/IP 功能的特长 ...................................................................................................................... 1-41.2.5 EtherCAT 功能的特长 ......................................................................................................................... 1-51.3 网络构成 ................................................................................................................................................... 1-61.4 系统构成 ................................................................................................................................................... 1-91.5 各部分的名称和功能 ............................................................................................................................... 1-101.6 规格 ........................................................................................................................................................ 1-121.6.1 一般规格 ........................................................................................................................................... 1-121.6.2 2ET 模块规格.................................................................................................................................... 1-131.7 使用例 .................................................................................................................................................... 1-14 2 设置与布线........................................................................................................................................................... 2-12.1 设置 .......................................................................................................................................................... 2-12.1.1 设置环境 ............................................................................................................................................. 2-12.1.2 单元的设置.......................................................................................................................................... 2-12.2 FL 遥控的布线 .......................................................................................................................................... 2-22.2.1 布线所需的外部机器 ........................................................................................................................... 2-22.2.2 与相对的节点进行 1 对 1 连接时 ......................................................................................................... 2-22.2.3 经过 HUB 连接的时候 ......................................................................................................................... 2-32.2.4 电缆施工铺设 ...................................................................................................................................... 2-43 以太网.................................................................................................................................................................. 3-13.1 以太网的功能............................................................................................................................................ 3-13.1.1 以太网规格.......................................................................................................................................... 3-13.1.2 通过计算机链接方式进行的通信.......................................................................................................... 3-13.1.3 通过文件存储方式进行的通信 ............................................................................................................. 3-23.1.4 PING 测试功能.................................................................................................................................... 3-33.1.5 PING 测试执行方法 ............................................................................................................................ 3-33.1.6 状态监视功能 ...................................................................................................................................... 3-43.1.7 采用通用通信方式进行的通信 ............................................................................................................. 3-53.2 以太网的初始设定..................................................................................................................................... 3-63.2.1 初始设定步骤 ...................................................................................................................................... 3-63.2.2 I/O 模块的设定 .................................................................................................................................... 3-63.2.3 链接模块名称的设定 ........................................................................................................................... 3-7C-1
3.2.4 通信参数的设定................................................................................................................................... 3-73.3 以太网的连接 打开/关闭......................................................................................................................... 3-133.3.1 TCP 被动的连接打开/关闭 ................................................................................................................ 3-133.3.2 TCP 主动的连接打开/关闭 ................................................................................................................ 3-133.3.3 UDP 的连接 ...................................................................................................................................... 3-143.4 以太网 计算机链接方式..............................................................................................................................153.4.1 计算机链接方式的通信格式...................................................................................................................153.4.2 地址列表 ...............................................................................................................................................163.4.3 命令列表 ...............................................................................................................................................183.4.4 读出/写入数据量的限制 .........................................................................................................................203.4.5 以太网 命令/响应数据格式 ...................................................................................................................213.5 以太网 文件存储器方式..............................................................................................................................683.5.1 文件存储器方式的通信格式...................................................................................................................683.5.2 文件存储器发送.....................................................................................................................................693.5.3 文件存储器接收.....................................................................................................................................713.6 以太网 通用通信方式.................................................................................................................................733.6.1 通用通信方式的通信格式 ......................................................................................................................733.6.2 切换到通用通信方式的方法...................................................................................................................753.6.3 通用通信发送 ........................................................................................................................................773.6.4 通用通信接收 ........................................................................................................................................803.7 以太网的异常通告.......................................................................................................................................853.7.1 异常分类 ...............................................................................................................................................853.7.2 硬件异常 ...............................................................................................................................................873.7.3 链接参数异常 ........................................................................................................................................873.7.4 通信异常 ...............................................................................................................................................883.7.5 连接异常 ...............................................................................................................................................914 FL-net .................................................................................................................................................................. 4-14.1 FL-net 的功能 ........................................................................................................................................... 4-14.1.1 FL-net 规格 ......................................................................................................................................... 4-14.1.2 数据链接规格 ...................................................................................................................................... 4-14.1.3 数据链接方式 ...................................................................................................................................... 4-24.1.4 在通信区域中使用输入输出(X、Y)时的注意事项 ............................................................................ 4-34.1.5 信息服务器功能................................................................................................................................... 4-44.1.6 信息终端功能*1 .................................................................................................................................... 4-44.1.7 其他节点状态读出功能*1...................................................................................................................... 4-44.1.8 监控功能 ............................................................................................................................................. 4-54.1.9 通信状态确认功能 ............................................................................................................................... 4-64.1.10 网络管理信息的读出功能 .................................................................................................................... 4-74.2 FL-net 的初始设定 .................................................................................................................................... 4-94.2.1 初始设定步骤 ...................................................................................................................................... 4-94.2.2 I/O 模块的设定 .................................................................................................................................... 4-94.2.3 链接模块名称的设定 ......................................................................................................................... 4-104.2.4 链接参数详细设定 ............................................................................................................................. 4-104.2.5 网络设定 ........................................................................................................................................... 4-254.3 FL-net 的消息功能 .................................................................................................................................. 4-284.3.1 信息服务器功能................................................................................................................................. 4-284.3.2 信息终端功能 .................................................................................................................................... 4-364.3.3 其他节点状态读出功能 ...................................................................................................................... 4-45C-2
4.4 FL-net 的异常通告 .................................................................................................................................. 4-484.4.1 错误显示 ........................................................................................................................................... 4-484.4.2 CPU 模块的错误显示 ........................................................................................................................ 4-514.4.3 基于监视器功能进行的异常检出........................................................................................................ 4-565 FL 远程 ................................................................................................................................................................ 5-15.1 FL 远程的功能 .......................................................................................................................................... 5-15.1.1 FL 远程规格 ........................................................................................................................................ 5-15.1.2 网络构成 ............................................................................................................................................. 5-45.1.3 电源投入顺序 ...................................................................................................................................... 5-55.1.4 通信重置 ............................................................................................................................................. 5-65.1.5 脱离功能 ............................................................................................................................................. 5-75.2 FL 远程的初始设定 ................................................................................................................................... 5-85.2.1 参数的设定.......................................................................................................................................... 5-85.2.2 I/O 模块的设定例 ................................................................................................................................ 5-85.3 诊断信息的收集 ...................................................................................................................................... 5-135.3.1 根据链路参数收集诊断信息............................................................................................................... 5-145.3.2 通用状态 ........................................................................................................................................... 5-155.3.3 异常履历重置&任意读出开关 ............................................................................................................ 5-165.3.4 诊断信息映射图................................................................................................................................. 5-165.3.5 短路、断线信息的处理例 .................................................................................................................. 5-205.4 FL 远程的异常通告 ................................................................................................................................. 5-215.4.1 CPU 中的错误通告............................................................................................................................ 5-225.4.2 通信状态 ........................................................................................................................................... 5-295.4.3 错误内容与推定原因 ......................................................................................................................... 5-326 EtherNet/IP .......................................................................................................................................................... 6-16.1 概要 .......................................................................................................................................................... 6-16.2 EtherNet/IP 规格....................................................................................................................................... 6-26.3 I/O 通信功能 ............................................................................................................................................. 6-36.4 EtherNet/IP 的设定方法 ............................................................................................................................ 6-86.4.1 I/O 模块的设定 .................................................................................................................................... 6-86.4.2 链接参数的设定................................................................................................................................. 6-106.5 状态 ........................................................................................................................................................ 6-296.5.1 链接用特殊寄存器 ............................................................................................................................. 6-296.5.2 特殊继电器........................................................................................................................................ 6-326.6 通信重置 ................................................................................................................................................. 6-336.7 脱离功能 ................................................................................................................................................. 6-356.8 异常时输入输出的设定 ........................................................................................................................... 6-366.9 与以往通信模块的差异 ........................................................................................................................... 6-386.10 连接例 .................................................................................................................................................... 6-396.10.1 实例 ID 通信的连接例 1..................................................................................................................... 6-396.10.2 实例 ID 通信的连接例 2..................................................................................................................... 6-416.10.3 实例 ID 通信的连接例 3..................................................................................................................... 6-436.10.4 使用多个连接时的连接例 .................................................................................................................. 6-456.10.5 标签通信的连接例 1 .......................................................................................................................... 6-496.10.6 标签通信的连接例 2 .......................................................................................................................... 6-516.10.7 多点传送的连接例 1 .......................................................................................................................... 6-52C-3
6.10.8 点传送的连接例 2.............................................................................................................................. 6-556.10.9 与其他公司制扫描仪设备的连接例 .................................................................................................... 6-586.10.10 与其他公司制适配器设备的连接例....................................................................................................6-606.11 EtherNet/IP 的异常通告 .......................................................................................................................... 6-626.11.1 特殊继电器........................................................................................................................................ 6-626.11.2 特殊寄存器........................................................................................................................................ 6-636.11.3 输入输出数据交换未能正确进行时 .................................................................................................... 6-707 EtherCAT ............................................................................................................................................................. 7-1资料 1资料 2资料 3资料 4资料 5资料 6资料 7资料8 Ex编号根据 SPR、SPW 命令进行的文件存储器的读/写以太网 文件存储器地址映射表以太网 控制输出信号、控制输入信号向保持继电器的传输以太网 关于 IP 地址、网关 IP 地址、子网掩码以太网 关于连接的重新开放从 Windows 个人电脑进行 PING 测试的方法不能在 2ET 模块更换过后,立即与个人电脑进行通信时的处置方法C-4
前言首先感谢贵公司购买本公司生产的 TOYOPUC-Nano 2ET 模组产品。 为了保证您能安全操作本产品,必须通读本使用说明书以及相关的使用说明书。另外,阅读后请妥善保 管并随身携带,以便能在需要时调阅。 希望您将本使用说明书交给最终需要者。 产品规格可能会由于改良而进行更改,恕不另行通知。 按照外汇以及国际贸易管理法规定,将符合战略物资等(或者劳务)的产品出口到日本国外时,需要得 到日本政府的出口许可。 在本产品的保修期内由于本公司的责任造成的质量问题,将根据本公司的判断进行修理或者更换。除上 述责任以外,本公司对本产品造成的直接或者间接的伤害的其他责任概不负责。
 安全使用注意事项进行安装、运转、保养、检察之前必须阅读本使用说明书,并且必须正确使用。请在熟悉机器知识、 安全信息和所有注意事项之后再进行使用。本使用说明书将安全注意事项的等级分为「警告」「注意」2 种。 存在潜在危险,如果错误操作可能会造成使用者死亡或者严重伤害。           存在潜在危险,如果错误操作可能会造成使用者受伤或者物品损坏。     接通电源时请不要拆开模组或者触摸其内部。否则可能会触电。 接通电源时请不要触摸端子部。否则可能会触电。 请在设备、机械的周期停止状态下进行 PC 运转过程中的写入。(RUN 时写入) 操作错误可能导致机器损坏或者受伤。 安全相关信号和异常停止电路等,考虑到故障保险的问题,请使用外 部信号,而不要依靠本系统。 
    请在本使用说明书中记载的一般规格的环境下使用。 请不要在接通电源的状态下进行设置作业、配线作业。带有端子台的产品也请不要进行装卸。 请不要直接触摸模组内部的电子电路。否则可能会由于静电破坏模组。 请不要在模组的装卸、运输等过程中,将本模组掉落到地板等上。否 则将导致误动作。 装置出现故障时,请与本公司联系。客户请不要自行拆解模组。否则 可能导致本公司无法正确进行故障解析。 保管和运输注意事项(1) 本模组请按照使用说明书中记载的一般规格进行保管。但环境温度必须保持在−40°C~+70°C 之间。 (2) 请勿将其直接放置在导电性物体之上。(3) 电子设备容易受到结露的影响,因此,请使用干燥剂等,以避免结露。 保护结构(IP66)与水密型(完全防水)不同。请不要总是浸在水中 使用。另外,请不要进行拆解。否则保护结构将无法起到保护作用, 从而引起故障。
使用说明书修改记录 使用说明书的修改记号标记在封面记载的使用说明书号码的一部分中。使用说明书号码T-1001 * N              系列号码N: 日文, E: 英文, Ch: 中文 修改记号      修改记号    修改日期   修改内容        1      2016 年 8 月    初版印刷     2      2016 年 8 月     勘误    3    2016 年 9 月   勘误、形式修改1.6.2 “2ET 模块规格”追加    4    2016 年 10 月   “安全使用注意事项”修正 1章 勘误4章 勘误5章 插图修正资料 8 页码修正  相关使用说明书的结构      使用说明书号码          名称        概要     T-1000 TOYOPUC-Nano 说明 TOYOPUC-Nano 的基本使用方法、功能、规格。     T-326   EtherCAT 功能   就 EtherCAT 功能进行说明。     T-755   FRMT 系列使用说明书   说明 FRMT 系列的基本使用方法、功能、规格。     T-759      FE-SWH05/08 使用说明书     说明 FE-SWH05/08 的基本使用方法、功能、规格。  
1 系统构成1.1概要TOYOPUC-Nano 2ET(以下简称 2ET)配备了 2 个通信端口。各端口可通过链接参数的设定,来选择“以太网”、“FL-net”、“FL 远程”、“Ethernet/IP”、“EtherCAT”中的任意一个。选择 FL-net 的功能时,可将 TOYOPUC 的 CPU 连接到 FL-net(OPCN-2)*1 的网络上。另外,选择以太网功能时,可通过以太网,将 TOYOPUC 的 CPU 与计算机等相连接。协议与 TCP/IP*2 及 UDP/IP*2 兼容。*1 “FL-net(OPCN-2)”是 FA 用开放式网络,其规格基于(社)日本自动车工业会的倡议,是由(财) 制造科学技术中心主导、在主要控制设备生产厂家的参与下制定。不论生产厂商,凡兼容 FL-net 的设备均可进行通信。本模块的 FL-net(Ver2.00 以上)与 JEMA((财)日本电机工业会)规定的“版本 2” 兼容。*2 TCP/IP 可与对方节点建立连接,是具有较高可靠性的协议。UDP/IP 虽然吞吐量高,但由于通信线路上存在信号干扰,有时发送的数据无法到达对方,需用户 自己进行重试等处理。各功能的特长 以太网功能的特长在以太网模式中,通过“计算机连接方式”、“文件存储方式”以及“通用通信方式”与电脑或 TOYOPUC 进 行数据交换。最大 8 个端口可用。各端口进行 TCP 或 UDP 的指定。以太网规格 1.2 1.2.1    项目   规格        物理层    10BASE-T/100BASE-TX    传输速率     10 Mbps, 100 Mbps *1    最大电缆长度   Max 100 m(节点-节点之间(1 对 1 连接时)、节点-HUB 之间、 HUB-HUB 之间)    通信功能 (1) 计算机链接功能 (2) 文件存储功能 (3) 通用通信功能    可开放的端口数量     最大 8 个端口    计算机链接数据容量   最大 1 K 字节    文件存储容量    发送 2 K 字节 接收 2 K 字节  *1 指定 HUB 为自动协商模式。、自动协商模式之间相互连接时,将达到 100 Mbps。1-1 1
1.2.2FL-net功能的特长(1) 以 FL-net(OPCN-2)协议为准。另外,与 JEMA((财)日本电机工业会)规定的“版本 2”相兼容。(2) 最大可与 254 个站点进行通信。*1(3) 通过无主令牌环网方式,在该时间点上可通信的站点之间进行通信。因此,各站点可随时参与及离开通信。(4) 数据链路最大可有链接继电器 8192 位,链接寄存器 8192 字*2。(5) 数据链路除了 N:N 方式外,还可兼容 1:N 方式,既节约了链接区域,又能实现顺控程序的共通化。(6) 兼容消息服务器功能(接收由他站点发送的命令消息,并返回响应的功能),可读/写数据链路以外 区域的数据等。(7) 也可以使用消息客户端功能,通过顺控程序,对他站点发送命令消息或读取响应。*1 节点编号 250~254 被保留用于维护,因此,分配给 2ET 模块的节点编号只有 1~249。*2 1字 =2字节 =16位。  FL-net规格     项目   规格        物理层    10BASE-T/100BASE-TX     传输速率      10 Mbps, 100 Mbps    最大电缆长度 Max 100 m(节点-节点之间(1 对 1 连接时)、节点-HUB 之间、 HUB-HUB 之间)总延长距离:Max 2100 m(HUB:Max20 台)     最大节点数量      254 站点    继电器链路容量 512 字     寄存器链路容量   8192 字     消息数据容量    1024 字节 1-2
1.2.3 FL远程功能的特长FL 远程是以以太网为基础的远程 I/O 系统。 FL远程规格    项目   规格      物理层    10BASE-T/100BASE-TX    传输速率     10 Mbps, 100 Mbps    最大电缆长度 Max 100 m(节点-节点之间(1 对 1 连接时)、节点-HUB 之间、 HUB-HUB 之间)总延长距离 :Max 2100 m(HUB:Max20 台)    最大连接节点数量   64 台(主机 1 台,从机 63 台)    节点地址     从机:01~63    I/O 位数 输入:最大 2048 位, 输出:最大 2048 位    每个从机的 I/O 位数   输入:最大 64 位, 输出:最大 64 位    I/O 的分配     最小 8 位单位    通信功能   I/O 通信 消息客户端  *1 指定 HUB 和 FRMT 是自动协商模式。、自动协商模式之间相互连接时,将达到 100 Mbps。1-3
1.2.4 EtherNet/IP功能的特长  EtherNet/IP规格     项目   规格        物理层    100BASE-TX     传输速率      100 Mbps    最大电缆长度 Max 100 m(节点-节点之间(1 对 1 连接时)、节点-HUB 之间、 HUB-HUB 之间)     最大连接数量      384    会话数量(I/O 连接数量 + UCMM 使用端口数量合计)    最大 384    RPI(数据包间隔) 0.5~32.5 ms: 以 0.5 ms 单位进行设定 33~10000 ms: 以 1 ms 单位进行设定     发送触发器   Cyclic / Change of state(COS)     连接类型   Point2Point / Multicast     连接设定应用程序类型      Exclusive Owner/Input Only    通信超时时间 [ms] RPI x *( *= 4, 8, 16, 32, 64, 128, 256, 512)     设备允许带宽      3000 pps    每个连接的最大链接规模 504 字节或 1448 字节(兼容 Large Forward Open 规格)     全连接 规模   输入输出合计 24 K 字节     每个连接的输入输出区域数量      最大 8    可登录的输入输出区域数量 最大 1000     通用 TCP 端口    8 端口 1-4
1.2.5 EtherCAT功能的特长  EtherCAT规格     项目   规格        物理层    100BASE-TX     传输速率      100 Mbps    最大电缆长度 Max 100 m(节点-节点之间(1 对 1 连接时)、节点-分支之间、分 支-分支之间)     最大连接节点数量   32 台(主机 1 台,从机 31 台)     节点地址      从机:01~63    I/O 位数(整个网络) 输入:最大 4096 字节, 输出:最大 4096 字节     每个从机的 I/O 位数   输入:最大 1024 字节, 输出:最大 1024 字节     I/O 的分配      最小 8 位单位    通信功能 PDO(FreeRUN) DC 不受支持 SDO     配置内存大小   3 M 字节以下     配置工具    另售 KPA EtherCATStudio 1-5
1.3 网络构成 以太网的网络构成如下图示例。2ET 模块LAN 电缆 HUB(集线器)HUB(集线器)HUB(集线器)LAN 电缆                              LAN 电缆LAN 电缆                           构成内容     名称      说明    LAN 电缆 是连接 2ET 模块和 HUB 的电缆。 最大距离为 100 m。     HUB(集线器)      用于连接多个以太网设备时。  注:• 除 2ET 模块以外,其他由客户自己提供。• 以太网 LAN 和 FL-net 以及 FL 远程的网络必须各自分开。若不分开,LAN 的通信将无法正常进行。• 各通信设备需使用符合 IEEE802.3 标准的设备。1-6
FL-net 的网络构成如下图示例。 2ET 模块         指定 HUB(集线器)      指定 LAN 电缆指定 HUB(集线器) 指定 HUB(集线器)                       指定 LAN 电缆指定 LAN 电缆指定 LAN 电缆指定 LAN 电缆                                构成内容     名称      说明    LAN 电缆    使用 FL-net 专用的通信电缆。    HUB(集线器)    用于连接多个 FL-net 设备时。本公司指定交换式 HUB: FE-SWH05/08 (捷太格特制) 推荐中继式 HUB: FL-HUB 8TX-ZF(菲尼克斯电气制)  注:• 除 2ET 模块以外,其他由客户自己提供。• 以太网 LAN 和 FL-net 以及 FL 远程的网络必须各自分开。若不分开,LAN 的通信将无法正常进行。• 电缆请使用本公司指定的电缆。(请参照“2.2 FL-net/以太网/FL 远程的布线”)1-7
FL 远程的网络构成如下所示。 2ET 模块 交换式 HUB从机・・・                     继电器等指示灯类阀门    构成内容开关       名称         说明     节点 节点包括连接输入输出设备的子站点(从机)和将各子站点集中在一起的母站点(主机) 主机在每个网络中仅有 1 台。 主机和从机的位置没有具体规定,在上图的任何一个节点位置上,都可以配置主机或从机。 FL 远程 M 是母站点(主机)模块。     电缆   使用 FL-net 专用的通信电缆。     连接方法      电缆使用直通线。0 但是,1 对 1 连接时,使用交叉线。 连接多个从机时,请使用本公司指定的交换式 HUB。请勿使用中继式 HUB。    通信电源    向各节点提供通信用电源。 请在记载有+、-的端子台上加上 24 V 的电源。 请将 I/O 电源与通信电源分为不同的系统。  注: 电缆请使用本公司指定的电缆。(请参照“2.2 FL-net/以太网/FL 远程的布线”)HUB 请使用 FE-SWH05/08(捷太格特制)以太网 LAN 和 FL-net 以及 FL 远程的网络必须各自分开。1-8
1.4 系统构成以下表示在 TOYOPUC-Nano 系统上连接了 2ET 模块时的构成例。 基本机架   2ETNanoCPU     基础单元   WindowsXP/Vista/7安装电脑  USB 电缆          编程软件PCwin2    LAN 电缆*1 SW-HUB*2增设机架*也可安装在增设机架上。 FL 遥控系统FRMT FRMTI/O 电缆   基础单元       FRMT LAN 电缆*1 SW-HUB*2FL-net 系统本公司产品            其它局 其它局其它局 其它局        一般市销品   *1 LAN 电缆请使用指定电缆。(请参照“2.2 FL-net/以太网/FL 远程的布线”)*2 HUB 请使用 FE-SWH05/08(捷太格特制)。1-9
1.5 各部分的名称和功能                                         2ETSTATUSTUU-6949TXDRXD                      L1 STATUSLEDLMS1L1NS LM2SL2 NS1.00    L2                                    (1) 收发信号 LED (2) 状态 LED(3) 显示转换开关 (4) 通信连接器(5) 版本贴         (1) 收发信号 LED   从模块发出信号时 TD 点亮,接收信号时 RD 点亮。    (2) 状态 LED FL-net 模式时正常通信时以 2 位数的 16 进制数字表示结点编号(局号)。异常时显示错误代码。 并且,FL-net 网络只有自局,未进行通信时显示――。 以太网模式时  正常通信时如右图所示显示开着的接线。(开时点亮)发生异常时显示错误代码。 FL 遥控时接线 No.1357 2468           正常通信时以 2 位数的 16 进制数字表示主机的结点编号。异常时显示错误代码。 (3) 显示转换开关    转换状态 LED 的显示。扳向 L1 侧则在状态 LED 上显示 L1 的状态,扳向 L2 侧则在状态 LED 上显示 L2 的状态。   1-10
          (4)通信连接器MS/DEV:显示硬件的状态。 • 以太网/Fl-net/FL 远程时亮绿灯: 硬件正常 亮红灯: 发生硬件错误 熄灯: 程序未动作• EtherNet/IP 时亮绿灯: 正常工作闪绿灯: 通信设定未实施亮红灯: 不可恢复的故障(硬件异常) 闪红灯: 可恢复的轻微故障(链接参数异常) 闪红绿灯: 电源接通时的测试熄灯: 模块的电源 OFFNS/RMT:显示通信的状态。 • 使用以太网/FL-net    MSL1NSMSL2NS                    亮绿灯:闪绿灯:红绿同时亮灯:红绿同时闪灯:亮红灯:闪红灯:熄灯:正在确立 100 Mbps 通信 正在进行 100 Mbps 通信 正在确立 10 Mbps 通信 正在进行 10 Mbps 通信 链接参数异常 连接异常/链路通信异常 未链接电缆      • FL远程时亮绿灯: 正在遥控动作闪绿灯: 正在参加 FL 亮红灯: 链接参数异常 闪红灯: 通信异常 闪红绿灯: 设置异常 熄灯: 未链接电缆• EtherNet/IP 时亮绿灯: 确立最低 1 个以上的连接闪绿灯: IP 地址已设定,连接未确立 亮红灯: IP 地址重复闪红灯: 目标连接超时闪红绿灯: 电源接通时的测试熄灯: IP 地址未设定                         (5)版本贴表示 FL-net 功能、以太网功能、FL 遥控功能、EthernetIP·EtherCAT 的软件版本。      1-11
1.6 规格1.6.1 一般规格   No.         项目        规格     1 电源 PW2:额定 DC24 V(允许范围 DC24 V −15%/+20%(20.4 V~28.8 V)) 应使用符合以下基准的电源。IEC/EN 60950-1, EN 50178 (UL Class 2, SELV)    2   耗电量   PW2:30 VA 以下 (输出最大负荷 7.5 A 时) (关于各模块的消耗电流,请参照各模块的规格。)    3   周围温度   0~55°C    4   相对湿度   10~95%(但应无结露)    5     大气环境     应无腐蚀性气体    6      耐振动  频率   加速度    振幅   扫描次数    5~8.7 Hz   -      3.5 mm 10 次(1 倍频程/ 1 min)      8.7~150 Hz    9.8 m/s2       -        7      耐冲击   147m/s2,3方向 各3次                   8            抗噪性       以欧洲 EMC 指令 EN 61131-2 为准 (注 2)          项目      试验基准           试验规格    静电放电抗扰度   EN 61000-4-2    大气放电:±8 [kV] 接触放电:±4 [kV]   辐射射频电磁场抗扰度  EN 61000-4-3 80%AM(1 kHz)80 ~ 1000 [MHz] 10 [V/m] 1.4 ~ 2.0 [GHz] 3 [V/m]  EFT/B 抗扰度      EN 61000-4-4      信号线: ±1 [kV] DC 电源线: ±1 [kV]   浪涌抗扰度  EN 61000-4-5 DC 电源线: DM 0.5 [kV]/ CM 0.5 [kV] I/O 电源线: DM 0.5 [kV]/ CM 0.5 [kV] DC I/O 线: CM 1.0 [kV]通信线: CM 1.0 [kV]  射频电磁场传导抗干扰性     EN 61000-4-6   10 V0.15 ~ 80 [MHz] 80%AM(1 kHz)  工频磁场抗扰度试验      EN 61000-4-8      30 [A/m] 50 [Hz], 60 [Hz]   辐射发射的测量   CISPR 16-2-3    10 m 法30 ~ 230 [MHz] 40 dB [ìV/m] 230 ~ 1000 [MHz] 47 dB [ìV/m]      9   绝缘耐压  AC1500 V 1 分钟(AC 外部端子 – 地线之间) DC500 V 1 分钟(DC 外部端子 – 地线之间)    10   绝缘电阻   DC100 V 10 MΩ以上 (外部端子 – 地线之间)    11     瞬时停电     PW2:瞬时停电容许时间 10 ms 以下、瞬时停电间隔 1 s 以上    12 污染程度 污染程度 2 以下 符合 IEC 61131-2 (注 3)    13     过电压类别     类别 II 以下 符合 IEC 61131-2 (注 4)    14 使用标高 2000 m 以下    15     设置位置     设置在控制盘内    16   海外基准   请从本公司主页海外基准对应页面中确认最新的状况。 URL:http://www.jtekt.co.jp/products/toyopuc/csa.html  注1: 上述的一般规格为 TOYOPUC-Nano 共通规格。注2: 使装入本机的设备符合 CE 标志时,请务必设置在控制盘内。注3: 所谓污染程度,是指在设备的设置环境中,导电性污染(固体、液体、气体)的增加程度。污染 程度 2 是非导电性污染,以及由于结露而发生临时性导电的环境。1-12
注4: 所谓过电压类别,是指对设备的暂态过电压(脉冲电压)耐受性进行规定的类别。类别 II 的设备 假定由固定设备(电源插座等)供电,暂态过电压的允许值在50Vac/dc 以内时为500V,在150 Vac 以内时为 1500 V,在 300 Vac 以内时为 2500 V。1.6.2 2ET模块规格    No.   项目   规格    1     消耗电流     510 mA    2 外形尺寸(W × H × D) 27 × 121 × 100 mm(不含突起物)    3     重量     110 g  1-13
1.7 使用例说明将 L1 作为以太网、L2 作为 FL 遥控使用时的设置参数方法。1. 启动 PCwin2,从[Parameter(参数)] - [I/O Module(I/O 模块)]中选择要安装的机架编号、插槽 编号,并选择[Setup(设定)]。例如,将机架设定为 0,插槽设定为 1。2. 将[Module identification(模块类型)]设为[Special/Communication(特殊/通信)]的[2ET]后,选 择[OK]。3. “2ET”设定到机架 0、插槽 1 中。            1-14
4. 设定[Link Parameter(链接参数)]。选择在链接参数的设定中使用的链接 No.后,选择[Link setup(链接设定)]。例如,在链接 No.1 中设定为[Ethernet(以太网)],在链接 No.2 中设定为[FL Remote(FL 远程)]。 对应使用 2ET 的机架 No 和插槽 No,分别设定链接模块名称。而且,在 PCwin2 的设定中,L1 为[Port A(端口 A)],L2 为[Port B(端口 B)]。5. 链接参数设定完成。关于详细设定以太网时,请参照“3.2.2 I/O 模块的设定” FL-net 时,请参照“4.2.2 I/O 模块的设定” FL 远程时,请参照“5.2.1 参数的设定”。             1-15
关于未使用链接时的处理关于不使用的端口,请将链接模块的设定设为“Ethernet (32Port)(以太网(32 端口))”。 而且,不需进行链接参数的详细设定。<L2 未设定时>  1-16
2 设置与布线2.1 设置2.1.1 设置环境设置时请避免下述环境。(1) 环境温度超过 0~55°C 围的场所(2) 环境湿度超过 30~85%RH 范围的场所(3) 因急剧的温度变化而产生凝水的场所(4) 有腐蚀性气体、可燃性气体的场所(5) 尘埃、铁粉等具有导电性的粉末、油雾、盐分、有机溶剂多的场所(6) 有油、药品飞沫的场所(7) 发生强电场、强磁场的场所(8) 直接照射到阳光的场所(9) 传导直接振动和冲击的场所    使用环境如上所述时,请将其收纳于密闭的控制盘内等,保证设置环境具备良好条件。控制盘的门请不    要一直敞开着。另外,在控制盘内使用风扇等时,设置时注意不要直接吹风。被风直接吹到的部分会大量附着尘埃等, 有时会招致预料之外的事态,因此请多加注意。2.1.2 单元的设置2ET 实际安装在基础单元插槽 0~7 中使用,占用 I/O 模块的 1 块插槽。为了方便通风及更换模块,模块上部及下部要与建筑物,零件相隔 50 mm 以上。50 mm 以上50 mm 以上                        2-1 2
2.2 2.2.1FL遥控的布线 布线所需的外部机器要构成 FL-net /以太网/FL 遥控的系统需要以下外部机器。外部机器请客户准备。通信机器请使用 IEEE802.3 规格的设备。(a) 指定电缆FL-net /以太网/FL 遥控的电缆指定品如下所示。请从 ASSY 生产厂家[(株)进和、(株)KOM、日合通信电线(株)]购买电缆。 电缆为相当于 5e 类的产品。直通电缆 ASSY: FLG-S-***交叉变换电缆: FLG-X-002(0.2 m)注: 布线时请避免通信电缆动力线等高压强电电线并行接近。 (b) 指定 HUB注: HUB 请接地。详细内容请参照 HUB 的使用说明书。 与相对的节点进行 1 对 1 连接时2ET(FL-net/以太网/FL-remote)与相对的节点用交叉电缆方式进行连接。 全体长度(直线电缆+交叉变换电缆)的要求         口数 名称    型号 SW-HUB       5口   FE-SWH05     TCU-6414    8口FE-SWH08   TCU-64152.2.2 最长 100 m指定的交叉变换电缆                     2-2指定的直线电缆
2.2.3经过HUB连接的时候2ET(FL-net/以太网/FL-remote)与 HUB 之间用直线电缆方式进行连接。HUB 与 HUB 之间用直线或交叉电缆方式进行连接。2ET(FL-net/以太网/FL-remote)不可混用在此网 络当中。(使用 FL-remote 时的系统构成)最长 100 m最长 100 m DC 24 V            DC 24 V               DC 24 V (使用 FL-net/以太网时的系统构成)最长 100 mFRMT(IO 电源与通讯电源要分开使用)最长 100 m DC 24 V       最长 100 m          最长 100 m 2-3
2.2.4电缆施工铺设 进行电缆施工时请注意以下事项。1. 牵引电缆时请不要施加过大的张力。× 因过度拉抻而拉长2. 固定部分的弯曲半径请设置在电缆外径的 4 倍以上。 电缆外形的 4 倍○×3. 固定电缆之际,请不要用固定带等勒紧。 电缆被压扁×          电缆外形的 2 倍      2-4
4. 请不要使电缆拧劲。   电缆拧劲了×5. 尽可能不要处理长出的部分。 卷缠直径小及卷缠次数过多的话,有可能同色对的电缆之间会发生过程的串音,引起故障。 串音是指传送信号漏到其它传送路。××6. 拉引电缆请远离干扰发生源。请尽可能地使通信电缆和 HUB(中枢)远离焊接设备或发动机的动力线、大电流的电源电缆等干扰源。通信电缆7. 请用金属管道等进行屏蔽。不能采用 6 的方法进行对应时,请用金属管道等屏蔽通信电缆、HUB(中枢)。        干扰发生源  干扰 发生源               HUB通信电缆HUB 收藏箱(金属制) 管道(金属制)           2-5
3 以太网 本章中,将就以太网的功能进行说明。3.1 3.1.1以太网的功能 以太网规格    No.   项目   规格    1     物理层     10BASE-T/100BASE-TX    2   传输速率   10 Mbps, 100 Mbps *1    3   最大电缆长度   Max 100 m(节点-节点之间(1 对 1 连接时)、节点-HUB 之间、 HUB-HUB 之间)    4 通信功能 (1) 计算机链接功能 (2) 文件存储功能 (3) 通用通信功能    5   可开放的端口数量   最大 8 个端口    6     计算机链接数据容量     最大 1 K 字节    7    文件存储容量   发送 2 K 字节 接收 2 K 字节   3.1.2*1 指定 HUB 为自动协商模式。、自动协商模式之间相互连接时,将达到 100 Mbps。 通过计算机链接方式进行的通信通过从其他节点发送命令来进行 CPU 模块内数据的读/写等。命令的解析、与 CPU 模块的数据交换由 2ET 模 块进行,因此,不需数据交换用的顺控程序。其他节点以个人电脑等的主机为对象,不可在 TOYOPUC 之间进行接收和发送。详细内容请参照“3.4 以太网 计算机链接方式”。TOYOPUC 之间的接收和发送请使用文件存储方式。CPU 模块2ET 模块 (以太网功能)            命令命令其他节点            响应解析响应                  3-1 3
3.1.3 通过文件存储方式进行的通信通过顺控程序的应用命令 SPR(文件存储读出)、SPW(文件存储写入),进行 2ET 模块内文件存储的读/ 写,通过这种方法进行接收和发送。其他节点不仅和个人电脑等的主机,还可在 TOYOPUC 的业务模块之间进行通信。 详细内容请参照“3.5 以太网 文件存储方式”。      CPU 模块2ET 模块 (以太网功能)其他节点个人电脑 2ET(以太网) PC10G 内置以太网等        SPW SPR              发送 SPW        文件存储     接收发送       连接 1 数据发送区域            响应           SPR连接 1  发送                     响应          3-2
3.1.4PING测试功能PING 测试是确认与通信对象的通信线路有无连接,通信能否正常进行的测试。 PING 测试不能通过时,可考虑以下原因。• 电缆未连接,或接触不良。• 2ET 模块与对方节点之间的通信设备电源未接入。• 2ET 模块与对方节点之间的通信设备(收发器等)发生故障。• 对方节点未启动。• 自身节点或对方节点的 IP 地址重复。• 自身节点和对方节点 IP 地址的网络 ID 不同(参照资料 4)PING测试执行方法进行 PING 测试时,要在根据 2ET 模块分配的链接 No.确定的以下地址中,通过周边装置等,以 16 进位来设置对方节点的 IP 地址。3.1.5    链接 No.   对方节点 IP 地址写入地地址    1     S31C~S31D    2   S33C~S33D    3 S35C~S35D    4     S37C~S37D    5 S39C~S39D    6   S3BC~S3BD    7     S3DC~S3DD    8 S3FC~S3FD 例如,2ET 模块的链接 No.为 1,对方节点的 IP 地址为 172.16.93.133 时,就在 S31C 中设置“5D85”,在 S31D 中设置“AC10”。PING 测试结束后,请将这些值恢复为 0000。PING 测试每 2 秒重复进行一次,并把结果设置到文件存储地址 106 的第 3 位及第 4 位中(参照资料 2)。如 果第 3 位为 ON,则“PING 测试 OK”,如果第 4 位为 ON,则“PING 测试 NG”。PING 测试的结果也可通过对 状态监视区域进行监视的方法来确认(参照 3.1.6 章)。要从文件存储器中读取数据,就需要安装使用 SPR 命令的顺控程序(参照资料 1 及资料 2)。3-3
3.1.6状态监视功能可通过对 CPU 模块的特殊寄存器、S300 号台进行监视的方法来监视模块的状态。应监视的地址,根据链接 No.确定如下。    链接 No.   模块状态监视器地址    1   S300~S30F    2     S320~S32F    3   S340~S34F    4 S360~S36F    5     S380~S38F    6 S3A0~S3AF    7   S3C0~S3CF    8   S3E0~S3EF 可通过用周边装置来监视该区域的方法,如下图那样来查看文件存储器控制标志的状态,以及连接异常代码等。MSB LSB FEDCBA9876543210     CN8           主动开放请求       CN1       0      0        0       0       0       0    0         *1         CN8 文件存储器接收请求      CN1   CN8 文件存储器发送请求     CN1         0        0       0       0       0       0        0         0       0      0     0      0     0      0  *3           *2 CN8 开放正常 CN1        0      0      0      0      0     0   *5      *4      CN8 文件存储器发送完成 CN1 CN8 连接异常 CN1        0        0     0           0     *9      *8      *7    *6    CN8  文件存储器接收完成       CN1     自身的以太网地址第 4 位 *10 自身的以太网地址第 5 位 *10    自身的以太网地址第 6 位 *10       CN8 通用通信方式启用/禁用 CN1      连接 1:连接异常代码     连接 2:连接异常代码     连接 3:连接异常代码     连接 4:连接异常代码     连接 5:连接异常代码     连接 6:连接异常代码     连接 7:连接异常代码     连接 8:连接异常代码 S3#0 S3#1 S3#2 S3#3 S3#4 S3#5 S3#6 S3#7 S3#8 S3#9 S3#A S3#B S3#C S3#D S3#E S3#F*1 初始化请求*2 错误日志接收确认*3 ICMP 日志接收确认*4 初始化正常*5 初始化异常*6 错误日志接收*7 ICMP 日志接收*8 PING 正常*9 PING 异常*10 以太网地址的前 3 位数为 00.60.53(固定值)。3-4
3.1.7 采用通用通信方式进行的通信通过顺控程序的应用命令 SPR(文件存储读出)、SPW(文件存储写入),进行 2ET 模块内文件存储的读/ 写,通过这种方法进行接收和发送。通用通信功能与文件存储通信有所不同,因为 TCP/UDP 数据部分是自由格式,所以可与固定通信格式的以太 网设备进行连接。但是,传输控制步骤为无步骤,对错误的检查等要由用户自己进行。 详细内容请参照“3.6 以太网 通用通信方式”。       CPU 模块2ET 模块 (以太网功能)其他节点个人电脑TOYOPUC其他公司的以太网设备       SPW SPR              SPW发送         文件存储 接收发送           连接 1 数据发送区域                        SPR连接 1 数据接收区域 接收                         3-5
3.2 3.2.1以太网的初始设定 初始设定步骤开始I/O 模块的设定     请参照“3.2.2 I/O 模块的设定”请参照“3.2.3 链接模块名称的设定”请参照“3.2.4 通信参数的设定”   链接模块名称的设定     通过链接参数详细设定,或顺控程序进行的通信参数的设定  3.2.2电源的通断或复位/启动 I/O模块的设定用周边装置的[Parameter(参数)]→[I/O Module(I/O 模块)]来设定“2ET”。 3-6
3.2.3链接模块名称的设定用周边装置的[Parameter(参数)] → [Link Parameter(链接参数)]的链接设定来选择对 2ET 模块进行分配的机架 No.、插槽 No.,并在“Ethernet (32Port)(以太网(32 端口))”中设定链接模块名称。通信参数的设定 通信参数的种类通信参数有以下几种。(1) 自身节点 IP 地址是分配到 2ET 模块中的 IP 地址,设定 4 个 0~255 的数字。但是,不可使用 0.0.0.0 以及 255.255.255.255。 另外,线路上存在多个设定了相同 IP 地址的节点时,通信将无法正常进行。IP 地址分为网络 ID 和主机 ID,网络 ID 必须与通信对象的 IP 地址相同。详细内容请参照卷尾的资料 4。(2) 连接 1~322ET 中备有 1~32 的 32 个连接,在此设定究竟使用哪个连接。可在每个设定标志中,按 1~8、9~16、17~24、25~32 那样来设定连接。 设定为“使用”的连接中,如果不能正确设定协议、开放方式及端口 No.、其他节点表 No.,就会发生错误。(3) 协议、开放方式设定是否用 TCP/IP 或 UDP/IP 中的某个协议来进行通信,以及使用 TCP/IP 时,如何进行连接的打开/关闭等。TCP/IP 在开始通信前打开线路的连接,并在通信结束时进行连接的关闭或复位处理。UDP/IP 不用执行该 手续即可开始/结束通信。另外,TCP/IP 可通过 ACK(应答)响应来确认通信数据有无送达对方,未能确 认时,要进行数据的重发。UDP/IP 中不进行这种传输确认,因此,发送的数据有时会由于线路上的数据 冲突等而消失,并未送达对方。(i) TCP 主动为 TCP/IP 协议,是从 2ET 模块向对方节点打开线路的模式。(ii) TCP 对方特定被动为 TCP/IP 协议,是从其他节点表上指定的特定对方节点来打开线路的模式。 如有与指定不同的 IP地址或端口 No.请求打开线路,则不会打开。 3.2.4 3.2.4.13-7
(iii) TCP 对方不特定被动为 TCP/IP 协议,是从对方节点打开线路的模式。对方节点的 IP 地址及端口 No.不特定。 是与计算     机进行通信时,通常使用的模式。(iv) UDP通过 UDP/IP 协议进行通信。 不进行线路的打开/关闭处理。另外,由于不确认数据送达与否,因此,     发送的数据有时会未送达对方。(4) 自身节点端口 No.设定各连接的端口 No.。端口 No.需在 1025~65534(16 进制时为 0401~FFFE)的范围内。 自身节点端口 No.在设定时,请注意避免与其他连接的自身节点端口 No.重复。(5) 其他节点表 No.选择“TCP 主动”或“TCP 对方特定被动”或“UDP”后,需指定对方节点的 IP 地址和端口 No.。对方节点的 IP地址和端口 No.设定在 1~32 中的其他节点表上,使用其他节点表 No.来指定某一个其他节点表,(6) 使用其他节点表 1~32作为通信对象的其他节点的 IP 地址和端口 No.最大可设定 32 节点。对其他节点 IP 地址和其他节点端口 No.进行设定的其他节点表,请设定为“使用”。(7) 其他节点 IP 地址为其他节点的 IP 地址。设定 4 个 0~255 的数字。需仅就设为“使用”的其他节点表进行设定。(8) 其他节点端口 No.指定其他节点的端口 No.。端口 No.需在 1025~65534(16 进制时为 0401h~FFFEh)的范围内。 需仅就设为“使用”的其他节点表进行设定。(9) 子网掩码、网关 IP 地址自身节点 IP 地址和通信对象的 IP 地址的网络 ID 不同时,需进行子网掩码、网关 IP 地址的设定。详细内容请参照卷尾的资料 4。(10) 等待重置重传次数在 2ET 中不使用。请保持初始值不变。 以下是通信中使用的计时器的设定。这些设定为通常设定,不必进行变更。3-8
(11) 无接收计时器设为 TCP 的连接,在用“无接收计时器”设定的秒数或分钟数内,如果没有来自对方节点的数据发送,就会 从 2ET 模块对连接进行重置。设定为“不设定”时,不会从 2ET 模块进行连接的重置,而会一直等待来自 对方节点的数据。(可设定范围:1 秒~255 分钟,默认值:一直等待)(12) 响应计时器集中设定以下的计时器。• 主动打开命令响应等待计时器• 接收数据被分割时的后续数据接收计时器(TCP、UDP) • 对于文件存储传输的响应监视计时器(可设定范围:1~255 秒,默认值:6 秒)(13) 重传计时器(数据)在 2ET 中不使用。(14) 重传计时器(SYN/FIN)在 2ET 中不使用。(15) 关闭计时器在 2ET 中不使用。(16) 数据包生存时间在 2ET 中不使用。(17) IP 组合计时器在 2ET 中不使用。3-9
3.2.4.2通信参数的设定方法 在链接参数中设定参数。通过链接参数进行设定的方法在“Link parameter setup(链接参数的设定)”画面中选择“Ethernet(以太网)”,点击“Detail (D)(详细设定)” 按钮,显示出通信参数设定画面。在该画面中, 设定• 自身节点 IP 地址、 • 使用连接 1~8、 • 协议、打开方式、 • 自身节点端口 No.、 • 其他节点表 No.。然后根据需要,通过左下的按钮来设定其他节点表、各种计时器、子网掩码、网关 IP 地址。  3-10
点击[Other Node Table(其他节点表的设定)]按钮后,就会显示其他节点表设定画面。  点击[Timers(各种计时器的设定)]按钮后,就会显示各种计时器设定画面。在该画面中,对• 是否使用表 1~16、 • 其他节点 IP 地址、 • 其他节点端口 No. 进行设定。 3-11
点击[Sub-net Mask and Gateway IP Address(子网掩码、网关 IP 地址)]按钮后,就会显示子网掩码及网关 IP 地址的设定画面。初始值全部为 0。要进行变更时,请点击[Change(变更)]按钮。点击[Default(初始值)]后,就会返回初始状态。 3-12
3.3以太网的连接 打开/关闭在 TCP 协议下开始通信之前,需进行打开连接的处理。打开方式有根据来自对方节点的打开请求来打开连接 的“被动打开”,和从自己向对方提出打开请求的“主动打开”两种方式。而在“被动打开”中,也有仅由特定的对方 提出打开请求时才打开连接的“对方特定被动打开”,和不特定对方的“对方不特定被动打开”两种方式。通信结束时,从打开连接一侧将连接关闭。UDP 没有连接的打开/关闭处理,始终可进行命令、响应的数据发送、接收等。协议及打开方式在每个连接中 通过链接参数或初始序列进行设定。而且,CPU 模块重置后,各 TCP 连接就会被重置。但是,CPU 模块通过经由 2ET 模块的命令进行重置时, 各连接将不会被重置,可继续进行通信。TCP被动的连接打开/关闭在通信参数中设为“TCP 被动”的连接,在完成初始化的同时,将处于等待来自对方节点打开请求的状态。在此状态下从对方节点接收到打开请求时,连接将打开,并在文件存储器(参照资料 2)的“打开正常”为 ON 的同时,模块前面相关的 LED 将点亮。连接的打开状态也可以通过状态监视器(参照 3.1.6 章)进行监视。从资料 3 顺控程序的例子中可以看出,文件存储器的控制输入信号被分配到 K30~K68 中时,可通过 K38(连 接 1)~K3F(连接 8)的接点是否为 ON 来确认连接有无打开。文件存储 打开正常标志(1) (2)(1) 从其他节点接收到打开请求时,打开连接,并使打开正常标志为 ON(2) 从其他节点接收到关闭请求时,关闭连接,并使打开正常标志为 OFFTCP主动的连接打开/关闭初始化完成后,通过使文件存储器(参照资料 2)的“主动打开请求标志”为 ON,对用通信参数的“其他节点表 No.”指定的其他节点发送打开请求。文件存储器中的数据写入通过 SPW 命令进行。从资料 3 顺控程序的例子中可以看出,文件存储器的控制输入信号被分配到 K30~K68 中时,可通过 K08(连 接 1)~K0F(连接 8)的接点为 ON,使打开请求标志为 ON。如果连接能够正常打开,则在文件存储器“打开正常”的相关连接标志为 ON 的同时,模块前面相关的 LED 将点 亮。3.3.1    3.3.23-13
连接的打开状态也可以通过状态监视器(参照 3.1.6 章)进行监视。 因线路上不存在对方节点等原因,连接未能打开时,将出现连接异常代码为 4001 的错误。  文件存储 打开请求标志文件存储 打开正常标志          3.3.3(1) 通过顺控程序,使文件存储器的打开请求标志为 ON。(2) 2ET 模块将打开与其他节点的连接,如能正常打开,则使打开正常信号为 ON。(3) 关闭连接时,通过顺控程序使文件存储器的打开请求标志为 OFF。(4) 2ET 模块将关闭与其他节点的连接,并使打开正常信号为 OFF。UDP的连接由于在 UDP 的连接时,不进行连接的打开/关闭,所以在初始化完成后,文件存储器“打开正常”的相关连接标志将直接为 ON,同时,模块前面的相关 LED 将点亮,成为可进行通信的状态。UDP 时,即使与对方节点的通信线路未能正常连接,“打开正常”也会为 ON,因此,需多加注意。(1) (2)(3) (4)3-14
3.4以太网 计算机链接方式是通过从个人电脑、工作站等发送计算机链接命令,并由 2ET 模块返回对此的响应,来进行通信的方式。计算机链接命令的解析、CPU 模块 I/O 的读出及写入等由 2ET 模块进行,因此,不需要进行计算机链接命令 处理所需的顺控程序。CPU 模块(2)命令(3)响应计算机链接方式的通信格式2ET 模块其他节点    (1)命令 (4)响应          3.4.13.4.1.1以太网报头、IP 报头、TCP/UDP 报头、以太网 FCS 通常由通信软件等自动附加。 TOYOPUC数据部分的详细内容  以太网报头      IP 报头   TCP/UDP 报头   TOYOPUC 数据      以太网 FCS    • 命令• 响应FT------- 帧的类型 RC ------ 响应代码传输数量传输数量                   00 (FT)0 0L LL HC M D命令数据                                  80 (FT)R CL LL HC M D响应数据  (00 为正常,返回 00 以外的响应代码时,请参照“3.7.5.2 错误响应数据 错误代码表”。) LL-------传输数量 下位LH------- 传输数量 上位 CMD---- 命令代码3-15解析
3.4.2 地址列表 在计算机链接命令数据内使用的地址请根据字单位、字节单位、位数单位的各命令(命令:94~99,1C~27,32),使用下表中的地址。     识别码 名称 地址        字地址    字节地址    位数地址      PRG.编号*1               位数区域K 保持继电器V 特殊继电器T/C 计时器/计数器 L 链接继电器X/Y 输入输出继电器 M 内部继电器K000-2FFV000-0FFT,C0000-1FFL000-7FFX,Y000-7FFM000-7FF                   0020-004F 0040-009F  0200-04FF         PRG.1→01 PRG.2→02 PRG.3→03               0050-005F  00A0-00BF     0500-05FF   0060-007F    00C0-00FF      0600-07FF    0080-00FF 0100-01FF  0800-0FFF   0100-017F  0200-02FF     1000-17FF   0180-01FF    0300-03FF      1800-1FFF               字区域S 特殊寄存器 N 计时器/计数器当前值 R 链接寄存器D 数据寄存器B 文件寄存器S0000-03FFN0000-01FFR0000-07FFD0000-2FFFB0000-1FFF                        0200-05FF   0400-0BFF   -    0600-07FF 0C00-0FFF  -   0800-0FFF    1000-1FFF      -    1000-3FFF 2000-7FFF  -   6000-7FFF    C000-FFFF      -                扩展位数 区域 1EK 扩展保持继电器 EV 扩展特殊继电器 ET/EC 扩展计时器/计数器 EL 扩展链接继电器 EX/EY 扩展输入输出EM 扩展内部继电器EK000-FFFEV000-FFFET,EC000-7FFEL000-1FFFEX,EY000-7FFEM000-1FFF                   0100-01FF   0200-03FF   1000-1FFF              00         0200-02FF 0400-05FF  2000-2FFF   0300-037F  0600-06FF     3000-37FF   0380-057F    0700-0AFF      3800-57FF    0580-05FF 0B00-0BFF  5800-5FFF   0600-07FF  0C00-0FFF     6000-7FFF            扩展字区域 1ES 扩展特殊寄存器 EN 扩展当前值寄存器 H 扩展设定值寄存器 U 扩展数据寄存器ES000-07FFEN0000-07FFH0000-07FFU0000-7FFF               0800-0FFF    1000-1FFF      -    1000-17FF 2000-2FFF  -   1800-1FFF    3000-3FFF      -   0000-7FFF   0000-FFFF  -      08        扩展位数 区域 2GX/GY 扩展输入输出 GX,GY0000-FFFFGM 扩展内部继电器 GM0000-FFFF            0000-0FFF 0000-1FFF   07     1000-1FFF  2000-3FFF         扩展字区域 2 EB 扩展文件寄存器EB00000-07FFFEB08000-0FFFFEB10000-17FFFEB18000-1FFFF                   0000-7FFF    0000-FFFF          09   0000-7FFF 0000-FFFF   0A   0000-7FFF    0000-FFFF          0B   0000-7FFF   0000-FFFF  -    0C     *1 以 PC3J 用扩展命令来使用例如,以 I/O 寄存器字读出或写入命令来访问 D0100 寄存器时,请将地址指定为“1000H(D0000 寄存器的字 地址)+100H=1100H(地址下位:00H,地址上位:11H)”。另外,在同一个 D0100 寄存器中进行 I/O 寄存 器字节读出或写入时的地址为“2000H(D0000 寄存器的字节地址)+200H(100H×2)=2200H(地址下位: 00H,地址上位:22H)”。(D 寄存器为 16 位的字单位,所以需要×2)   3-16
    在计算机链接的命令数据内使用的地址,请根据字单位、字节单位、位数单位的各命令来使用。(长型单位与 字单位为同一指定。)位数单位 例)P1-M10001) 参考)从地址表中取得位数地址。(将 0x61800 存储于 0 位~18 位中)2) 参考)从地址表中取得 Ex No.(*)。(将 0x0D 存储于 19 位~26 位中)3) 由 32 位数据中计算出位数地址(0x006E1800)313029282726252423222120191817161514131211109 8 7 6 5 4 3 2 1 0字节单位 例)P2-D2000L1) 参考)从地址表中取得字节地址。(将 0x6000 存储于 0 位~15 位中)2) 参考)从地址表中取得 Ex No.(*)。(将 0x0E 存储于 16 位~23 位中)3) 由 32 位数据中计算出字节地址(0x000E6000)31* 关于 Ex.No,请参照资料 8 Ex 编号。                                 0 固定  Ex No.(0x0D)  位数地址(0x61800)  0  0  0  0  0  0  0  0  0  1  1  0  1  1  1  0  0  0  0  1  1  0  0  0  0  0  0  0  0  0  0  0  0  0  6  E  1  8  0  0  上位 WORD 地址上位  上位 WORD 地址下位   下位 WORD 地址上位   下位 WORD 地址下位       302928272625242322212019181716151413121110 9 8 7 6 5 4 3 2 1 0                                 0 固定  Ex No.(0x0E)  字节地址(0x6000)  0  0  0  0  0  0  0  0  0  0  0  0  1  1  1  0  0  1  1  0  0  0  0 0  0  0  0  0  0  0 0  0  0  0  0 E  6  0  0  0  上位 WORD 地址上位   上位 WORD 地址下位  下位 WORD 地址上位   下位 WORD 地址下位      3-17
3.4.3 命令列表发出 No.1~31 的命令时, 2ET 模块将对所分配的程序 No.的程序及 I/O 寄存器进行处理。扩展区域数据的读写,以及读写其他程序 No.的程序、参数时,使用 No.32~42 的扩展命令。    No. 功能  命令代码(16 进制)     子命令    1 I/O 寄存器 字读出  1C     无    2   I/O 寄存器 字写入   1D      无     3I/O 寄存器 字节读出 1E  无    4 I/O 寄存器 字节写入  1F     无    5   I/O 寄存器 位数读出   20      无     6  I/O 寄存器 位数写入  21   无     7I/O 寄存器 多点字读出 22  无    8 I/O 寄存器 多点字写入  23     无    9   I/O 寄存器 多点字节读出   24      无     10I/O 寄存器 多点字节写入 25  无    11 I/O 寄存器 多点位数读出  26     无    12   I/O 寄存器 多点位数写入   27      无     13  复位  32   00.00     14恢复扫描 32  01.00    15 扫描停止、停止解除  32     02.00    16   疑似扫描停止、解除   32      03.00     17CPU 状态读出 32  11.00    18 执行权限定状态读出  32     21.00    19 执行权限定设定   32     22.00  功能 调用3-18
   No. 功能  命令代码(16 进制)     子命令   20 填充    32      32.00    21 计时器、计数器设定值、当前值读出 32  40.00   22 计时器、计数器设定值、当前值写入  32     41.00   23 计时器、计数器设定值写入    32      42.00    24 计时器、计数器当前值写入   32   43.00    25 时钟时刻读出 32  70.00   26 时钟时刻设定  32     71.00   27 中继命令    60      无    28 程序扩展字读出 90  无   29 程序扩展字写入  91     无   30 参数扩展读出  92     无   31 参数扩展写入    93      无    32 数据扩展字读出 94  无   33 数据扩展字写入  95     无   34 数据扩展字节读出    96      无    35 数据扩展字节写入 97  无   36 数据扩展多点读出  98     无   37 数据扩展多点写入  99     无   38 扩展功能调用    A0      *1    39 PC10 数据字节读出 C2  无   40 PC10 数据字节写入  C3     无   41 PC10 多点读出    C4      无    42 PC10 多点写入 C5  无   43 CPU 状态读出  A0     *1   44 PC10FR 寄存器登录   C6     无   功能 调用*1 与功能调用(命令代码 32)的子命令相同3-19
3.4.4 读出/写入数据量的限制 根据命令进行的读出/写入的数据量有一定的限制。 请在下表的范围内使用。           CPU 模块     NanoCPU       中继命令 512 字节或 256 字     中继命令以外      各命令的最大数据量  3-20
3.4.5以太网 命令/响应数据格式    1. I/O 寄存器字读出(CMD=1CH)  (1) 功能 用字单位数据块来读出数据存储器。(2) 消息格式• 命令• 响应(例)传输数量                                          0 00 0L LL HC M D                   传输数量                                                        8 0R CL LL HC M D     n ≤ 200H                            读出数据寄存器 D0100~D0102 时的命令 00. 00. 05. 00. 1C. 00. 11. 03. 00      命令代码数据 1D0100 的字地址 D0100=0100, D0101=0302, D0102=0504 时的响应 80. 00. 07. 00. 1C. 00. 01. 02. 03. 04. 05D0100 D0101 D0102   3-21数据 1数据 2字数量 下位 字数量 上位数据 n地址下位地址上位
    2. I/O 寄存器字写入(CMD=1DH)  (1) 功能 用字单位数据块来写入数据存储器。(2) 消息格式• 命令传输数量                                                             0 00 0L LL HC M D                                 n ≤ 200H  • 响应(例)在数据寄存器 D0100~D0102 中写入 0001,0203,0405 的数据时的命令 00. 00. 09. 00. 1D. 00. 11. 01. 00. 03. 02. 05. 04      8 0       R C      L L      L H     C M D          80. 00. 01. 00. 1D命令代码数据1 数据2 数据3 D0100 的字地址 响应3-22地址下位 地址上位数据 1数据 2数据 n
    3. I/O 寄存器字节读出(CMD=1EH)  (1) 功能 用字节单位数据块来读出数据存储器。(2) 消息格式• 命令• 响应(例)传输数量                                          0 00 0L LL HC M D                   传输数量                                                     8 0R CL LL HC M D                          读出数据寄存器 D0100L~D0102L 时的命令 00. 00. 05. 00. 1E. 00. 22. 05. 005 字节D0100 的字节地址3-23n ≤ 400H       D0100L=01, D0100H=02, D0101L=03, D0101H=04, D0102L=05 时的响应 80. 00. 06. 00. 1E. 01. 02. 03. 04. 05数据1 地址下位数据2 地址上位数据 3 数据 4字数量 下位 字数量 上位数据 n
    4. I/O 寄存器字节写入(CMD=1FH)  (1) 功能 用字节单位数据块来写入数据存储器。(2) 消息格式• 命令 传输数量• 响应(例)n ≤ 400H                                                             0 00 0L LL HC M D                        8 0       R C      L L      L H     C M D  在数据寄存器 D0100L~ D0102L 中写入 01, 02, 03, 04, 05 的数据时的命令 00. 00. 08. 00. 1F. 00. 22. 01. 02. 03. 04. 05响应80. 00. 01. 00. 1F3-24地址下位 地址上位 数据 1 数据 2 数据 3 数据 4数据 n
    5. I/O 寄存器位数读出(CMD=20H)  (1) 功能用位数区域来读出 1 位的数据存储器。外部 I/O 将读出图像存储器中的数据。(2) 消息格式• 命令• 响应传输数量传输数量                                  0 00 0L LL HC M D                                             8 0R CL LL HC M D       (例)读出内部继电器 M0201 状态时的命令 00. 00. 03. 00. 20. 01. 1A命令代码 M0201 的位数地址M0201 为 ON 时的响应 80. 00. 02. 00. 20. 011: ON, 0: OFF  3-25数据 地址下位 地址上位
    6. I/O 寄存器位数写入(CMD=21H)  (1) 功能用位数区域来写入 1 位的数据存储器。外部 I/O 进行图像及输出卡的写入。(2) 消息格式• 命令• 响应(例)传输数量                                     0 00 0L LL HC M D                  响应80. 00. 01. 00. 213-261: ON, 0: OFF      8 0     R C     L L     L H    C M D 使内部继电器 M0201 为 ON 时的命令 00. 00. 04. 00. 21. 01. 1A. 01      ON 信号 M0201 的位数地址命令代码    地址下位 地址上位 数据
    7. I/O 寄存器多点字读出(CMD=22H)  (1) 功能 用字单位来多点读出数据存储器。(2) 消息格式• 命令• 响应(例)传输数量传输数量                                                                    0 00 0L LL HC M D                                                                                                8 0R CL LL HC M D                        n ≤ 80H  读出数据寄存器 D0100, D0200, D0210 的数据时的命令 00. 00. 07. 00. 22. 00. 11. 00. 12. 10. 12各数据的字存取地址 D0100=1234, D0200=5678, D210=9ABC 时的响应80. 00. 07. 00. 22. 34. 12. 78. 56. BC. 9A   3-27数据 1地址下位地址上位地址下位地址上位地址下位地址上位数据 2数据 3数据 n地址下位 地址上位
    8. I/O 寄存器多点字写入(CMD=23H)  (1) 功能 用字单位来多点写入数据存储器。(2) 消息格式• 命令 传输数量• 响应(例)n ≤ 80H                                                                                              0 00 0L LL HC M D                                                              8 0       R C      L L      L H     C M D  在数据寄存器 D0100 中写入 1234,D0200 中写入 5678,D0210 中写入 9ABC 时的命令 00.00.0D.00.23.00.11.34.12.00.12.78.56.10.12.BC.9A响应80. 00. 01. 00. 233-28地址下位 地址上位数据 1 地址下位地址上位数据 2 地址下位地址上位数据 3地址下位 地址上位数据 n
    9. I/O 寄存器多点字节读出(CMD=24H)  (1) 功能 用字节单位来多点读出数据存储器。(2) 消息格式• 命令• 响应(例)传输数量                                                                    0 00 0L LL HC M D                                 传输数量                                                 8 0R CL LL HC M D  n ≤ 80H                         读出 D800L, D802L 时的命令00. 00. 05. 00. 24. 00. 30. 04. 30D800L=56h, D802L=12h 时的响应 80. 00. 03. 00. 24. 56. 123-29数据 1 地址下位 数据 2 地址上位 数据 3 地址下位数据 n地址上位地址下位地址上位地址下位 地址上位
   10. I/O 寄存器多点字节写入(CMD=25H) (1) 功能 用字节单位来写入数据存储器。(2) 消息格式• 命令 传输数量• 响应(例)n ≤ 80H                                                                                  0 00 0L LL HC M D                                                 8 0     R C     L L     L H    C M D 在 D800L 中写入 56h,D802L 中写入 12h 时的命令 00. 00. 07. 00. 25. 00. 30. 56. 04. 30. 12响应80. 00. 01. 00. 253-30地址下位 地址上位 数据 1 地址下位 地址上位 数据 2 地址下位 地址上位 数据 3地址下位 地址上位 数据 n
   11. I/O 寄存器多点位数读出(CMD=26H) (1) 功能 用位数单位来多点读出数据存储器。(2) 消息格式• 命令• 响应(例)传输数量                                                                 0 00 0L LL HC M D                                   传输数量                                                 8 0R CL LL HC M D                        读出 M400, M402 时的命令00. 00. 05. 00. 26. 00. 1C. 02. 1CM400 为 ON,M402 为 OFF 时的响应 80. 00. 03. 00. 26. 01. 003-31n ≤ 80H   数据 1 地址下位 数据 2 地址上位 数据 3 地址下位数据 n地址上位地址下位地址上位地址下位 地址上位
   12. I/O 寄存器多点位数写入(CMD=27H) (1) 功能 用位数单位来写入数据存储器。(2) 消息格式• 命令 传输数量• 响应(例) M400 为 ON,M402 为 OFF 时的命令00. 00. 07. 00. 27. 00. 1C. 01. 02. 1C. 00响应80. 00. 01. 00. 27n ≤ 80H                                                                                  0 00 0L LL HC M D                                                 8 0     R C     L L     L H    C M D 3-32地址下位 地址上位 数据 1 地址下位 地址上位 数据 2 地址下位 地址上位 数据 3地址下位 地址上位 数据 n
    13. 重置 (CMD=32)  (1) 功能重置 CPU 模块。(2) 消息格式• 命令• 响应(例) 命令00. 00. 03. 00. 32. 00. 00(例) 响应80. 00. 03. 00. 32. 00. 00      0 0       0 0      L L      L H      C M D      0 0     0 0        8 0       R C      L L      L H      C M D      0 0     0 0  该命令发出后,可通过发出扫描恢复命令来恢复扫描。注意: 虽然可通过经由以太网来发出该命令的方法对 CPU 模块进行重置,但 2ET 模块自身也将被重置,所以,2ET 模块正在通信中的所有连接都将出现异常。经由以太网,在远离设备的地方进行重置或扫描停止、扫描恢复等作业时,请在充分确认设备内及其周围有无 人员,以及是否会给设备造成损伤等安全的基础上再进行。 3-33
    14. 扫描恢复(CMD=32)  (1) 功能开始 CPU 的扫描。(2) 消息格式• 命令• 响应(例) 命令00. 00. 03. 00. 32. 01. 00(例) 响应80. 00. 03. 00. 01. 00      0 0       0 0      L L      L H      C M D      0 1     0 0        8 0       R C      L L      L H      C M D      0 1     0 0  3-34
    15. 扫描停止、停止解除(CMD=32)  (1) 功能进行 CPU 扫描的停止或停止解除。(2) 消息格式 • 命令注意: 进行扫描停止解除后,通过执行扫描恢复命令来恢复扫描。• 响应(例) 停止扫描时的命令00. 00. 04. 00. 32. 02. 00. 01响应80. 00. 03. 00. 32. 02. 00      0 0       0 0      L L      L H      C M D      0 2      0 0    O P 1        OP1   动作     00   扫描停止解除     01      扫描停止        8 0     R C     L L     L H     C M D     0 2    0 0 3-35
    16. 疑似扫描停止、停止解除(CMD=32)  (1) 功能暂停(RUN 输出为 ON)CPU 的扫描或解除暂停。(2) 消息格式 • 命令注意: 用解除暂停来恢复扫描。 • 响应(例) 暂停时的命令00. 00. 04. 00. 32. 03. 00. 01响应80. 00. 03. 00. 32. 03. 00      0 0     0 0     L L     L H     C M D     0 3     0 0   O P 1      OP1  动作     00     解除暂停   01    暂停        8 0     R C     L L     L H     C M D     0 3    0 0 3-36
    17. CPU 状态读出(CMD=32)  (1) 功能读出 CPU 的工作状态信息。(2) 消息格式• 命令• 响应      0 0     0 0     L L     L H     C M D     1 1    0 0       8 0       R C      L L      L H      C M D      1 1      0 0                                                                                    3-37数据 1 数据 2数据 8
    bit  内容     bit    内容                    7   RUN                       7     踪迹   6停止中  6 扫描采样踪迹    5 停止请求持续中     5  定期采样踪迹    4   疑似停止中      4     启用检出   3  调试模式   3    触发检出   2I/O 监视器用户模式  2 1 扫描步骤    1 PC3 模式     1  1 程序段步骤    0   PC10 模式 *2      0     1 命令步骤                  7严重故障                 7 I/O 离线    6 轻微故障     6  远程 RUN 设定    5 警报     5  状态锁存设定    4         4        3I/O 分配用参数有变更  3     2 有存储卡     2      1         1        0  0                     7 存储卡运行                      7      6 程序及附带信息禁止写入     6  程序及附带信息写入权限定    5         5     闪存寄存器写入异常 *2   4  4 闪存寄存器写入中 *2    3      3  设备信息写入异常 *1    2         2     设备信息写入中 *1   1  1 RUN 中写入异常 *1    0      0  RUN 中写入中 *1                    7   系统内存禁止读出                        7        6系统内存禁止写入  6     5   系统 I/O 禁止读出      5        4系统 I/O 禁止写入  4     3         3     程序 3 运行中 *1   2  2 2运行中 *1    1      1  1运行中 *1    0       0   (例) 命令00. 00. 03. 00. 32. 11. 00通常 RUN 状态时的响应 80.00.0B.00.32.11.00.82.00.00.00.00.00.00.0E3-38数据 4 数据 3 数据 2 数据 1数据 8 数据 7 数据 6 数据 5
    18. 执行权限定状态读出(CMD=32)  (1) 功能 读出请求执行权限定的请求源。(2) 消息格式• 命令• 响应8RLLC20 0CLHM10D仅使用数据 7,其他为 FF 表示程序及附带信息写入权限定的请求源。00 ···········周边装置01-08·······链接 No.09 ··········PC2JC(内置计算机链接) FF ··········· 无注: 用计算机链接命令在 CPU 内写入程序及附带信息时,请在“错误代码 35”回送给主机后,读出通过 该命令进行执行权限定的周边装置及链接 No.,并从正在进行“执行权限定设定设置”的设备进行“执 行权限定设定重置”之后,再进行写入。例如,用链接 No.1 的 2ET 模块进行程序写入时,将回送“错误代码 35”,如果在进行“执行权限定读 出”后为“02”(链接 No.2),则从链接 No.2 的模块进行过“执行权限定设定重置”之后,才可用链接 No.1 写入。(例) 命令00. 00. 03. 00. 32. 21. 00链接 No.2 模块进行执行权限定设定设置时的响应 80.00.0B.00.32.21.00.FF.FF.FF.FF.FF.FF.02.FF      0 0     0 0     L L     L H     C M D     2 1    0 0                                                                                        3-39数据 1 数据 2数据 6 数据 7 数据 8
    19. 执行权限定设定(CMD=32)  (1) 功能 仅在请求执行权限定的请求源中限定、或解除执行的权利。限定解除仅请求限定的请求源可以进行。注: 所谓执行权限定,是指禁止或允许从其他通信模块及周边装置写入程序及附带信息的功能(设置时为禁止,重置后为允许)。例如,从计算机链接进行“执行权限定设定的设置”时,从周边装置(图 像编程器 GP1)的写入就将无法进行。这是为了禁止由 2 个以上的设备进行双重写入。允许从其他 设备写入时,请在“执行权限定设定的设置”后,写入一结束,就进行“执行权限定设定的重置”。(2) 消息格式 • 命令OP2 ··· 40h 固定 • 响应      0 0     0 0     L L     L H     C M D     2 2     0 0     O P 1   O P 2       OP1  动作     00  执行权重置     01     执行权设置        8 0       R C      L L      L H      C M D      2 2     0 0  (例)连接仅在所连接的 2ET 模块中限定执行权。 命令00. 00. 05. 00. 32. 22. 00. 01. 40响应80. 00. 03. 00. 32. 22. 003-40
    20. 填充(CMD=32)  (1) 功能 在数据存储器的任意区域写入字单位的指定数据。(2) 消息格式 • 命令OP2 ··· 40h 固定 • 响应(例) 用 1234h 填充 D0800~D08FF 时的命令00. 00. 0A. 00. 32. 32. 00. 02. 00. 18. 00. 01. 34. 12响应80. 00. 03. 00. 32. 32. 00      0 0       0 0      L L      L H      C M D      3 2      0 0      O P 1                                           OP1  动作     01  程序存储器     02   数据存储器      8 0     R C     L L     L H     C M D     3 2    0 0 3-41地址下位地址上位字数量下位字数量上位数据下位数据上位
   21. 计时器、计数器设定值、当前值读出(CMD=32) (1) 功能 读出计时器、计数器的设定值、当前值。(2) 消息格式• 命令• 响应(例) 读出 T000 的设定值、当前值时的命令 00. 00. 05. 00. 32. 40. 00. 00. 06T000 的设定值=10, 当前值=08 时的响应 80. 00. 07. 00. 32. 40. 00. 0A. 00. 08. 00注: 设定值、当前值可作为 16 进制的数据读出。      0 0       0 0      L L      L H      C M D      4 0      0 0      O P 1                   8 0       R C      L L      L H      C M D      4 0      0 0                         3-42设定值下位设定值上位 地址下位 当前值下位 地址上位 当前值上位
   22. 计时器、计数器设定值、当前值写入(CMD=32) (1) 功能 同时变更计时器、计数器的设定值、当前值。(2) 消息格式• 命令• 响应(例) 在 T000 的设定值中写入 10,当前值中写入 08 时的命令 00. 00. 09. 00. 32. 41. 00. 00. 06. 0A. 00. 08. 00响应80. 00. 03. 00. 32. 41. 00注: 设定值、当前值用 16 进制的数据进行指定。      0 0       0 0      L L      L H      C M D      4 1      0 0                                           8 0       R C      L L      L H      C M D      4 1     0 0  3-43地址下位地址上位设定值下位设定值上位当前值下位当前值上位
    23. 计时器、计数器设定值写入(CMD=32)  (1) 功能 仅变更计时器、计数器的设定值。(2) 消息格式• 命令• 响应(例) 使 T010 的设定值为 10 时的命令00. 07. 00. 32. 42. 00. 10. 06. 0A. 00响应80. 00. 03. 00. 32. 42. 00      0 0     0 0     L L     L H     C M D     4 2     0 0                         8 0     R C     L L     L H     C M D     4 2    0 0 3-44地址下位地址上位设定值下位设定值上位
    24. 计时器、计数器当前值写入(CMD=32)  (1) 功能 仅变更计时器、计数器的当前值。(2) 消息格式• 命令• 响应(例) 使 T010 的当前值为 05 时的命令00. 00. 07. 00. 32. 43. 00. 10. 06. 05. 00响应80. 00. 03. 00. 32. 43. 00      0 0       0 0      L L      L H      C M D      4 3      0 0                               8 0     R C     L L     L H     C M D     4 3    0 0 3-45地址下位地址上位当前值下位当前值上位
    25. 时钟时刻读出(CMD=32)  (1) 功能读出 CPU 内置时钟的时刻(2) 消息格式• 命令• 响应(例) 命令00. 00. 03. 00. 32. 70. 0024 小时制0:星期日 1:星期一      0 0       0 0      L L      L H      C M D      7 0     0 0        8 0     R C     L L     L H     C M D     7 0     0 0                                     2001年6月10日18时43分30秒 星期二时的响应 80.00.0A.00.32.70.00.30.43.18.10.06.01.023-46公历后 2 位BCD 代码数据  秒 分钟 小时 日 月 年 星期
    26. 时钟时刻设定  (1) 功能变更 CPU 内置时钟的时刻。(2) 消息格式• 命令• 响应24 小时制     0:星期日      0 0       0 0      L L      L H      C M D      7 1      0 0                                            (例) 设定2001年6月10日18时43分30秒 星期二时的命令 00.00.0A.00.32.71.00.30.43.18.10.06.01.02响应80. 00. 03. 00. 32. 71. 003-47公历后 2 位 BCD 代码数据1:星期一        8 0       R C      L L      L H      C M D      7 1     0 0  秒 分钟 小时 日 月 年 星期
    27. 中继命令(CMD=60)  (1) 功能对通过安装了 2ET 模块的相同 CPU 模块中安装的 HPC 链接 ME-NET 或 FL-net 连接的其他 CPU 模块发出命令。  命令     响应 ACB CPU 2ET FL- CPU FL-   netnet  命令响应   注意: 使用中继命令时,命令数据及响应数据的最大字节数量将被限制在 550 字节。 (2) 消息格式• 命令                                                                0 00 0L LL HC M D0 5L LL H数据0 0                • 响应上图 A 的链接模块的链接 No.上图 B 的链接模块的站号 上图 A 的链接模块的链接 No.表示命令的固定数据(ENQ)与实际发出命令的 CPU 模块(上图 C )相对的命令 (与 No.1~42 的命令数据相同)表示响应的固定数据(ACK)                                                                 8 0R CL LL HC M D0 6L LL H响应数据× ×                              上图 B 的链接模块的站号来自上图 C 的 CPU 模块的响应 (与 No.1~42 的响应数据相同)  3-48链接 No. 站号下位 站号上位链接 No. 站号下位 站号上位命令代码命令代码
(例) 安装了与链接 No.2 的 FL-net 连接在一起的站号 03 的 FL-net。 读出 CPU 模块的数据寄存器 D0100~D0102 时   链接 No.2net D100 |D102站号 No.3CPU FL- net    CPU 2ET FL-   • 命令00. 00. 0D. 00. 60. 02. 03. 00. 05. 05. 00. 1C. 00. 11. 03. 00. 00                (2)部传输字节数 中继命令代码3 字 字地址 D0100I/O 寄存器字读出命令 (1)部传输字节数固定数据(ENQ) 中继目的地链接模块的站号中继源链接模块的链接 No. • D0100=0100, D0101=0302, D0102=0504 时的响应(2)(1)80. 00. 0F. 00. 60. 02. 03. 00. 06. 07. 00. 1C. 00. 01. 02. 03. 04. 05. XX(XX:不定)                       (2)部传输字节数 中继命令代码D0100 D0101 D0102的数据内容I/O 寄存器字读出命令代码(1)部传输字节数 固定数据(ACK)中继目的地链接模块的站号 中继源链接模块的链接 No.3-49
链接目的地的 CPU 模块上有错误应答时的响应如下所示。 (2)(1)80. 00... 60. 02. 03. 00. 15... EC(错误代码). ##···##. XX (XX:不定)                   (2)部传输字节数 中继命令代码错误响应数据 请参照 3.7.4 错误代码表。(1)部传输字节数 固定数据(NAK)中继目的地链接模块的站号 中继源链接模块的链接 No.通过对中继命令分层,最大可执行 4 层的中继命令。ICPU 2ET FL- net(I-1)III-1:链接 No.2, 站号 1      CPU FL- netFL-II-1:链接 No.1, 站号 3 II-2:链接 No.2, 站号 2net (II-1) (II-2)IIICPU FL- net(IV-1)  CPU FL- netFL-III-1:链接 No.1, 站号 1 III-2:链接 No.2, 站号 2IV-1:链接 No.1, 站号 1net (III-1) (III-2) IV 3-50
向 III 的 CPU 模块发出 I/O 寄存器字读出命令时• 命令 (3)  (2)(1)   00. 00. 15. 00. 60. 02. 03. 00. 05. 0D. 00. 60. 02. 01. 00. 05. 05. 00. 1C. 00. 11. 03. 00. 00. 00                       (3)部传输字节数 中继命令代码发给 III 的 CPU 的命令 (1)部传输字节数固定数据(ENQ) III-1 的 FL-net 的站号II-2 的 FL-net 的链接 No. 中继命令代码(2)部的传输字节数 固定数据(ENQ)II-1 的 FL-net 的站号 I-1 的 FL-net 的链接 No.• D0100=0706, D0101=0908, D0102=0B0A 时的响应(3)  (2)(1)   80. 00. 17. 00. 60. 02. 03. 00. 06. 0F. 00. 60. 02. 01. 00. 06. 07. 00. 1C. 06. 07. 08. 09. 0A. 0B. XX. XX                       (3)部传输字节数 中继命令代码来自 III 的 CPU 的响应数据 (1)部传输字节数固定数据(ACK) III-1 的 FL-net 的站号II-2 的 FL-net 的链接 No. 中继命令代码(2)部传输字节数 固定数据(ACK)II-1 的 FL-net 的站号 I-1 FL-net 的链接 No.3-51
向 IV 的 CPU 模块发出 I/O 寄存器字读出命令时 • 命令(4)(3)    (2)(1)   00.00.1D.00.60.02.03.00.05.15.00.60.02.01.00.05.0D.00.60.02.01.00.05.05.00.1C.00.11.03.00.00.00.00                                 (4)部传输字节数 中继命令代码I-1 的 FL-net 的链接 No.II-1 的 FL-net 的站号固定数据(ENQ)来自 IV 的 CPU 的响应数据 (1)部传输字节数固定数据(ENQ) IV-1 的 FL-net 的站号III-2 的 FL-net 的链接 No. 中继命令代码(2)部传输字节数 固定数据(ENQ)III-1 的 FL-net 的站号 II-2 的 FL-net 的链接 No.中继命令代码 (3)部传输字节数• D0100=0D0C, D0101=0F0E, D0102=3412 时的响应 (4)  (3)(2)   (1) 80.00.1F.00.60.02.03.00.06.17.00.60.02.01.00.06.0F.00.60.02.01.00.06.07.00.1C.0C.0D.0E.0F.12.34.XX.XX.XX                                   (4)部 传输字节数中继命令代码I-1 的 FL-net 的链接 No. II-1 的 FL-net 的站号固定数据(ACK)来自 V 的 CPU 的响应数据 (1)部传输字节数固定数据(ACK) IV-1 的 FL-net 的站号III-2 的 FL-net 的链接 No. 中继命令代码(2)部传输字节数 固定数据(ACK)III-1 的 FL-net 的站号 II-2 的 FL-net 的链接 No.中继命令代码 (3)部传输字节数注1: 因中继命令发布目的地 PLC 的电源 OFF,以及设定错误而无法通信时,最大 5 秒钟无响应返回。 无应答需进行重试时,请在数据发送后留出 5 秒以上的间隔。注2: 长时间反复向无法连接的地址发送中继命令时,会发生硬件异常(H9)。发生本异常时,请重置/启动 CPU 模块。3-52
    28. 程序扩展字读出(CMD=90H)  (1) 功能 用字单位数据块来读出程序存储器。(2) 消息格式 • 命令传输数量                                              0 00 0L LL HC M D                       • 响应程序 No. 传输数量PRG1 = 01 PRG2 = 02 PRG3 = 03                                            8 0R CL LL HC M D   n ≤ 200H                (例)从程序编号 2 的顺控程序 0 地址读出 2 字时的命令00.00.06.00.90.02.00.00.02.00来自 0 地址的内容为 NOP 时的响应 80.00.05.00.90.00.00.00.003-53数据 1PRG. No.数据 2字数量 下位 字数量 上位数据 n地址下位地址上位
    29. 程序扩展字写入(CMD=91H)  (1) 功能 用字单位数据块来写入程序存储器。(2) 消息格式• 命令 传输数量程序 No.• 响应(例)在 PRG.编号 2 的顺控程序 4 地址中写入 NOP(代码:0000)时的命令00. 00. 08. 00. 91. 02. 04. 00. 00. 00. 00. 00响应80. 00. 01. 00. 91n ≤ 200H                                                                 0 00 0L LL HC M D                                             8 0       R C      L L      L H     C M D  3-54PRG. No.地址下位 地址上位数据 1数据 2数据 n
    30. 参数扩展读出(CMD=92H)  (1) 功能 读出参数区域。(2) 消息格式 • 命令系统参数=00 PRG1 = 01 PRG2 = 02 PRG3 = 03• 响应传输数量                                     0 00 0L LL HC M D                    程序 No.256 字节/程序段 参数 No.传输数量                                                     8 0R CL LL HC M D              (例)读出程序编号 1、参数编号 9、程序段编号 0(程序名称参数)时的命令00. 00. 04. 00. 92. 01. 09. 00响应(程序名称=“PROGRAM1”)80. 00. 43. 00. 92. 40. 00. 50. 52. 4F. 47. 52. 41. 4D. 31. 00. 00. 00.···003-55字节数 下位 字节数 上位PRG. No. PAR. No. Block数据 1 数据 2数据 n
    31. 参数扩展写入(CMD=93H)  (1) 功能 写入参数区域。(2) 消息格式• 命令• 响应传输数量程序 No.       256 字节/程序段 参数 No.                                                           0 00 0L LL HC M D                   8 0     R C     L L     L H    C M D (例) 在程序编号 1、参数编号 9、程序段编号 0(程序名称参数)中写入“PROGRAM1”时的命令 00. 00. 0C. 00. 93. 01. 09. 00. 50. 52. 4F. 47. 52. 41. 4D. 31响应80. 00. 01. 00. 933-56PRG. No. PAR. No. 程序段 数据 1 数据 2数据 n
    32. 数据扩展字读出(CMD=94H)  (1) 功能 用字单位数据块来读出数据存储器(含扩展区域)。(2) 消息格式 • 命令传输数量                                              0 00 0L LL HC M D                       • 响应(例)传输数量No. 对应00 扩展位数区域(含 ES,EN,H)01 PRG. 102 PRG. 203 PRG. 307 扩展位数区域 2(GXY,GM)08 扩展寄存器区域(U)n ≤ 200H                                                       8 0R CL LL HC M D                   读出 1 字的扩展数据寄存器 U0000 时的命令 00. 00. 06. 00. 94. 08. 00. 00. 01. 00U0000=1234 时的响应80. 00. 03. 00. 94. 34. 123-57数据 1No.数据 2字数量 下位 字数量 上位数据 n地址下位地址上位
    33. 数据扩展字写入(CMD=95H)  (1) 功能 用字单位数据块来写入数据存储器(含扩展区域)。(2) 消息格式• 命令 传输数量• 响应(例)n ≤ 200H                                                                 0 00 0L LL HC M D                                            8 0     R C     L L     L H    C M D 在扩展数据寄存器 U0000 中写入 1234H 的数据时的命令 00. 00. 06. 00. 95. 08. 00. 00. 34. 12响应80. 00. 01. 00. 953-58No.地址下位 地址上位数据 1数据 2数据 n
    34. 数据扩展字节读出(CMD=96H)  (1) 功能 用字节单位数据块来读出数据存储器(含扩展区域)。(2) 消息格式• 命令• 响应(例)传输数量传输数量                                             0 00 0L LL HC M D                                                                             8 0R CL LL HC M D  n ≤ 400H                         读出 2 字节的扩展当前值寄存器 EN0000 时的命令 00. 00. 06. 00. 96. 00. 00. 20. 02. 00EN0000=1234 时的响应 80. 00. 03. 00. 96. 34. 123-59数据1 No. 数据2 地址下位 数据3 地址上位数据4字节数下位 字节数上位数据 n
    35. 数据扩展字节写入(CMD=97H)  (1) 功能 用字节单位数据块来写入数据存储器(含扩展区域)。(2) 消息格式 • 命令传输数量                                                                     0 00 0L LL HC M D             n ≤ 400H   • 响应(例)程序 No.      8 0       R C      L L      L H     C M D  在扩展当前值寄存器 EN0000L、EN0000H 中写入 12H、34H 的 2 字节时的命令 00. 00. 06. 00. 97. 00. 00. 20. 12. 34响应80. 00. 01. 00. 973-60PRG. No.地址下位 地址上位 数据 1 数据 2 数据 3 数据 4数据 n
    36. 数据扩展多点读出(CMD=98H)  (1) 功能 用位数、字节、字的各单位来多点读出数据存储器(含扩展区域)。(2) 消息格式 • 命令b7b6b5b4 b3b2b1b00~7位数监视器地址指定 字节监视器地址指定 字监视器地址指定8点 传输数量地址合计 = 位数点数 + 字节点数 + 字点数 ≤176点数据合计 = 位数点数/8 + 字节点数 + 字点数 × 2 ≤ 128(字节)    位数位置PRG No.                                                                                    0 00 0L LL HC M D                                                          • 响应          8 0     R C     L L     L H     C M D                                                       (例)Max.128 字节将扩展内部寄存器 EM000 的位数 7、扩展当前值寄存器 EN0000L、扩展数据寄存器 U0000 的数据分别读出 1 点时的命令00. 00. 0D. 00. 98. 01. 01. 01. 70. 00. 0C. 00. 00. 20. 08. 00. 00EN000 的位数 7ON、EN0000L=12H、U0000=3456H 时的响应 80. 00. 05. 00. 98. 01. 12. 56. 343-61数据 1 数据 2 数据 3编号 位数数据 MPRG 编号数据 N 下位 数据 N 上位PRG 编号位数点数 字节点数字点数下位字节地址上位编号 位数下位字节地址上位下位字节地址上位下位字节地址上位
    37. 数据扩展多点写入(CMD=99H)  (1) 功能 用位数、字节、字的各单位来多点写入数据存储器(含扩展区域)。(2) 消息格式 • 命令传输数量↑位数数据 bit0 为有效数据地址合计 = 位数点数 + 字节点数 + 字点数 ≤176点数据合计 = 位数点数/8 + 字节点数 + 字点数 × 2 ≤ 128(字节)      位数指定 字节指定 字指定                                                                                                           0 00 0L LL HC M D                                                                   • 响应(例)      8 0     R C     L L     L H    C M D 将扩展内部寄存器 EM000 的位数 7ON、扩展当前值寄存器 EN0000L=12H、扩展数据寄存器 U0000=3456H 的数据分别写入 1 点时的命令00. 00. 11. 00. 99. 01. 01. 01.70. 00. 0C. 01. 00. 00. 20. 12. 08. 00. 00. 56.34响应80. 00. 01. 00. 993-62位数点数字节点数字点数编号 位数下位字节地址上位数据 1编号 位数下位字节地址上位 数据 2PRG 编号 字节地址 M 数据 MPRG 编号字节地址 N数据 N 下位 数据 N 上位
    38. 扩展功能调用(CMD=A0H)  (1) 功能进行 PC3J 动作的控制、状态读出、各种信息的读出、写入等。在命令代码之后,除了加入 PRG.编号以外,格式与功能调用(CMD=32H)相同。但是在重置后,时钟 时刻的读出、设定 PRG.编号固定为 00,执行重置命令时,所有的程序都将被重置。(2) 消息格式• 命令• 响应(例) 重置 PC3J00. 00. 04. 00. A0. 00. 00. 00响应80. 00. 04. 00. A0. 00. 00.00传输数量参照命令代码 32h 的子命令 传输数量                                                               0 00 0L LL HC M DO P 1O P 2O P n                                                                                                 0 00 0L LL HC M DO P 1O P 2O P n                                CPU 模块时的命令3-63PRG. No.PRG 编号 下位下位功能编号功能编号。上位上位
    39. PC10 数据字节读出(CMD=C2H)  (1) 功能用字节单位数据块来读出数据存储器(PC10 全区域)。(2) 消息格式• 命令00LL 00LH• 响应传输数量数据数量        下位 上位 WORD WORDC M D                                            8 0R CL LC M D      L H          n ≤ 3F0H       40. PC10 数据字节写入(CMD=C3H)  (1) 功能用字节单位数据块来写入数据存储器(PC10 全区域)。(2) 消息格式 • 命令00LL 00LH• 响应传输数量       下位 上位 WORD WORDC M D                n ≤ 3F0H                8 0   R C   L L   L H   C M D    3-64地址 数据1 地址下位下位地址 上位地址 上位数据 2地址 数据3 地址下位地址 数据4 地址上位上位数据 1 数据 2 数据 3 数据 4字节数 下位数据 n数据 n下位字节数 上位
 41. PC10 多点读出(CMD=C4H)(1) 功能用位数、字节、字、长型的各单位来多点读出数据存储器(PC10 全区域)。(2) 消息格式00LLC00LHM D• 命令• 响应 8RLL8 点为 1 个数据0CLHC M D传输数量 下位 上位WORD WORD数据数量数据合计 = 位数点数/8+ 字节点数 + 字点数 ×2+ 长型点数 ×4≤506(字节)下位 上位 WORD WORD位数地址部(位数地址)地址合计 = 位数点数 + 字节点数 + 字点数 + 长型点数 ≤127点下位 上位 WORD WORD42. PC10 多点写入(CMD=C5H)(1) 功能用位数、字节、字、长型的各单位来多点写入数据存储器(PC10 全区域)。(2) 消息格式• 命令00LLC下位 上位 WORD WORD位数地址部 (位数地址)传输数量下位 上位 WORD WORD字节地址部 (字节地址)下位 上位 WORD WORD字地址部 (字节地址)00LHM D(LL,LH=512 字节以下) • 响应8RLL 0CLHC M D下位 上位 下位 上位 WORD WORD WORD WORD长型地址 (字节地址)字节地址部 (字节地址)字地址部 (字节地址)长型地址 (字节地址)3-65下位 上位 WORD WORD下位 上位 WORD WORD数据 M 地址地址上位地址 下位地址 下位地址 上位数据 L 地址 下位上位下位下位地址地址 上位数据 L 上位上位数据 L 地址地址 数据 L 下位下位下位 数据 L 地址位数点数位数点数位数点数字节点数 字点数长型点数字节点数 字节点数字点数 长型点数字点数地址 下位长型点数 地址 地址 上位下位地址 地址 数据 1 下位上位地址 地址 数据 2 上位下位地址上位 数据 3地址 下位数据 1地址 下位下位地址 地址 上位上位地址 数据N下位 下位地址地址 数据N 下位上位 上位 地址下位地址 上位 上位上位 数据L地址656565 数据 L数据 N 下位上位 下位 地址下位数据 N 上位上位数据 L 上位数据 M 地址地址 上位
    43. CPU 状态读出(CMD=A0H)  (1) 功能读出 CPU 的工作状态信息。(2) 消息格式• 命令• 响应 0 0   0 0   L L   L H   C M D    0 0   1 1   0 0     8 0   R C   L L   L H   C M D    0 0   1 1   0 0         3-66数据 1 数据 2数据 8
    44. FR 寄存器登录(CMD=CAH)  (1) 功能 将闪存寄存器中的数据写入相应的闪存存储器。未发出闪存寄存器登录命令,仅进行程序段写入时,通过重置或接入电源,即可恢复原先闪存内的内容。(2) 消息格式• 命令ExNo 请参照资料 8。• 响应例)写入 FR000000~FR00FFFF 时1) 【FR000000~FR007FFF】 PC10 数据块写入(命令 C3)2) 闪存寄存器登录(命令 CA)3) 闪存写入完成检查(命令 A0、CPU 状态读出)4) 【FR008000~FR00FFFF】 PC10 数据块写入(命令 C3)5) 闪存寄存器登录(命令 CA)6) 闪存写入完成检查(命令 A0、CPU 状态读出)7) 结束 0 0   0 0   L L   L H   C M D       8 0   R C   L L   L H   C M D      从1) 到3) 以64kbyte单位 来实施  3-67从1) 到3) 以64kbyte单 位来实施ExNo
3.5以太网 文件存储器方式是使用文件存储器的收发数据区域,与对方节点进行数据收发的方式。除了与计算机、工作站之外,在 2ET 模块之间,也可以进行数据的交换。  CPU 模块(2ET)其他节点          SPW SPR             SPW发送         文件存储     接收发送      连接 1 数据发送区域            响应            SPR连接 1 数据接收区域   发送                       响应        3.5.1最大可收发 2044 字节。 文件存储器方式的通信格式   以太网报头        IP 报头    TCP/UDP 报头 TOYOPUC 数据        以太网 FCS  3.5.1.1以太网报头、IP 报头、TCP/UDP 报头、以太网 FCS 等通常会由通信软件等自动附带。使用 2ET 模块时,也 会由 2ET 模块自动附带。下面将进行 TOYOPUC 数据部的说明。 TOYOPUC数据部分的详细内容  • 命令数量• 响应传输数量进入文件存储器的数据      60 (FT)       0 0    L L    L H    发送数据          E0 (FT)         RC    FT- 帧的类型RC-请参照响应代码(00为正常,返回00以外的响应代码时,请参照 “3.7.5.1 连接异常 错误代码表”及“3.7.5.2错误响应数据 错误代码表”。 LL- 传输数量 下位LH- 传输数量 上位3-68
3.5.2 文件存储器发送通过顺控程序从 2ET 模块进行文件存储器的发送时,按照以下步骤进行。文件存储器的地址请参照“资料 2 文件存储器地址映射表”。 发送请求标志CPU→以太网 发送完成标志以太网→CPU(1) (2)(6)(3) (4)(5) (7)                                     (1) 用顺控程序将发送数据写入文件存储器。(2) 用顺控程序使发送请求为 ON。(3) 2ET 模块进行发送。(4) 其他节点返回响应数据。(5) 2ET 模块接收到正常响应后,使发送完成为 ON。(6) 用顺控程序确认发送完成后,使发送请求为 OFF。(7) 2ET 模块在发送请求为 OFF 后,使发送完成为 OFF。• 顺控程序例 下面表示文件存储器发送的顺控程序例。条件:发送 D0100~D04FD 的 2044 字节数据。传输数量数据在 D04FE 中设置。(D04FE=07FCh)连接 No.=1链接 No.=1通过资料 3 的顺控程序例可以看出,控制输入输出信号被分配在 K00~K68 上。[ WMOV 1002 → R021 ] (链接 No.1,2 字节传输)[ WMOV 29FC → R022 ] (D04FE 的间接地址 (29FCh=2000h+4FEh×2)[ WMOV 1000 → R023 ] (文件存储器发送区域 传输数量地址)[ WMOV 13FE → R024 ] (链接 No.1,1022 字节传输)[ WMOV 2200 → R025 ] (D0100(L)的间接地址 (2200h=2000h+100h×2)[ WMOV 1002 → R026 ] (文件存储器发送数据区域起始地址)其他节点       V006(仅第 1 扫描为 ON 的特殊 继电器)           3-69
   [ WMOV 13FE → R027 ] (链接 No.1,1023 字节传输)[ WMOV 25FE → R028 ] D02FF(L)的间接地址 (25FFh=2000h+2FFh×2)[ WMOV 1400 → R029 ] (文件存储器发送数据区域后半部起始地址)                 P004发送执行条件连接 1 开放正常[ WMOV 07FC → D4FE (传输数量数据设置)[ SPW R021, R022 → R023 (写入传输数量数据文件存储器)[ SPW R024, R025 → R026 (写入发送数据前半部文件存储器)[ SPW R027, R028 → R029 (写入发送数据后半部文件存储器)] ] ] ]V90 K38        SK10连接 1 发送请求 ON  R     K48 P005 连接 1发送完成连接 1K10 发送请求 OFF注意: 用 SPW 命令可一次性传输的数据数量最大为 1023(3FFH)字节,因此,读入超出此字节数的数据 时,如下例所示,请分 2 次执行 SPW 命令。通过此顺控程序来发送 D0100~D04FE 的数据时,可如下例所示那样发送数据。D0100=0100 D0102=0504 D0104=0908 D0106=0D0C D0108=1110D0101=0302 D0103=0706 D0105=0B0A D0107=0F0E发送数据传输数量数据 D04FD=FBFA D04FE=07FC时的发送数据0F. 10. 11 表示文件存储器发送。2ET 模块会自动附带发送。60. 00. FC. 07. 00. 01. 02. 03FA. FB    传输数量数据3-70
3.5.3 文件存储器接收通过顺控程序从 2ET 模块中进行文件存储器的接收时,将根据以下步骤进行。文件存储器的地址请参照“资料2 文件存储器地址映射表”。接收确认标志CPU → 2ET接收完成标志2ET→ CPU(3)(4)其他节点(6)(7) (5)                      (1)(2)   (1) 由其他节点接收文件存储器的数据。(2) 2ET 模块在接收文件存储器的数据后,将使接收完成为 ON。(3) 用顺控程序检测到接收完成后,用应用命令 SPR 将文件存储器的内容读出。(4) 用顺控程序使接收确认为 ON。(5) 2ET 模块使接收完成为 OFF。(6) 接收完成为 OFF 后,用顺控程序使接收确认为 OFF。(7) 2ET 模块在接收确认为 OFF 后,对其他节点发送响应数据。• 顺控程序例下面表示文件存储器接收的顺控程序例。条件: 将接收数据在数据寄存器 D500~D8FE 中读出。传输数量数据在 D04FF 中设置。(D4FE=07FCh)连接 No.=1链接 No.=1通过资料 3 的顺控程序例可以看出,控制输入输出信号被分配在 K00~K68 上。[ WMOV 13FF → R031 ] (链接 No.1,1023 字节传输)[ WMOV 1800 → R032 ] (文件存储器 连接 1 接收数据 数据区域起始地址)[ WMOV 29FE → R033 ] (D4FF(L)间接地址)[ WMOV 13FF → R034 ] (链接 No.1,1023 字节传输)      V006(仅第 1 扫描为 ON 的特殊继 电器)      3-71
   [ WMOV 1BFF → R035 ] (文件存储器接收数据 数据区域后半部起始地址)     [ WMOV 2DFD → R036 (D6FE(H)间接地址)[ SPR R031, R032 → R033 (读入接收数据前半部文件存储器)[ SPR R034, R035 → R036 (读入接收数据后半部文件存储器)K18R         V90 K58 链接 1可使用标志连接 1接收完成P004]] ]    S连接 1 接收确认为 ON  连接 1 接收确认为 OFF     K58 P005注意: 用 SPR 命令可一次性传输的数据数量最大为 1023(3FFh)字节,因此,读入超出此字节数的数据K18时,如下例所示,请分 2 次执行 SPR 命令。60. 00. FC. 07. 00. 11. 22. 33. 44. 55. 66. 77. 88. 99. AA. BB. CC. DD. EE. FF. 00. 11传输数量数据表示文件存储器发送。由 2ET 模块来判别、取舍。发送这种数据后,如下所示,可设置寄存器数据。AA. BB    D04FE=07FC D0500=1100D0502=5544 D0504=9988 D0506=DDCC D0508=1110D0501=3322 D0503=7766 D0505=BBAA D0507=FFEE传输数量数据发送数据 D08FE=BBAA3-72
3.6以太网 通用通信方式是使用文件存储器的收发数据区域,与对方节点进行数据收发的方式。在通用通信方式中,收发方式为无步骤, TOYOPUC 数据部可用任意数据进行通信,所以,不仅个人电脑等的主机,还可与各种其他公司的以太网设备 进行连接。  CPU 模块通用通信方式的通信格式(2ET)其他节点         SPW SPR              SPW发送         文件存储     接收发送       连接 1 数据发送区域                     SPR连接 1 数据接收区域   接收                           3.6.1   以太网报头         IP 报头       TCP/UDP 报头   TOYOPUC 数据        以太网 FCS      注) 可一次性发出收发请求的数据规模为最大 2044 字节。2ET 的 TCP 最大分段长度 (MSS: Maximum Segment Size)为 1460 字节。在 TCP/IP 中,路由器及其他 节点与最大分段长度相比较,并以较小的一 个 MSS 来进行发送。规模比 MSS 大的数 据可分割后进行收发。UDP 时,分割为 1472 字节以下。  文件存储发送区域 接收区域LL- 传输数量下位 LH- 传输数量上位    L L     L H      TOYOPUC 数据  以太网报头、IP 报头、TCP/UDP 报头、以太网 FCS 等通常会由通信软件等自动附带。使用 2ET 模块时也会 由 2ET 模块自动附带。收发区域将使用在文件存储器方式中使用的收发区域。TOYOPUC 数据部与文件存储器的数据内容相同。LL、LH 不会附加在帧中。传输控制步骤为无步骤,对错误的检查等要由用户自己进行。建议在帧中添加使用传输数量、数据类别等,以 便于确认数据的可靠性。3-73
3.6.1.1 通用通信方式的发送数据 文件存储器区域bit7 bit0用传输数量指定的数据长度                                          LL(传输数量下位)   LH(传输数量上位)   发送数据 (最大 2044 字节)                                                      LL(传输数量下位)   LH(传输数量上位)     接收数据 (最大 2044 字节)     10001001100217FD1800180118021FFD       以太网报头        IP 报头    TCP/UDP 报头 TOYOPUC 数据       以太网 FCS  发送帧3.6.1.2 通用通信方式的接收数据     以太网报头      IP 报头     TCP/UDP 报头   TOYOPUC 数据        以太网 FCS    接收帧文件存储器区域存储有效接收数据数量注) 在 TCP 中,以 1460 以下,在 UDP 中,以 1472 字节以下进 行分割发送     bit7 bit010001001100217FD180018011802注 1) 2ET 的 TCP 最大分段长度(MSS Maximum Segment Size)为 1460 字节。其他节点发送 超过 1500 字节的数据时,可在其他节点侧对 数据进行分割。注 2) 在 IP 层中分割的数据可在 2ET 内自动合并。                                        LL(传输数量下位)   LH(传输数量上位)     发送数据 (最大 2044 字节)                                                    LL(传输数量下位)   LH(传输数量上位)     接收数据 (最大 2044 字节)      1FFD3-74连接 1 接收 连接 1 发送 连接 1 接收 连接 1 发送
3.6.2 切换到通用通信方式的方法通用通信方式可通过在文件存储器的指定区域中写入所确定的设定值的方法进行切换。但是,根据通信参数的 设定方法,切换步骤会有所不同。(1)(2)bit70000                                 1:初始化请求 8:参数区域禁止写入 1:解除 0:禁止0001                                         1~8:连接 1~8 主动开放请求0002                                         1~8:连接 1~8 发送请求0003                                                               1~8:连接 1~8 接收确认通过链接参数进行设定时通过链接参数进行设定时,为防止不小心设定被修改,通常会在通信参数区域设置写入限制。要想启用本 功能,就要在解除参数区域的写入限制之后,在指定区域(通用通信设定)中进行设定。通过使文件存储 器的 0000 的 bit7 为 ON,即可解除整个通信参数的写入限制。通过初始顺控程序进行设定时直接在指定区域(通用通信设定)中写入设定值。bit0000400050006000700080009000A000B000C                                                                 1~8:连接使用 000D000E000F0010                             TCP 主动开放:0000h, TCP 对方特定被动开放:0100h0018                             TCP 主动开放:0000h, TCP 对方特定被动开放:0100h通用通信设定可在各连接中进行设定。设定用 SPW 命令进行。 在通用通信设定区域以外进行写入时,通信参数有时会发生变更而无法进行通信,因此,请注意不要弄错要写入的地址。 将通用通信设定设置为启用(FF)后,该连接将不可使用计算机链接方式、文件存储器方式。 请勿在通用通信设定区域设置 00、FF 以外的值。(设定为 01~FE 时,将作为 00 运行) 在通信中进行设定变更时,通信有时会无法正常进行。一旦设定后,请避免进行变更。 8 (固定 00)  1 8 7 6 5432 1 87654321 8 7 6 5432 1(固定 00)    3   2    1  (固定 00)    (固定 00)    (固定 00)     自身节点 IP 地址 00000001~FFFFFFE       (下位) (上位)         87 65432 1  8  7  6 54  32   1  16      15     14    13   12      11    10     9  (固定 00)                       连接开放方式  自身节点端口 No. 0401h~FFFEh     (下位)    (上位) 其他节点表 No. 0001h~0010h    (下位)    (上位)    通用通信设定   (固定 00)                         连接开放方式  自身节点端口 No. 0401h~FFFEh     (下位)    (上位)   其他节点表 No. 0001h~0010h  (下位)    (上位)    通用通信设定   (固定 00)     1:错误日志接收确认2:ICMP 日志接收确认 001100120013001400150016       通用通信禁用: 00h, 通用通信启用: FFh 00171~16:表格使用TCP 对方不特定被动开放:0200h, UDP:0001h0019001A001B001C001D001E       通用通信禁用: 00h, 通用通信启用: FFh 001FTCP 对方不特定被动开放:0200h, UDP:0001h 3-75连接 No.2 连接 No.1
通用通信方式的切换状态可在以下区域进行确认。1)bit70100                                             1:初始化正常0101                             1~8:连接 1~8 开放正常0102                             1~8:连接 1~8 连接异常0103                                       1~8:连接 1~8 发送完成01040105                             1~8:连接 1~8 接收完成0106                                       1:错误日志接收 2:ICMP 日志接收 3:PING 正常 4:PING 异常 0107                                   1~8:连接 1~8 通用通信方式启用文件存储文件存储器地址 0107 的各连接相应位数为 ON 时,通用通信方式启用。相应位数为 OFF 时,文件存储器 方式及计算机链接方式启用。bit0       18 7  6  5 4 3  2  1 876543218 7 6 54 3 2 1                     87654321   4 3 2 18 7  6  5 4 3  2  1         自身以太网地址(下位)(上位)         0108 0109 010A 010B 010C 010D以太网地址在 1 台 1 台的以太网设备中设定了固有的值。    S3#0 S3#1 S3#2 S3#3 S3#4 S3#5 S3#6 S3#7 S3#8 S3#9 S3#A S3#B S3#C S3#D S3#E S3#F可用 S3#7 的下位 0~7 位数来确认状态。各连接相应位数为 ON 时,通用通信方式启用。相应位数为 OFF 时,文件存储器方式及计算机链接方式启用。MSB LSB FEDCBA98765432102)状态监视功能     CN8            主动开放请求    CN1       0      0       0      0      0      0      0      *1       CN8    文件存储器接收请求      CN1    CN8            文件存储器发送请求      CN1       0      0      0      0      0      0      0      0     0     0     0     0     0     0      *3      *2              CN8 开放正常 CN1         0      0      0      0      0      0    *5    *4     CN8 文件存储器发送完成 CN1                  CN8 连接异常 CN1    0      0      0      0     *9     *8  *7      *6     CN8      文件存储器接收完成    CN1    自身的以太网地址第 4 位 *10         自身的以太网地址第 5 位 *10  自身的以太网地址第 6 位 *10           CN8 通用通信启用 CN1        连接 1:连接异常代码     连接 2:连接异常代码     连接 3:连接异常代码     连接 4:连接异常代码     连接 5:连接异常代码     连接 6:连接异常代码     连接 7:连接异常代码     连接 8:连接异常代码                                            *1 *2 *3 *4 *5 *6 *7 *8 *9初始化请求错误日志接收确认ICMP 日志接收确认初始化正常初始化异常错误日志接收ICMP 日志接收PING 正常PING 异常以太网地址的前 3 位数为 00.60.53(固定值)。*10# 将根据链接 No.来确定。3-76
3.6.3 通用通信发送 3.6.3.1 发送步骤通过顺控程序从 2ET 模块进行通用通信方式的发送时,按照以下步骤进行。文件存储器的地址请参照 2ET 使 用说明书“资料 2 文件存储器地址映射表”。        发送请求标志 (1) (2) CPU→以太网发送完成标志 以太网→CPU(5)(3) (4) (6)                           (1) 用顺控程序将发送数据、传输数量写入文件存储器。(2) 用顺控程序使发送请求为 ON。(3) 将发送数据传输给发送处理部,并使发送完成为 ON。(4) 2ET 模块进行发送。(5) 用顺控程序确认发送完成后,使发送请求为 OFF。(6) 2ET 模块在发送请求为 OFF 后,使发送完成为 OFF。• 顺控程序例 下面表示文件存储器发送的顺控程序例。条件: 发送 D0100~D04FD 的 2044 字节数据。传输数量数据在 D04FE 中设置。(D04FE=07FCh)连接 No.=1链接 No.=1通过资料 3 的顺控程序例可以看出,控制输入输出信号被分配在 K00~K68 上。3-77其他节点
      V006(仅第 1 扫描为 ON 的 特殊继电器)[ WMOV 1002 → R021 ] (链接 No.1,2 字节传输)[ WMOV 29FC → R022 ] (D04FE 的间接地址 (29FCh=2000h+4FEh×2)[ WMOV 1000 → R023 ] (文件存储器发送区域 传输数量地址)[ WMOV 13FE → R024 ] (链接 No.1,1022 字节传输)[ WMOV 2200 → R025 ] (D0100(L)的间接地址 (2200h=2000h+100h×2)[ WMOV 1002 → R026 ] (文件存储器发送数据区域起始地址)[ WMOV 13FE → R027 ] (链接 No.1,1023 字节传输)[ WMOV 25FE → R028 ] D02FF(L)的间接地址 (25FFh=2000h+2FFh×2)                  [ WMOV 1400 → R029 ][ WMOV 07FC → D4FE (传输数量数据设置)[ SPW R021, R022 → R023 (写入传输数量数据文件存储器)[ SPW R024, R025 → R026 (写入发送数据前半部文件存储器)[ SPW R027, R028 → R029 (写入发送数据后半部文件存储器)] ] ] ]         (文件存储器发送数据区域后半部起始地址)  V90 K38 P004发送执行条件连接 1 开放正常  K10          连接 1 发送请求 ONR 连接 1K10 发送请求 OFF S     K48 P005 连接 1发送完成 注:在 PC10G 以外的 CPU 中,用 SPW 命令可一次性传输的数据数量最大为 1023(3FFH)字节,因此, 读入超出此字节数的数据时,如下例所示,请分 2 次执行 SPW 命令。通过此顺控程序来发送 D0100~D04FE 的数据时,可如下例所示那样发送数据。3-78
3.6.3.200. 01. 02. 03 ------------------------- 0F. 10. 11 FA. FB发送异常时的操作发送完成信号在将发送数据传输给通信模块后变为 ON。但是,在此阶段,发送数据并未发送到网络上(并不意味着从其他节点的 ACK 接收)。在 TCP/IP 中,TCP 重传期间请求下一个数据的发送时,发送数据将会在发送缓存内等待。而且,进行下一个发送请求时,该数据将在发送缓存内与前一个数据合并后保存。最初的数据经过重传被发送走之后,TCP 重 传期间处于等待状态的发送数据将在最大分段长度的范围内,全部合并起来进行发送。连续进行发送时,就会形成上述操作,所以,数据的发送最好是编制一个通信程序,以便于在每次发送后,接 收其他节点的响应数据(交替进行发送)。D0100=0100 D0102=0504 D0104=0908 D0106=0D0C D0108=1110D0101=0302 D0103=0706 D0105=0B0A D0107=0F0E发送数据传输数量数据 D04FD=FBFA D04FE=07FC时的发送数据如下所示。   CPU 模块 2ET 数据 1其他节点       发送完成 ON 数据 2发送完成 ON 数据 3发送完成 ON发送完成 ON 数据 5发送完成 ON发送完成 ON数据 1数据2数据 2数据 2数据 2ACK          ×××××TCP 重传中                数据 4数据 2          ACKACKACK         数据 6数据 2数据 5数据 4数据 3       数据 6   3-79
3.6.4 通用通信接收 3.6.4.1 接收步骤通过顺控程序从 2ET 模块中进行通用通信方式(模式 1)的接收时,将根据以下步骤进行。文件存储器的地址 请参照 2ET 使用说明书“资料 2 文件存储器地址映射表”。    接收确认标志CPU → 2ET接收完成标志2ET→ CPU(1) 由其他节点接收数据。(3)(5)(7)                  (1)(2)(6)  (2) 2ET 模块在将接收数据保存到文件存储器中后,使接收完成为 ON。其他节点(3) 用顺控程序确认接收完成为 ON 后,用应用命令 SPR 读出接收数据规模、报头等信息,将所有数据完整 收取下来。(4) 所有数据接收完成后,使接收确认为 ON。(5) 2ET 模块使接收完成为 OFF。(6) 用顺控程序检测到接收完成为 OFF 后,用应用命令 SPR 将文件存储器的内容读出。(7) 使接收确认为 OFF。接收数据在文件存储器中有空间时,会立即保存到文件存储器中。接收完成标志为 ON 时,表示文件存储器中 存在有效数据。根据需要,用 SPR 命令读出接收规模、数据部的报头信息等,并确认所有数据的已完成接收 后,使接收确认为 ON。接收确认为 ON 后,接收完成会变为 OFF,因此,会在此时从文件存储器中读出接收 数据。读出接收数据完成后,使接收确认为 OFF。接收确认标志为 OFF 后,文件存储器中的数据将被丢弃(传 输数量将变为=0)。在接收确认标志为 ON 期间,即使接收到新的数据,2ET 也不会变更文件存储器中的数据。为了使文件存储器 在读出过程中无法进行变更,请将接收确认标志设为 ON,接收数据的读出请在接收完成标志为 OFF 之后再 执行。3-80(4) 
3.6.4.2分割数据的接收数据在发送侧进行分割时(其他节点试图发送大于最大分段长度的数据时等),分割后的接收数据到达有时间 差,文件存储器中的数据保存时间无法做到同时。在这种情况下,接收完成标志将在最初的数据保存到文件存 储器内时就变为 ON。接收完成并不保证其他节点分割发送的所有数据全部到达。所有数据的接收完成请通过 接收容量及数据部的报头信息等进行判断。 在数据 1 保存时,接收 完成标志为 ONCPU 寄存器SPR所有数据接收确 认后,接收确认 标志为 ON 之后 读出通过接收确认的 ON→OFF,文件存储器内 所有数据将变为禁用接收缓存   文件存储器接收区域  传输数量 接收数据 1 接收数据 2空      接收数据 1 接收数据 2   有效数 据容量    接收数据   3.6.4.3CPU停止RUN时的接收数据CPU 停止 RUN 时,接收的数据将一直保存在文件存储器中。直接启动 CPU 时,文件存储器中的内容将会保留。重置启动 CPU 时,2ET 将进行初始化,在此之前接收的 数据将被丢弃。3-81接收确认为 OFF 后,接收数据就 会立即进行传输。接收确认为 ON 时,在接收缓存中 处于等待状态。
3.6.4.4顺控程序例 下面表示文件存储器接收的顺控程序例。条件: 将 2044 字节的接收数据读出到寄存器 D0800~D0BFD 中。 接收传输数量读出到 D07FF 中。连接 No.=1链接 No.=1控制输入输出信号分配到 K00~K68 中。 (链接 No1,2 字节)(连接 1 文件存储器接收区域起始地址)(D07FF 间接地址)(链接 No1,2044+2 字节)       接收完成 接收确认 链接命令可使用接收确认 接收完成(是否已接收到 2044 字节) 接收完成 接收确认 链接命令可使用有效数据保存到文件存储器中后,读出传输数量确认所有数据都保存到文 件存储器中后,接收确认 ON接收完成为 ON 后,从文件 存储器中读出数据接收确认为 OFF          (将接收数据读出到 D0800 中) 3-82
3.6.4.5  文件存储器中的数据读出延迟时的操作读出文件存储器内的数据之前接收了新的数据时,如果文件存储器内有空间,就会和之前的数据合并起来,保 存在文件存储器中。文件存储器已满(2044 字节)时,之后的新数据不会被丢弃,而在接收缓存上等待文件 存储器变空。在此期间接收到多个新数据时,会在接收缓存上与留在缓存中的数据进行合并。一直未能读出文 件存储器内的数据,而接收缓存用尽时,将对其他节点进行流量控制。在 TCP 中,窗口容量将变为 0,并停 止来自其他节点的发送。在 UDP 中,会发送 ICMP Source Quench 的响应,数据将被丢弃。a) 顺序读出过程中接收到多个数据时  数据 1数据 2数据 3数据 4数据 5数据 6 在接收缓存内数据合并                数据 2  接收缓存文件存储接收完成接收确认在文件存储器中合并数据 1数据 3数据 3,4数据 3, 4, 5数据 6      数据 1 数据 1, 2 数据 3, 4, 5 数据 6                           接收数据的获取接收数据的获取  3-83数据 1, 2数据 3, 4, 5
b) 接收缓存用尽时(TCP) 接收缓存(约 4K 字节)用尽 时,窗口容量为 0 的通知接收缓存恢复后,通知 空出的容量      数据 2c) 接收缓存用尽时(UDP)数据3 数据4 数据5 数据6数据6MAX2044 字 节的容量 数据 1                   接收缓存文件存储接收完成 接收确认接收数据将进行合并MAX2044 字节 的容量接收数据获取数据 1数据 2数据 23数据 234数据 2345         数据 1 数据 2, 3a 数据 3b, 4, 5, 6                         数据 1接收缓存(约 4K 字节)用尽 时,接收数据将不会保存到缓 存中而被丢弃。数据3 数据4 数据5 数据6丢弃接收数据将进行合并数据 2, 3a 注: CPU 停止 RUN 后接收数据时,接收缓存将会用尽而进行 b)、c) 的操作。数据 2, 3a发出 ICMPSourceQuench 的通知数据7MAX2044 字 节的容量  数据 1数据 2                    接收缓存文件存储接收完成 接收确认MAX2044 字节 的容量接收数据获取         数据 1 数据 2, 3a 数据 3b, 4, 5, 7                          重置启动 CPU 时,以太网模块会进行初始化,所以,接收数据会被丢弃。仅进行启动时,有效数据会 保留在文件存储器以及接收缓存中,因此,要想接收新的数据,就必须用顺控程序将保留的数据全部读 出后丢弃。TCP 时,即使连接重新开放,也能进行丢弃。3-84数据 1数据 3b456以 2044 字节为 界进行分割   数据 3b45以 2044 字节为 界进行分割        数据 1数据 2数据 23数据 234数据 2345数据 3b45数据 3b457 
3.7 以太网的异常通告 3.7.1 异常分类2ET 模块所通告的异常分类为以下几个种类。(1) 硬件异常 ········在 2ET 模块发生故障时或与 CPU 模块的存取无法正常进行时发生。在 2ET 模块的 LED 中显示“H*”(*=0~F),在 CPU 模块中发生“特殊模块异常”(错误代 码:84)。请参照“3.7.2 硬件异常”。(2) 链接参数异常···在 CPU 模块中设定的链接参数的链接模块中有异常时发生。在 CPU 模块中发生“链接模块分配异常”(错误代码:89),在 2ET 模块的 LED 中显示。注意: 发生异常的仅是链接模块名称异常。链接参数的“详细设定”或用顺控程序的 SPW 命令写入的 IP 地址 等设定数据中有异常时,就是(3)通信异常。(3) 通信异常 ········在通信参数(参照 3.2.4 章)或顺控程序有异常时发生。 通信参数有异常时,在 2ET 模块的 LED 中显示 。                   (4) 连接异常在 CPU 模块中发生“通信异常”(错误代码:86),可在 S3*0 地址之后设置详细数据。 (*将根据 2ET 模块的链接 No.来确定)请参照“3.7.4 通信异常”。······· 与对方节点的通信上出现错误时会发生。发生连接异常时,会在文件存储器中设置连接错误代码,且连接异常标志为 ON。 各连接的连接错误代码也可以在监视器区域中读出。(参照 3.1.6)如下图所示,2ET 模块的 LED 中将以 1 秒的间隔依次显示发生错误的连接 No.和错误代 码。例: 在连接No.1中发生“因TCP重传超时引起的连接重置”(错误代码: 4013)时。连接 No. 错误代码 连接开放状态 发生连接异常时,文件存储器的连接异常标志将变为 ON,并在文件存储器中设置连接错误代码。即使发生连接异常,CPU 模块中也不会发生异常。 请参照“3.7.5 连接异常”。                            3-85
(5) 线路异常 ········如果在电源接入或重置/启动时,线路尚未处于可使用的状态,则 LED 将显示如下图。    (SW1-3=OFF 10 Mbps 时) (SW1-3=ON 自动协商时) 出现这种情况时,有可能是以下的原因。(1) 电缆未连接,或接触不良。(2) 通信电缆对方的设备(HUB或计算机等)尚未启动。 (3) 使用了交叉线与HUB进行连接。(4) 使用了直通线与计算机等终端设备直接连接(5) 电缆断线(6) 2ET模块故障注: 以太网的 LAN 电缆中,有直通线和交叉线 2 种。与 HUB 连接时,使用直通线,与对方设备 1 对 1 直接连接时,使用交叉线。(6) 没有初始数据···· 电源接入或重置/启动后,如果没有从 CPU 模块中接收到 IP 地址等初始数据,则 LED 将显示如下图。         出现这种情况时,有可能是以下的原因。(1) 通过顺控程序进行初始化时,使文件存储器的初始化请求标志为ON的顺控程序有错误,或程序尚未安装。(2) 通过链接参数进行初始化时,未选择“InitializationbasedonLinkParameters(通过链接参数进行初始化)”。          3-86
3.7.2 硬件异常因 2ET 模块异常或周边设备故障等而无法正常动作时会发生。2ET 模块前面的 LED 中会显示错误代码,因此,请参照下表进行处置。    以太网模块的 LED 显示   异常内容    原因与处置方法       H0      RAM 异常     有可能是以太网模块异常。请更换模块。        H1 闪存存储器 异常     H2      EEPROM 异常    H3    Ethernet 异常    HF    应用程序 加载异常    H5 命令不一致   是一种因以太网模块或 CPU 模块、基板、I/O 电缆的故障等,而无法正常进行以太网模块与 CPU 模块之间数据交换的状态。CPU 模块中发生错误代码 84 以外的错误时,请进行 CPU 模块的故障 排除。CPU 模块中发生错误代码 84 的错误,且该错误在在其他通信模块中发 生时,请进行其他模块的故障排除。 错误不能解决时,请依次更换以太网模块、CPU 模块、I/O 电缆、基板。       Hd      系统失控    H9       从 CPU 无命令应答       是一种因以太网模块或 CPU 模块、基板、I/O 电缆的故障等,而无法正 常进行以太网模块与 CPU 模块之间数据交换的状态。CPU 模块中发生错误代码 84 以外的错误时,首先请进行其故障排除。 CPU 模块中发生错误代码 84 的错误,且该错误在在其他通信模块中发 生时,首先请进行其故障排除。 错误不能解决时,请依次更换以太网模块、CPU 模块、I/O 电缆、基板。   经由网络从以太网模块对其他层次结构的 PLC 进行通信时,长时间持 续处于设备电源掉电等,与连接设备的通信无法正常进行的状态时会发 生。发生此异常时,请在进行分层通信的网络能够正常通信的状态下, 重置/启动 CPU 模块。   3.7.3 链接参数异常 链接参数的链接模块名称中有错误时会发生。请将链接模块名称设定为“Ethernet (32Port)(以太网)”。 3-87
3.7.4 通信异常2ET 模块中设定的通信参数中有错误时,以及以文件存储器方式进行通信时的发送字节数量超出范围时会发生。 CPU 模块中发生错误 86。错误的详细代码根据 2ET 模块的链接 No.,保存在不同的 CPU 模块特殊寄存器的以下地址中。   链接 No.  错误代码 详细数据 1    详细数据 2   详细数据 3   1   S310  S311     S312     S313    2 S330S331  S332 S333   3  S350 S351    S352   S353   4   S370  S371     S372     S373    5 S390S391  S392 S393   6  S3B0 S3B1    S3B2   S3B3   7   S3D0  S3D1     S3D2     S3D3   8 S3F0S3F1   S3F2 S3F3 请参考下页的表进行处置。3-88
 通信异常错误代码表     错误代码    内容   详细数据 1     详细数据 2     详细数据 3     处置方法    0113在初始命令中,自身节点 IP 地址为非法 0000  0000 0000 请确认自身节点 IP 地址有无正确设定。 另外,不可设定以下这种 IP 地址。• 网络 ID 的所有位数为 0 或所有位数为 1• 主机 ID 的所有位数为 0 或所有位数为 1• 子网 ID 的所有位数为 0 或所有位数为 1• 最上位字节为 127(7Fh)(参照资料 4)     0114    在初始命令中,网关 IP 地址为非法   0000     0000     0000     请确认网关 IP 地址有无正确设定。    0115在初始命令中,其他节点 IP 地址为非法 0000  0000 0000 请确认其他节点 IP 地址有无正确设定。 另外,不可设定以下这种 IP 地址。• 网络 ID 的所有位数为 0 或所有位数为 1• 主机 ID 的所有位数为 0 或所有位数为 1• 子网 ID 的所有位数为 0 或所有位数为 1• 最上位字节为 127(7Fh)(参照资料 4)     0116 在初始命令中,其他节点端口 No.(TCP)为非法  0000    0000   0000   请确认其他节点端口 No.有无正确设定。端口 No.必须为 0401h~FFFEh(1025~65534)。     0117    在初始命令中,协议为非法   0000     0000     0000     请确认协议(TCP:00 或 UDP:01)有无正确设定。    0118在初始命令中,模式为非法 0000  0000 0000 协议为 TCP 时,请确认模式(主动:00/对方特定被动:01/对方不特 定被动:02)有无正确写入文件存储器中。     0119    在初始命令中,自身节点端口 No.(TCP)为非法   0000     0000     0000     请确认自身节点端口 No.有无正确设定。端口 No.必须为 0401h~FFFEh(1025~65534)。    011A在初始命令中,其他节点表 No.为非法 0000  0000 0000 请确认其他节点端口 No.有无正确设定。另外,请确认所指定的表在初始参数的“表使用”中,有无设定在“使用” 上。     011B 在初始命令中,自身节点端口 No.(TCP)重复  0000    0000   0000   请确认自身节点端口 No.有无重复设定。     011C    在初始命令中,自身节点端口 No.(UDP)重复   0000     0000     0000     请确认自身节点端口 No.有无重复设定。    011D在初始命令中,重传计时器(数据)值为非法 0000  0000 0000 请确认计时器值是否在规定的范围内。     011E 在初始命令中,重传计时器(SYN,FIN)值为非法  0000    0000   0000   请确认计时器值是否在规定的范围内。     011F  在初始命令中,关闭计时器值为非法   0000    0000   0000    请确认计时器值是否在规定的范围内。 3-89
     错误代码    内容   详细数据 1     详细数据 2     详细数据 3     处置方法    0120在初始命令中,数据包生存时间为非法 0000  0000 0000 请确认计时器值是否在规定的范围内。     0121    在初始命令中,IP 组合计时器值为非法   0000     0000     0000     请确认计时器值是否在规定的范围内。    0125   在初始命令中,子网掩码为非法  0000   0000   0000   请将子网掩码的 1/0 变化设置为一处。 (参照资料 4)    0126在初始命令中,网关 IP 地址未进行设定 0000  0000 0000 请设定网关 IP 地址,或确认自身节点 IP 地址及其他节点 IP 地址中有 无错误。(参照资料 4)     0127 在初始命令中,重传次数为非法  0000    0000   0000   请确认重传次数是否在规定的范围内。     0134 主动开放命令的其他节点表 No.无效  连接No.    0000   0000   是在 TCP 主动所指定的连接中,“其他节点表 No.”未进行设定的异常。 请确认“其他节点表 No.”是否正确,及指定的表有无设定为“使用”。     2080    初始数据的响应计时器值异常   0000     0000     0000     请确认计时器值是否在规定的范围内。    2081初始数据的无接收计时器值异常 0000  0000 0000 请确认计时器值是否在规定的范围内。     2082 发送数据传输数量异常  连接No.    传输数量   0000   请确认发送数据区域顶部的传输数量数据是否为 0 或超出了 2044 (7FCh),及传输数据数量有无正确地写入文件存储器中。     2085    文件接收完成时,接收确认标志业已为 ON   连接No.     0000      0000     请确认是否仍然处于接收确认标志为 ON 的状态。  3-90
3.7.5 连接异常 从对方节点接收的数据中有异常时等会发生。    发生连接异常时,用以下的方法进行通告。(1) 通过 LED 进行显示在模块前面的 LED 上,按照[发生异常的连接 No.]→[连接异常代码上位]→[连接异常代码下位]的顺 序进行显示。例:在连接 No.1 中发生“因 TCP 重传超时引起的连接重置”(错误代码:4013)时连接 No. 错误代码 连接开放状态(2) 通过状态监视器进行通告在 CPU 模块的特殊寄存器的以下区域保存连接异常代码。错误解除后,保存“00”。 可用特殊寄存器进行监视的连接为 1~8。9~32 请使用 SPR2 命令来对状态进行监控。                                   链接 No.连接错误代码保存区域                1S308~S30FS3*8连接 1:连接异常代码               2S328~S32F       3S348~S34F       4S368~S36F       5S388~S38F          6S3A8~S3AF  可通过用周边设备对该区域进行监控,来读取连接异常代码。(3) 通过文件存储器进行通告在文件存储器的连接异常代码区域中保存错误代码。 要想将其读出,必须通过顺控程序的 SPR 命令,在 I/O 寄存器上将数据读出。 (参照资料 1、资料 2)未发生连接异常时,错误代码为 0000。另外,发生连接异常时,有时还会向对方节点发送错误响应。请参考下页之后的连接异常错误代码表进行处置。3-91S3*9连接 2:连接异常代码       S3*A连接 3:连接异常代码       S3*B连接 4:连接异常代码       S3*C连接 5:连接异常代码    S3*D连接 6:连接异常代码              7S3C8~S3CFS3*E连接 7:连接异常代码              8S3E8~S3EFS3*F连接 8:连接异常代码         
3.7.5.1连接异常错误代码表关于表中的符号“(1)~(4), **, ***” • 异常处置内容“(1)~(4)”发生异常时,2ET 模块将进行1~4所指定的处置。 (1) 连接异常代码写入,连接异常标志 ON(2) 连接重置(3) 向对方节点发送错误响应数据(4) 将 RC 设置在 10 上,并返回以下的错误响应数据。 “80.10.01.00.□□”(□□:错误代码) 错误代码的内容请参照错误响应数据错误代码表(3.7.5.2 章)。• 错误响应数据“**, ***” 将错误响应数据的帧的类型(FT)设定为以下数据发送。 **: 针对文件存储器接收的错误响应时,**=E0针对计算机链接命令的错误响应时,**=80***: 将接收到的帧的类型(FT)数据的最上位位数设定为1的数据(i)连接为 TCP 被动时  内容  处置     连接异常 代码  发送给对方节点的错误响应  数据   异常清除的时间   发生异常的原因和处置方法  文件存储器发送 响应数据接收超时  (1) (2)     4002  -   发送请求标志的 OFF   从 2ET 模块发送文件存储器数据后,来自对方节点的响应在初始参数的“响 应计时器”(默认值为 6 秒)时间内未返回时会发生。 请确认在对方节点侧 有无正常进行文件存储器的处理。  文件存储器发送字节数量异常   (1)      4003     -    发送请求标志的 OFF     文件存储器的发送字节数量中有异常时会发生。 请确认文件存储器发送数据 区域顶部的传输数量。   无法接收与传输数量同等数量的数据  (1) (2) (3)   4004    **.05   从对方节点开放   接收到文件存储器数据或计算机链接命令后,传输数量数据(LL、LH)大于 实际发送的数据数量时,以及数据在中途中断时会发生。请确认传输数量数 据是否正确,及 1 帧的数据有无全部发送。  3-92
  内容   处置      连接异常 代码     发送给对方节点的错误响应  数据    异常清除的时间     发生异常的原因和处置方法   接收数据的帧格式异常(FT 异常) (1) (2) (3)  4005 ***.01 从对方节点开放 在计算机链接方式或文件存储器方式中,接收数据的顶部数据(FT:帧的类型)异常时会发生。FT 必须是以下的其中一种。FT=00(计算机链接命令),FT=60(文件存储器发送),FT=E0(文件存 储器接收确认响应)使用通用通信方式时,通用通信功能启用切换未完成时会发生。  接收数据的帧格式异常(RC 异常)   (1) (2) (3)      4005     **.02    从对方节点开放     接收到文件存储器或计算机链接命令后,接收数据的第 2 个数据(RC:响应 代码)为 00 以外时会发生。请确认发送数据。   接收数据的帧格式异常(传输数量异常) (1) (2) (3)  4005 **.03 从对方节点开放 接收数据的传输数量数据(LL、LH)为 0000,或超过 1274 字节时(计算 机链接命令),或者超过 2044 字节时(文件存储器发送,通用通信发送) 会发生。请确认发送数据。  计算机链接命令的处理尚未完成,又接收到了下一个计算机链接命令   (1) (2) (3)      4006     80.06    从对方节点开放     在接收计算机链接命令,并返回对此的响应之前,又接收到下一个计算机链 接命令时会发生。请确认计算机链接发送的时间。   文件存储器接收的处理尚未完成,又接收到了下一个文件存储器数据。 (1) (2) (3)  4007 E0.07 从对方节点开放 在接收文件存储器数据,并返回对此的响应之前,又接收到下一个文件存储 器数据时会发生。请确认文件存储器数据发送的时间。  中继命令格式异常   (1) (2) (3)      4008     80.04    从对方节点开放     中继命令的传输数量或 ENQ 代码异常时会发生。 请确认中继命令的内容。   文件存储器发送处理过程中,连接被重置或关闭  (1)   4009    -  发送请求标志的 OFF   文件存储器发送处理过程中,连接被重置或关闭时会发生。   无接收计时器超时  (1) (2)   4010    -  从对方节点开放   超出了在初始参数的“无接收计时器”(默认值 00:无设定)中设定的时间而 未能接收到来自对方节点的数据时会发生。请修改无接收计时器的设定。   因 TCP 重传超时而对连接进行了重置。 (1) (2)  4013 - 从对方节点开放 以初始参数的“重置等待重传次数”中指定的次数进行过通信的重试后,仍不 能从对方节点接收到接收确认(ACK 信号)时会发生。 对方节点的电源 OFF 及电缆断线时等会发生。(参照 3.2.4 章) 以通用通信方式来不及进行对方节点的接收处理时会发生。  根据来自同一 IP 地址其他端口的多重连 接开放请求,对现连接进行了重置  (1) (2)     4014  -   从对方节点开放   在 TCP、对方不特定被动开放中指定的连接处于开放状态下,从其他节点有 在同一端口中开放的请求时,将对当前正在开放的连接进行重置。 之后,再 次从其他节点有开放的请求时,与该节点的连接就会开放。(参照 3.2.4 章)  从对方节点针对文件存储器发送的错误响 应接收[++=响应代码:RC]   (1) (2)      30++     -    发送请求标志的 OFF     发送文件存储器数据,并从对方接收到的响应代码(RC)不为 00 时会发生。 请确认响应数据。   在计算机链接命令处理中,从 J-CPU 中接 收到了 NAK 响应 (3)  -  (4) -  接收到的计算机链接命令的内容中有任何异常,且未能正常处理时会发生。 请确认计算机链接命令的内容。 3-93
  内容  处置     连接异常 代码  发送给对方节点的错误响应  数据   异常清除的时间   发生异常的原因和处置方法  上述以外的连接异常  (1) (2)     013+   -   从对方节点开放    从对方节点接收到非法的开放请求、关闭请求时会发生。请确认对方节点的 通信程序。 (ii)连接为 TCP 主动时  内容   处置      连接异常 代码      发送给对方节点的错误响应数据     异常清除的时间     发生异常的原因和处置方法   主动开放失败 (1)  4001 - 开放请求标志的 OFF 向对方节点的主动开放未能实现时会发生。请确认线路有无正确连接、对方节点有无启动、自身节点与对方节点 IP 地址 的网络 ID 是否相同(参照资料 4)等。  文件存储器发送 响应数据接收超时  (1) (2)     4002   -   发送请求标志的 OFF   从 2ET 模块发送文件存储器数据后,来自对方节点的响应在初始参数的“响 应计时器”(默认值为 6 秒)时间内未返回时会发生。 请确认在对方节点侧 有无正常进行文件存储器的处理。  文件存储器发送字节数量异常   (1)      4003      -     发送请求标志的 OFF     文件存储器的发送字节数量中有异常时会发生。 请确认文件存储器发送数据 区域顶部的传输数量。   无法接收与传输数量同等数量的数据  (1) (2) (3)   4004    **.05   开放请求标志的 OFF   接收到文件存储器数据或计算机链接命令后,传输数量数据(LL、LH)大于 实际发送的数据数量时,以及数据在中途中断时会发生。请确认传输数量数 据是否正确,及 1 帧的数据有无全部发送。   接收数据的帧格式异常(FT 异常) (1) (2) (3)  4005 ***.01 开放请求标志的 OFF 在计算机链接方式或文件存储器方式中,接收数据的顶部数据(FT:帧的类 型)异常时会发生。FT 必须是以下的其中一种。 FT=00(计算机链接命令),FT=60(文件存储器发送),FT=E0(文件存 储器接收确认响应) 使用通用通信方式时,通用通信功能启用切换未完成时会发生。  接收数据的帧格式异常(RC 异常)   (1) (2) (3)      4005      **.02     开放请求标志的 OFF     接收到文件存储器或计算机链接命令后,接收数据的第 2 个数据(RC:响应 代码)为 00 以外时会发生。请确认发送数据。   接收数据的帧格式异常(传输数量异常) (1) (2) (3)  4005 **.03 开放请求标志的 OFF 接收数据的传输数量数据(LL、LH)为 0000,或超过 1274 字节时(计算 机链接命令),或者超过 2044 字节时(文件存储器发送,通用通信发送) 会发生。请确认发送数据。  计算机链接命令的处理尚未完成,又接收到了下一个计算机链接命令   (1) (2) (3)      4006      80.06     开放请求标志的 OFF     在接收计算机链接命令,并返回对此的响应之前,又接收到下一个计算机链 接命令时会发生。请确认计算机链接发送的时间。   文件存储器接收的处理尚未完成,又接收到了下一个文件存储器数据。  (1) (2) (3)   4007    E0.07   开放请求标志的 OFF   在接收文件存储器数据,并返回对此的响应之前,又接收到下一个文件存储 器数据时会发生。请确认文件存储器数据发送的时间。  3-94
  内容  处置     连接异常 代码   发送给对方节点的错误响应数据   异常清除的时间   发生异常的原因和处置方法  中继命令格式异常   (1) (2) (3)      4008      80.04     开放请求标志的 OFF     中继命令的传输数量或 ENQ 代码异常时会发生。 请确认中继命令的内容。   文件存储器发送处理过程中,连接被重置或关闭 (1)  4009 - 发送请求标志的 OFF 文件存储器发送处理过程中,连接被重置或关闭时会发生。  无接收计时器超时  (1) (2)     4010   -   开放请求标志的 OFF   超出了在初始参数的“无接收计时器”(默认值 00:无设定)中设定的时间而 未能接收到来自对方节点的数据时会发生。请修改无接收计时器的设定。  连接被从对方节点关闭   (1)      4011      -     开放请求标志的 OFF     从自身节点通过主动开放将连接开放后,连接被从对方节点关闭时会发生。   连接被从对方节点重置  (1)   4012    -   开放请求标志的 OFF   从自身节点通过主动开放将连接开放后,连接被从对方节点重置时会发生。   因 TCP 重传超时而对连接进行了重置。 (1)  4013 - 开放请求标志的 OFF 以初始参数的“重置等待重传次数”中指定的次数进行过通信的重试后,仍不 能从对方节点接收到接收确认(ACK 信号)时会发生。 对方节点的电源 OFF 及电缆断线时等会发生。(参照 3.2.4 章) 以通用通信方式来不及进行对方节点的接收处理时会发生。  从对方节点针对文件存储器发送的错误响 应接收[++=响应代码:RC]  (1) (2)     30++   -   发送请求标志的 OFF   发送文件存储器数据,并从对方接收到的响应代码(RC)不为 00 时会发生。 请确认响应数据。  在计算机链接命令处理中,从 J-CPU 中接 收到了 NAK 响应   (3)      -      (4)     -     接收到的计算机链接命令的内容中有任何异常,且未能正常处理时会发生。 请确认计算机链接命令的内容。   连续开放  (1) (2)   0132    -   开放请求标志的 OFF   发送处理中,发送完成标志为 OFF,且再次进行发送处理时会发生。发生后, 请重置 CPU 模块。请修改程序,以确保发送请求标志在发送完成或发生连 接异常后为 OFF。   (iii)连接为 UDP 时  内容     处置     连接异常 代码     给对方节点的错误响应数据     异常清除的时间     发生异常的原因和处置方法   文件存储器发送 响应数据接收超时  (1) 4002 - 发送请求标志的 OFF 从 2ET 模块发送文件存储器数据后,来自对方节点的响应在初始参数的“响 应计时器”(默认值为 6 秒)时间内未返回时会发生。 请确认在对方节点侧 有无正常进行文件存储器的处理。  文件存储器发送字节数量异常     (1)     4003     -     发送请求标志的 OFF     文件存储器的发送字节数量中有异常时会发生。 请确认文件存储器发送数据 区域顶部的传输数量。   无法接收与传输数量同等数量的数据   (3)      **.05   -   接收到文件存储器数据或计算机链接命令后,传输数量数据(LL、LH)大于 实际发送的数据数量时,以及数据在中途中断时会发生。请确认传输数量数 据是否正确,及 1 帧的数据有无全部发送。  3-95
  内容     处置     连接异常 代码     给对方节点的错误响应数据     异常清除的时间     发生异常的原因和处置方法   接收数据的帧格式异常(FT 异常)  (3)  ***.01 - 在计算机链接方式或文件存储器方式中,接收数据的顶部数据(FT:帧的类 型)异常时会发生。FT 必须是以下的其中一种。FT=00(计算机链接命令),FT=60(文件存储器发送),FT=E0(文件存 储器接收确认响应) 使用通用通信方式时,通用通信功能启用切换未完成时会发生。  接收数据的帧格式异常(RC 异常)     (3)          **.02     -     接收到文件存储器或计算机链接命令后,接收数据的第 2 个数据(RC:响应 代码)为 00 以外时会发生。请确认发送数据。   接收数据的帧格式异常(传输数量异常)  (3)  **.03 - 接收数据的传输数量数据(LL、LH)为 0000,或超过 1274 字节时(计算 机链接命令),或者超过 2044 字节时(文件存储器发送)会发生。请确认 发送数据。  计算机链接命令的处理尚未完成,又接收到了下一个计算机链接命令    (3)      80.06   -   在接收计算机链接命令,并返回对此的响应之前,又接收到下一个计算机链 接命令时会发生。请确认计算机链接发送的时间。  文件存储器接收的处理尚未完成,又接收到了下一个文件存储器数据。    (3)      E0.07   -   在接收文件存储器数据,并返回对此的响应之前,又接收到下一个文件存储 器数据时会发生。请确认文件存储器数据发送的时间。  中继命令格式异常     (3)          80.04     -     中继命令的传输数量或 ENQ 代码异常时会发生。 请确认中继命令的内容。   从对方节点针对文件存储器发送的错误响 应接收[++=响应代码:RC]  (1) 30++ - - 发送请求标志的 OFF 发送文件存储器数据,并从对方接收到的响应代码(RC)不为 00 时会发生。 请确认响应数据。  在计算机链接命令处理中,从 J-CPU 中接 收到了 NAK 响应     (3)     -     (4)     -     接收到的计算机链接命令的内容中有任何异常,且未能正常处理时会发生。 请确认计算机链接命令的内容。  3-96
3.7.5.2错误响应数据 错误代码表 用计算机链接命令返回错误响应“80.10.01.00.”(:错误代码),或以中继命令的响应返回 NAK(异常)应答时,请参考下表来进行命令数据的修 改等。:错误代码11 因为是 CPU 模块的硬件异常,所以不可处理20 中继命令中的固定数据(ENQ)不是“05”21 传输数量异常(中继命令中的传输字节数量中有错误)23 命令代码为非法24 子命令代码为非法25 命令格式的数据字节为非法26 功能调用的运算数数量为非法31 试图在顺序运算中禁止写入的区域内写入,或试图使用顺序运算中禁止执行的功能调用32 在停止持续期间,有禁用的命令发来33 尽管不是调试模式,仍然试图进行调试功能调用34 通过访问禁止设定,禁止进行访问35 由于设定了执行权限定,所以不可执行 *36 由于通过其他装置设定了执行权限定,所以不可执行 *      错误内容                                                        39进行过 I/O 点数参数、I/O 分配的点数参数的写入后,不进行重置,就试图开始扫描3C 在发生严重故障期间,发出了不可执行的命令3D 在其他因素的命令执行中,处理会发生冲突,所以不可执行3E 由于正在进行重置,所以命令无法执行3F 由于处于停止状态,所以命令无法执行40 因读出、写入命令,而导致地址不在范围内,或命令的地址+数据数量偏离地址范围41 字数量或字节数量超出范围42 发来了指定以外的数据43 功能调用的运算数中有错误52 尽管未使用计时器、计数器,却仍然发来了设定值、当前值的读出、写入命令                                        66 70 7273从使用中继命令指定的链接 No.、站号的链接模块中没有应答。 (指定的链接模块不存在或电源为 OFF,或线路有异常等) 用中继命令指定的链接 No.的模块并不可以使用(指定的链接 No.的错误,或链接模块的异常) 从使用中继命令指定的链接 No.、站号的链接模块中没有应答。 (指定的链接模块不存在或电源为 OFF,或线路有异常等)由于在 CPU 模块内向多个中继命令相同的链接模块重复进行发送,所以命令的处理无法进 行。(请再次发送命令)                * 请参照命令 (18) 执行权限定状态读出,或 (19) 执行权限定设定。3-97
4 FL-net4.1 4.1.1FL-net的功能本章中,将就 FL-net 的功能进行说明。FL-net规格    No.   项目   规格    1   物理层   10BASE-T,100BASE-TX    2     传输速度     10Mbps,100Mbps *1    3 最大电缆长度*1 Max 100m(节点-节点之间(1 对 1 连接时)、节点-HUB 之间、HUB-HUB 之 间)总延长距离:Max 2100m(HUB:Max20 台)    4     最大节点数     241(254 站)*2    5 通信功能 数据链接功能消息服务器功能消息客户端功能    6   继电器链路容量   512 文字    7     寄存器链路容量     8192 文字    8   消息数据容量   1024 字节   4.1.2*1 指定 HUB 为自动协商模式。自动协商模式之间相互连接时,将达到 100Mbps。 *2 ( )为包含维护用的字节数量。使用 20 台 FE-SWH08 时的最大节点数量为 122 站。 数据链接规格   No.        项目    规格     继电器链接      寄存器链接    1 链接区域 L000~L7FFL1000~L2FFFM000~M7FFM1000~M17FFX・ Y000~X・ Y7FF EL000~EL1FFF EM000~EM1FFFEX・ EY000~EX・ EY7FF GX・ GY0000~GX・ GYFFFF GM0000~GMFFFF R000~R7FF D0000~D2FFF U00000~U1FFFF EB00000~EB3FFFF   2   链接容量   512 文字   8192 文字   3    每台的发送容量     ↑     ↑    4   通信方式   N:N 方式及 1:N 方式   N:N 方式及 1:N 方式  4-1 4
4.1.3数据链接方式数据链接方式与 N:N 方式(N 对 N 方式)和 1:N 方式(1 对 N 方式)相对应。所谓 N:N 方式,是如下图所示,指某个节点(站)的发送区域,对于其他节点而言即为接收区域,且在 各节点之间共享数据的方式。节点 1 节点 2 节点 3 节点 4在 1:N 方式中,在 1:N 主站中设定的节点与 1:N 子站中设定的节点之间进行通信。 在 1:N 子站之间不进行数据链接。  接收区域 发送区域 发送区域 发送区域 发送区域 接收区域 发送区域 发送区域 发送区域 发送区域 接收区域 发送区域 发送区域 发送区域 发送区域 接收区域                            1:N 主站 1:N 子站 1:N 子站 节点 1 节点 2 节点 3N:N 方式的节点和 1:N 方式还可使其在一个网络中共存。1:N 子站 节点 4   接收区域 发送区域 发送区域 发送区域 发送区域 接收区域 发送区域 接收区域 发送区域 接收区域                  N:N 或 1:N 主站 N:N 或 1:N 主站1:N 子站1:N 子站  发送区域 接收区域 发送区域 发送区域 接收区域 发送区域 发送区域 发送区域 发送区域 接收区域 发送区域 接收区域                    4-2
4.1.4在通信区域中使用输入输出(X、Y)时的注意事项 (1) 请注意 I/O 地址不要与连接在 CPU 上的 I/O 模块重复。重复设定时,CPU 上会发生错误“86(” 通信异常),且 2ET 模块上会发生错误“E6(” 链接参数异常)。—— PC 的 I/O 区域 —— PC 的 I/O 区域与 FL-net 的通信区域重复的区域 —— FL-net 的通信区域(2) 应用命令的输入输出刷新(RIO:FUNNo.=280)、输入刷新(RI:FunNo.=281)、输出刷新(RO: FUNNo.=282)不可用于通信区域。(3) 即使作为发送区域使用,CPU 内的存储也会变为输入。  X/Y000 X/Y000 X/Y000X/Y7FF X/Y7FF X/Y7FF             X/Y000X/Y7FF  在输入输出之间加  入通信区域时X/Y000X/Y7FF输入输出与通信区域重复X/Y000X/Y7FF  在通信区域后有输入输  出时                             4-3可以 × 不可
4.1.5信息服务器功能是针对从其他节点发送的命令消息返回响应的方式。命令处理及响应发送处理由 2ET 模块及 CPU 模块自动进行,因此,不需进行与此功能对应的参数设定 及顺控程序处理。详细内容请参照 4.3.1 章。     命令响应      4.1.6信息终端功能*1是向其他节点发送命令消息,并接收响应的方式。命令数据的生成及向 2ET 的发送指示、响应数据从 2ET 模块向寄存器的读出,将通过顺控程序进行。 详细内容请参照 4.3.2 章。       命令响应    4.1.7其他节点状态读出功能*1可用顺控程序的处理来读出参与 FL-net 通信的其他节点状态。 详细内容请参照 4.3.3 章。*1 消息客户端功能与其他节点状态读出功能可在以下的 CPU 模块中使用4-4
 4.1.8 监控功能可用特殊寄存器 S3*0~S32*F 来监控参与 FL-net 通信的节点(站号 1~254)。特殊寄存器的*、×部根据链接No.来确定。链接No. 12345678* 02468ACE x 13579BDF例如,对 2ET 模块的链接 No.为 3,节点编号为 85(55h)的站的参与状态进行监控时,从上述站号和 位数地址的对应表中可以看出,与 S3*5 的第 5 位相对应,因此,只要看 S345(链接 No.3 时,*=4) 的第 5 位即可。而且,上述区域可通过重置/启动及电源通断的方法进行清除。 另外,2ET 可通过重置,从通信线路上分离,并重新开始通信接入处理。下图表示站号(参数的节点将 10 进制表记改为 16 进制表记)和位数地址的对应表。MSB LSB FEDCBA9876543210S3*0 0F0E0D0C0B0A090807060504030201S3*1 1F1E1D1C1B1A191817161514131211 10S3*2 2F2E2D2C2B2A292827262524232221 20S3*3 3F3E3D3C3B3A393837363534333231 30S3*4 4F4E4D4C4B4A494847464544434241 40S3*5 5F5E5D5C5B5A595857565554535251 50S3*6 6F6E6D6C6B6A696867666564636261 60S3*7 7F7E7D7C7B7A797877767574737271 70S3*8 8F8E8D8C8B8A898887868584838281 80S3*9 9F9E9D9C9B9A999897969594939291 90S3*A AFAEADACABAAA9A8A7A6A5A4A3A2A1 A0S3*B BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1 B0S3*C CFCECDCCCBCAC9C8C7C6C5C4C3C2C1 C0S3*D DFDEDDDCDBDAD9D8D7D6D5D4D3D2D1 D0S3*E EFEEEDECEBEAE9E8E7E6E5E4E3E2E1 E0S3*F FEFDFCFBFAF9F8F7F6F5F4F3F2F1 F0··· S3xF各位数=1:通信中 各位数=0:不参与通信自身节点地址(16 进制)4-5
4.1.9通信状态确认功能 是确认线路状态的功能。可通过此功能,在自身节点所拥有的 Log 信息中读出以下内容。(1) 标记重发次数(2) 标记保持超时次数 (3) 标记监控超时次数读出根据 SPR 命令进行。 链接可使用标志*1执行条件指定将链接 No.设置在上位 4 位数,发送数据的字节数量设置在 下位 12 位数上的寄存器指定从 2ET 模块设置读出地址(4000h 固定)的 寄存器。SPR OP1 OP2 → OP3 指定设置了读出目的地寄存器间接字节地址的                    *1 链接可使用标志如下表所示,设置在每个 2ET 模块的链接 No.上。寄存器。    链接 No.    1 2    3 4   5  6 7    8   链接可使用标志     V90 V92     V94 V96   V98  V9A V9C     V9E 将通信状态读出到寄存器D000~中的顺控程序例 V006      WMOV 100C → R103WMOV 4000 → R104 WMOV 2000 → R105链接 No.1 12 字节线路状态读出地址 (4000h 固定)D000 间接字节地址从 2ET 模块中读出             V90执行条件          SPR R103R104 → R105    4-6
回路例的响应格式  地址     数据容量   内容  +0(D0001・ D0000)      4 字节      标记重发次数   +4(D0003・ D0002)  4 字节 标记保持超时次数  +8(D0005・ D0004)     4 字节    标记监控超时次数 如果上述值总是在计数,则不能说线路的状态为良好。请参考以下的对策示例进行改善。1) 确认 4.4.1 章“错误显示”的“环回测试异常”的内容。2) 通信电缆远离动力线敷设。3) 通信电缆使用指定电缆。4) 使用推荐的 HUB。5) 加大最小允许帧间隔的值。 4.1.10 网络管理信息的读出功能进行网络管理信息的读出。 读出根据 SPR 命令进行。链接可使用标志*1 执行条件指定将链接 No.设置在上位 4 位数,发送数据的字节数量设置在 下位 12 位数上的寄存器来自 2ET 模块的读出地址 指定设置了(8000h 固定)的寄存器。SPR OP1 OP2 → OP3 指定设置了读出目的地寄存器间接字节地址的寄存器。                     *1 链接可使用标志如下表所示,设置在每个 2ET 模块的链接 No.上。   链接 No.      1   2     3   4    5   6  7     8   链接可使用标志   V90V92   V94V96  V98 V9AV9C   V9E4-7
 将网络管理信息读出到D0000 中的顺控程序例 V006      WMOV 1008 → R103WMOV 8000 → R104WMOV 2000 → R105链接 No.1 8 字节网络管理信息读出地址 (8000h 固定)D000 间接字节地址 从 2ET 模块中读出               V90回路例的响应格式  执行条件        SPR R103R104 → R105       地址      数据容量     内容   +0(D0000)  2 字节 刷新周期测量时间(当前值)   +2(D0001)    2 字节   刷新周期测量时间(最大值)   +4(D0002)      2 字节     刷新周期测量时间(最小值)   +6(D0003)   2 字节 最小允许帧间隔 4-8
4.2 4.2.1FL-net的初始设定 初始设定步骤系统启动时的设定步骤请在 FL-net 的参数设定中使用 PCwin2。 开始   I/O 模块的设定请参照“4.2.2 I/O 模块的设定”请参照“4.2.3 链接模块名称的设定”请参照“4.2.4 链接参数详细设定” 请参照“4.2.5 网络设定”(通常不需要由默认值进行变更)   链接模块名称的设定   链接参数详细设定   网络参数的设定  4.2.2I/O模块的设定电源通断或重置启动用 PCwin2 的[Parameter(参数)]→[I/O module setup(I/O 模块的设定)]来设定模块。 请选择“2ET”。安装位置和参数的内容不同时,CPU 模块中会发生错误 48“I/O 表对照异常”。 4-9
4.2.3链接模块名称的设定用 PCwin2 的[Parameter(参数)]→[Link Parameter(链接参数的设定)]来选择分配在 2ET 模块上的链接 No.、并设定机架 No.、插槽 No.和链接模块名称。 设定例链接参数详细设定 在链接模块名称的设定中继续进行详细设定。在此处设定以下的项目。(1) 节点编号(2) 节点名称(3) RUN 停止时的输出状态(4) 其他节点脱离时的输入状态(5) 通信方式(6) 数据链接的设定(7) 网络的设定这些设定值通常由最终用户的网络管理员来指定。 4.2.4 4-10
4.2.4.1 节点号码设定 2ET 模块的站号。设定值为 1~159、168~249,不得与其他节点(FL-net 通信站)重复。节点编号重复时,以后想要加入网络的节点将无法参与通信,模块前面的 LED 上将显示错误代码“E7” (节点编号重复)。4.2.4.2 节点名称用 10 文字以内的半角字母数字来设定 2ET 模块的节点名称。也可以省略此项设定。 设定后的节点名称可作为与来自计算机主机等的“网络参数的读出请求”命令相对的响应数据读出。4.2.4.3 RUN停止时的输出状态针对继电器链接和寄存器链接,设定 CPU 模块的 RUN 停止时的输出状态。 设定在“Clear(清除)”上时,RUN 停止后,数据链接的自身节点发送数据将全部变为 0。 设定在“Hold(保持)”上时,即使 RUN 停止,也会继续发送 RUN 将要停止之前的数据。4.2.4.4 其他节点脱离时的输入状态针对继电器链接和寄存器链接,设定如何处理其他节点从网络上脱离时,从其他节点接收到的区域数据。 设定在“Clear(清除)”上时,从脱离后的节点接收到的区域数据将全部变为 0。 设定在“Hold(保持)”上时,从脱离后的节点接收到的区域数据将保持将要脱离之前的状态。注意: 其他节点未参与通信时,该节点发送的区域数据将为 00(零)。        其他节点参与过通信之后又脱离后,自身节点参与通信时,脱离后的其他节点发送的区域数据也将为 00(零)。另外,在自身节点和其他节点都参与了通信的状态下,其他节点脱离后的数据参照“State of input in other node separation.(其他节点脱离时的输入状态)”的设定。4-11
4.2.4.5通信方式的设定从“N:N or 1:N (Master)(N:N 或 1:N 主站)”、“1:N (Satellite)(1:N 子站)”、“No Datalink (Message only)(不进行数据链接)”中选择一种数据链接方法。(1) N:N 或 1:N 主站所谓 N:N 方式,是指某个节点的发送区域对于其他节点而言即为接收区域,且在各节点之间共享数 据的方式。以 1:N 方式进行通信时的主站也设定为这种模式。将在下一章中详细进行说明。节点 1 节点 2 节点 3 节点 4(2) 1:N 子站是仅与特定的一个站进行数据链接的方式。下图为将节点1设定为“N:Nor1:N(Master() N:N或1:N主站)”,将节点2~4设定为“1:N(Satellite) (1:N 子站)”的例子。将在下一章中详细进行说明。具有在节约子站内存的同时,可共享顺控程序的优点。  接收区域 发送区域 发送区域 发送区域 发送区域 接收区域 发送区域 发送区域 发送区域 发送区域 接收区域 发送区域 发送区域 发送区域 发送区域 接收区域                             N:N 或 1:N 主站 1:N 子站 节点 1 节点 2(3) 不进行数据链接(仅进行消息通信) 是不进行数据链接的模式。参与 FL-net 的通信,仅进行消息通信。1:N 子站 节点 31:N 子站 节点 4  接收区域 发送区域 发送区域 发送区域 发送区域 接收区域 发送区域 接收区域 发送区域 接收区域                  4-12
4.2.4.6数据链接的设定选择“N:N or 1:N (Master)(N:N 或 1:N 主站)”或“1:N (Satellite)(1:N 子站)”后,点击[DataLink(数据 链接)]按钮,设定详细的通信参数。关于可进行数据链接的区域,请参照“4.1.2 数据链接规格”。(1) N:N 或 1:N 主站在 FL-net 的网络中,参与通信的各节点通过共享数据的虚拟存储空间、“公用存储器”来进行收发。 某个节点向公用存储器上发送数据后,其数据可在其他节点上接收,各节点将共享同样的数据。 公用存储器上的发送地址与容量以文字(16 位)单位在各节点上进行设定。 节点编号的大小与发送地址的顺序没有关系。  例)地址 0000 →公用存储器    节点 1 发送区域 节点 10 发送区域节点 3 发送区域         向公用存储器上发送数据的区域必须进行分配,以避免相互重复。 有重复时,其后参与通信的节点前面的 LED 上就会显示“E8”(继电器链接区域的重复)或“E9”(寄 存器链接区域的重复),出现通信异常。例)节点 2 发送区域节点 1 发送区域 节点 10 发送区域节点 3 发送区域    节点 2 的发送区域的一部 分与节点 3 的发送区域有 重复,因此,节点 2 将出 现通信异常。           4-13
在“N:N or 1:N (Master)(N:N 或 1:N 主站)”模式中,使用以下 4 个参数,对究竟从公用存储器的 起始部分,将多大范围的数据从 CPU 模块的寄存器的哪个地址来进行对应,以及自身节点所发送 的区域地址和容量进行设定。公用存储器的地址 0000 与链接区域起始地址相对应。• 链接区域起始地址······················ (1)  用文字单位来设定链接区域起始地址在此设定的地址与公用存储器的地址 0000 相对应• 链接区域文字数量······················ (2)  以文字单位来设定刷新数据的整个区域容量• 发送区域起始地址······················ (3)  以文字单位来设定自站所发送区域的起始地址。• 发送区域文字数量······················ (4)  以文字单位来设定自站所发送区域的容量。PC 内部寄存器公用存储器地址 0000  (1)         发送区域       (2)(3) (4) 接收区域    发送区域  注意: 节点编号和公用存储器上的发送地址及数据容量通常由最终用户的网络管理员来指定。4-14
设定例 1• 继电器链接    (1) (3)(2) (4)   选择上述设定时,寄存器数据和公用存储器的对应将如下所示。 地址L000 (1) L100 (3) L1FFL3FFPC 内部寄存器公用存储器        发送区域 接收区域 发送区域    (4)地址00000010 001F003F          (2)64 文字注意:16 文字                • 寄存器链接公用存储器的地址用文字(16 点)单位表示。 例如,L01W 表示 L010~L01F 的 16 点。  选择上述设定时,寄存器数据和公用存储器的对应将如下所示。(1) (3)(2) (4)     地址R000 (1) R300 (3)R4FF R5FFPC 内部寄存器公用存储器        发送区域  接收区域发送区域   (2)15360000030004FF 05FF          文字文字(4)512                4-15
设定例 2 节点 No.1节点 No.2在 2 个节点上分别进行上述那样的设定时,如下图所示,节点 1 所发送的 L100~L1FF 的数据将通过共 用存储器,进入节点 2 的相同地址中。节点 2 所发送的 L280~L47F 的数据虽然会反映在公用存储器上,但因为节点 1 的链接区域为 L000~L3FF 为止,因此,超过此范围的 L400~L47F 为止的数据将不会读入节点 1,仅有节点 2 的 L280~L3FF 的数据会在节点 1 的相同地址中接收。    地址L000L100L1FF L280L3FF节点 1 数据公用存储器节点 2 数据 地址 L000L100L280L47F L5FF     接收区域 节点 2 数据接 接收区域收区域     节点 1 数据 接收区域  接收区域                                      4-16
各节点的链接区域起始地址不需要相同。将节点 2 的设定如下图那样选择时,节点 1、节点 2 之间的数据交换将如下图那样进行。  地址L000L100L1FF L280L3FF节点1数据公用存储器节点2数据 地址 M100M200M380M57F M6FF   节点 1 数据 接收区域  接收区域       接收区域 节点 2 数据接 发送区域 收区域                                      4-17
设定例 3 节点 No.10  节点 No.128 节点 No.249 如上设定时,将进行如下所示的数据链接。4-18
• 继电器链接节点 10 数据节点 128 数据L000 节点 249 数据 M000     节点 128 发送区域 节点 10 发送区域 接收区域  接收区域 节点 10 发送区域 节点 128 发送区域 接收区域 节点 254 发送区域X400X600 X700 X7FF注意:• 寄存器链接L200L2FFM200M300M3FFD000D400D500D6FFD7FF                          R000节点 10 数据 节点 128 数据D100节点 249 数据继电器链接的地址以 16 位的文字单位进行设定。所谓 X40W,表示 X400~X40F。         节点 128 发送区域节点 10 发送区域  接收区域节点 128 发送区域 节点 254 发送区域 接收区域   节点 10 发送区域 接收区域  R400 D500R500           D600 D6FFR6FF注意: 链接区域与发送区域的关系                           用“Trans. area top addr.(发送区域起始地址)”和“Trans. area words(发送区域文字数量)”指定的发 送区域必须完全包含在用“Link area top addr.(链接区域起始地址)”和“Link area words(链接区域文 字数量)”指定的链接区域内。 例如,下图所示的设定由于发送区域(L300~L47F)超出了链接区域(L000~L3FF),所以无法设定。 (试图设定时,会显示错误信息) 4-19
(2) 1:N 子站在 1:N 子站模式中,仅与用链接参数指定的特定的一个站进行数据链接。 在此模式中,从哪个站号的节点,接收多少文字的数据,以及将此数据保存到哪个寄存器中,另外,自站的数据发送从哪个地址,将多少文字的数据发送到公用存储器*1 的哪里,都用以下的参数进行 设定。• 主站节点编号·························· (1)在 1~249 的范围内指定进行通信的其他站的节点编号。如果在此范围内,则无论什么站号都可    以设定,不必区分与子站节点编号的大小。• 接收区域起始地址···················· (2)    以文字单位来指定保存从主机接收的数据的寄存器起始地址。• 接收文字数量·························· (3)    指定从主站接收的数据文字数量。• 发送文字数量·························· (4) 指定从自站发送的数据文字数量。    (自站发送数据的起始地址接在接收区域最终地址之后)• 公用存储器*1 发送区域起始地址 ·········(5)    指定从自站发送的数据的公用存储器上的地址。*1 所谓公用存储器,是指参与通信的各节点共享数据的虚拟存储空间,FL-net 的数据链接可通过 此公用存储器进行。 PC 内部寄存器公用存储器     (2)地址 0000(5)     发送区域(3) (4)     接收区域    4-20
在整个网络中,进行下图所示的数据链接。 N:N或1:N主站 N:N或1:N主站 1:N子站 N子站 节点1 节点2 节点3 节点4注意: 节点编号和公用存储器上的发送地址及数据容量通常由最终用户的网络管理员来指定。  接收区域 发送区域 发送区域 发送区域 发送区域 接收区域 发送区域 接收区域 发送区域 接收区域                  设定示例 1 选择上图所示的设定时,如下图所示进行数据链接。 PC 内部寄存器公用存储器地址0000用站号指定的主站发送区域 (32 文字)0100     地址L000L20032 文字 20 文字           发送区域      接收区域     注: 无论主站向公用存储器上的哪个地址发送数据, 都会从该地址上接收数据, 因此, 不必设定主站 的发送区域起始地址。4-21
• 用“Recv. words(接收文字数量)”设定的文字数量 <实际的主站发送文字数量 时 → 超出主站发送数据的部分(在下图的例子中为后 8 个文字)将不会被接收。 PC 内部寄存器公用存储器地址0000用节点编号指定的主站的发 送区域(40 文字)0100       地址L000L20032 文字 20 文字         发送区域           •用“Recv. words(接收文字数量)”设定的文字数量 >实际的主站发送文字数量 时→ 在未满主站发送数据的“接收文字数量”的区域(在下图的例子中为后半部分的 16 个文字)中加入 00(零) 数据加入PC 内部寄存器公用存储器 地址0000用站号指定的主站发送区域 (16 文字)0100       地址L000 L20032 文字 零数据加入的区域20 文字         发送区域无法接收 的区域  接收区域             接收区域      注意: 即使公用存储器中的发送区域上下关系发生改变, PLC 内部寄存器的“接收区域”、“发送区域”的 排列也不会改变。 PC 内部寄存器公用存储器      发送区域  发送区域    4-22用站号指定的主站发送区域 (32 文字)
节点 No.100 节点 No.64 节点 No.150 4-23
• 继电器链接节点 100 数据节点 64 数据(子站) L000L1FFL200 L2FF节点 150 数据(子站) M000M1FF M200M2FFX400X5FFX600 X700 X7FF(主站)       节点 100 发送区域  接收区域   接收区域节点 64 发送区域  节点 150 发送区域 节点 100 发送区域 接收区域                          注: 继电器链接的地址以 16 位的文字单位进行设定。所谓 X40W, 表示 X400~X40F。 • 寄存器链接  D000D3FF D500D6FF D780D87F节点 100 数据 (主站)节点 64 数据(子站) D100D4FF D580D67F节点 150 数据(子站) D000D1FF D200D3FF     节点 10 发送区域  接收区域   接收区域 节点 150 发送区域节点 64 发送区域   节点 10 发送区域  接收区域                            4-24
4.2.5 网络设定网络的设定通常不必变更。 除网络管理员有指示时以外, 请勿进行变更。要变更网络的设定, 请点击[Network(网络)]按钮。    4.2.5.1网络地址的设定FL-net虽然使用UDP/IP协议进行通信, 但却将该协议中使用的IP地址的上位3位作为网络地址来设定。 IP 地址的第 4 位为节点编号。例如, 网络地址为 192.168.250, 节点编号为 100 的节点的 IP 地址是 192.168.250.100。从个人电脑等 向该 IP 地址发送 PING 时, 2ET 模块将返回响应。FL-net 虽然进行 UDP/IP 的广播传输, 但此时的目标 IP 地址仅用 FFh 来发送 IP 地址的第 4 位。例如, IP 地址为 192.168.250.100 的节点发送数据时的目标 IP 地址为 192.168.250.255。网络地址在 1 个 FL-net 网络的所有节点中必须相同。网络地址不同时, 该节点将无法接收其他节点的数据, 另外, 该节点发送的数据, 在其他节点中将无法接收。 在以太网分析仪中会对所有数据进行监控, 所以需多加注意。 在 FL-net 的标准中规定要将 192.168.250 作为默认的网络地址使用。4-25
4.2.5.2标记监视超时时间的设定在 FL-net 的通信中, 各节点按节点编号的升序使标记(发送权)循环。收到标记的节点将数据链接发送 区域内的数据和消息数据(如有)分配到 1024 字节以下容量的一帧中进行发送, 并在最后的一帧中添 加发往下一节点的标记。所谓标记监视超时时间, 是指前一节点发送标记之后, 直到向下一节点发送标记为止的时间最大值, 超 过该时间后, 标记仍未发送时, 下一节点将自动重新发送标记。 连续 3 次发生这种问题时, 该节点将被 视为已脱离, 并从标记的循环中删除。设定为“Auto(自动)”时, 将自动根据发送区域的数据容量来计算、设定标记监视超时时间。此时的计 算公式如下所示。标记监视超时时间=(1+5)+(TBN+1+1)×(1+5) ms 帧间隔最大值              数据发送数据最大值 备用       消息帧    循环数据总程序段数量帧间隔最大值*2 数据发送数据最大值*15ms 1ms标记前节点的时间      1ms5ms1ms      标记*1 是将 1024 字节的数据加载到 10Mbps 的通信线路上所需的时间。 *2 是最小允许帧间隔的最大值。(详细内容请参照“4.2.5.3 最小允许帧间隔的设定”)想要手动设定标记监视超时时间时, 请取消“Auto(自动)”复选框中的勾选, 自行设定时间。可以设定的值的范围为 10~255。在设定的标记监视超时时间内未能发送标记时, 模块前面的 LED 上将显示“EA”, 表示通信异常。在这种情况下, 请修改设定, 延长标记监视超时时间。4-26
4.2.5.3最小允许帧间隔的设定所谓帧间隔, 是指数据帧与数据帧之间的, 线路上没有数据传输状态下的时间。数据帧数据帧     帧间隔小时在 FL-net 的通信中, 各节点上设定有最小允许帧间隔, 并不断发送该设定值。 各节点时常监视其他节 点的最小允许帧间隔, 且所有节点的最大值均为有效。最小允许帧间隔可在 0~5ms 的范围内设定, 但是, 最小允许帧间隔设定为 1ms、3ms、5ms 的 3 种节点混合在一起时, 则 5ms 为有效, 线路上传输的所有 数据帧的间隔将变为 5ms。该参数是为了在单位时间内调整数据在线路上的流量, 使处理速度慢的节点也能够参与通信用的参数。 在 TOYOPUC 的 FL-net 模块中, 默认将最小允许帧间隔设定为 1ms。虽然可以设定比它更大的值, 但 如果错误地设定了太大的值, 则整个网络的通信时间就会产生延时, 因此, 请多加注意。4-27
4.34.3.1FL-net的消息功能消息功能中, 有从其他节点接收命令, 并返回响应的消息服务器功能, 和对其他节点发送命令, 并接收响应的消息客户端功能。在消息客户端功能中, 通过顺控程序来进行命令发送和响应数据的读出。 在消息服务器功能中, 不需进 行此项处理用的特种顺控程序。信息服务器功能下面将就对通过 FL-net 的消息功能, 从其他节点发送的命令而返回响应的消息服务器功能进行说明。命令响应对应TCD代码与处理内容在 FL-net 的标准规定的 TCD 代码(命令代码)中, 对应以下的代码。         4.3.1.1   TCD 代码    适用     内容    65003 (FDEB)  字节程序段数据的读出   以字节单位读出 CPU 模块内的寄存器数据    65004 (FDEC)  字节程序段数据的写入   以字节单位在 CPU 模块内的寄存器数据中进行写入    65005 (FDED) 文字程序段数据的读出 以文字单位读出 CPU 模块内的寄存器数据   65006 (FDEE)    文字程序段数据的写入     以文字单位在 CPU 模块内的寄存器数据中进行写入    65007 (FDEF) 网络参数的读出 读出 2ET 模块中设定的网络参数   65009 (FDF1)   停止命令   停止 CPU 模块的扫描   65010 (FDF2)    运行指令     开始 CPU 模块的扫描    65011 (FDF3)  配置文件的读出   读出 2ET 模块的配置文件数据    65013 (FDF5) 日志的读出 读出日志数据   65014 (FDF6)    日志的清除     清除日志数据   65015 (FDF7) 消息回复  回复接收到的消息(测试用) (1) 字节/文字程序段的读出/写入在这些命令中, 以 4 字节来指定作为对象的数据地址。 上位 2 字节指定 CPU 模块的模式及程序 No.。下位 2 字节指定间接字节地址或间接文字地址。注: 字节/文件程序段的读出/写入未与 PC10 模式的扩展地址对应。 4-28
上位 2 字节0000:PC2 互换模式0001:PC3J 模式0002:PC3J 模式0003:PC3J 模式0004:PC3J 模式0007:PC3JG 模式0008:PC3J 模式 扩展寄存器(U0000~U7FFF)区域 字节程序段读出/写入时:间接字节地址 文字程序段读出/写入时:间接文字地址下位 2 字节间接字节地址、间接文字地址请参照以下内容。No.      1      2      3      4      5      6      7      8      9     10     11     12     13     14     15     16     17     18     19     20     212223 242526 27程序 1 程序 2 程序 3 扩展区域扩展区域         名称   字地址 间接字节地址    间接文字地址    X   输入   X, Y00W ~ 7FW   200 ~ 2FF    100 ~ 17F        Y     输出    M 内部继电器   M00W ~ 7FW 300 ~ 3FF    180 ~ 1FF    K   保持继电器   K00W ~ 2FW 40 ~ 9F    20 ~ 4F    V   特殊继电器   V00W ~ 0FW   A0 ~ BF     50 ~ 5F      T     计时器   T, C00W ~ 1FW  C0 ~ FF  60 ~ 7F      C 计数器    L   链路继电器   L00W ~ 7FW 100 ~ 1FF    80 ~ FF    D     数据寄存器     D0000 ~ 2FFF   2000 ~ 7FFF     1000 ~ 3FFF    R 链路寄存器 R0000 ~ 07FF1000 ~ 1FFF  800 ~ FFF    N   当前值寄存器   N0000 ~ 01FF C00 ~ FFF    600 ~ 7FF    S     特殊寄存器     S0000 ~ 03FF   400 ~ BFF     200 ~ 5FF    EX 扩展输入 EX, EY00W ~ 7FW  B00 ~ BFF  580 ~ 5FF        EY     扩展输出    EM 扩展内部继电器   EM00W ~ 1FFW C00 ~ FFF    600 ~ 7FF    EK     扩展保持继电器     EK00W ~ FFW   200 ~ 3FF     100 ~ 1FF    EV 扩展特殊继电器 EV00W ~ FFW  400 ~ 5FF   200 ~ 2FF      ET   扩展计时器 ET, EC00W ~ 7FW  600 ~ 6FF  300 ~ 37F        EC     扩展计数器    EL 扩展链接继电器   EL00W ~ 1FFW 700 ~ AFF    380 ~ 57F    U     扩充数据寄存器     U0000 ~ 7FFF   0000 ~ FFFF     0000 ~ 7FFF    EN 扩展当前值寄存器 EN0000 ~ 07FF2000 ~ 2FFF  1000 ~ 17FF    H     扩展设定值寄存器     H0000 ~ 07FF   3000 ~ 3FFF     1800 ~ 1FFF    ES 扩展特殊寄存器 ES0000 ~ 07FF  1000 ~ 1FFF   800 ~ FFF      GX   扩展输入 GX, GY00W ~ FFFW  0000 ~ 1FFF  0000 ~ FFF        GY     扩展输出    GM   扩展内部继电器     GM00W ~ FFFW   2000 ~ 3FFF     1000 ~ 1FFF                              4-29识别码
(2) 网络参数的读出网络参数的读出应答数据格式根据 FL-net 协议的标准, 如下图那样进行规定。 15 87 0offset+0+4 +5+9 +10        +14        +15        +16        +17        +18        +19        +20        +21        +22        +23        +24        +25        +26        +27TOYOPUC     节点名称(设备名称)         供应商名称         制造商型号          区域 1 的起始地址      区域 1 的容量      区域 2 的起始地址      区域 2 的容量      备用   标记监视超时时间     备用      最小允许帧间隔    备用 链接的状态     备用       协议、版本    上位层级的状态      刷新周期允许时间 RCT 设定值     刷新周期测量值(当前值)     刷新周期测量值(最大值)     刷新周期测量值(最小值) 2ET 模块(TUU-6949)时, 如下所示那样返回响应。    节点名称   用链接参数设定的节点名称    供应商名称   TOYODA    制造商型号     TUU-6949    区域 1/2 的起始地址/容量 从使用链接参数进行设定的发送区域来计算公用存储器上的发送区域, 并将 其作为响应数据    标记监视超时时间   返回使用链接参数进行设定的值    最小允许帧间隔     返回使用链接参数进行设定的值    链接的状态 77 66 55 44 33 22 11 00          上位层级动作信号错误      公用存储器数据有效通知     公用存储器(地址、容量)设定完成   地址重复检测       予備备用           协议版本     FL-net 协议的版本(80h)    刷新周期允许时间 将从自身节点上的标记接收开始, 至下一自身节点上的标记接收为止的时间, 以 1、2 倍的时间, 用于消息发送可否的判定。详细内容请参照 FL-net 协议规 格书。    刷新周期测量值 (当前值/最大值/最小值)   返回从自身节点上的标记接收开始, 至下一自身节点上的标记接收为止的时 间当前值/最大值/最小值 4-30
(3) 运行指令/停止指令使 CPU 模块的扫描(RUN)开始或停止。(4) 配置文件的读出在 TOYOPUC 2ET 模块(TUU-6949)中, 如下所示那样返回配置文件数据。 Seq:179:Seq:139: Str:6:COMVER Int:1:1Str:2:ID Str:7:SYSPARA Str:3:REV Int:1:0 Str:7:REVDATE Seq:10: Int:2:2016 Int:1:7Int:1:29Str:10:DVCATEGORYStr:2:PCStr:6:VENDORStr:17:JTEKT CORPORATION Str:7:DVMODEL Str:32:TOYOPUC-Nano 2ET TUU-6949 Seq:31Str:2:IDStr:7:DEVPARAStr:12:SOFT VERSIONInt:2:100h (版本为 1.00 时)4-31
(5) 日志的读出日志数据的格式根据 FL-net 协议的标准, 如下图那样进行规定。 电源通断或重置时, 计数器将被重置。各数据为 4 字节数据。偏移概要项目 内容               0   发送和接收 1234 5 6 7 8 910 1112   帧的种类 131415161718192021222324   循环传输 2526272829303132333435通算插槽部发送次数通算插槽部发送错误次数以太网发送错误次数通算接收次数通算接收错误次数以太网接收错误次数标记发送次数 循环帧发送次数 1:1 消息发送次数 1:N 消息发送次数标记接收次数 循环帧接收次数 1:1 消息接收次数 1:N 消息接收次数循环传输接收次数 循环地址位数错误次数 循环 CBN 错误次数 循环 TBN 错误次数 循环 BSIZE 错误次数对下位层级发出发送请求的帧数插槽部中发送错误的次数以太网层级的接收错误次数从下位层级接收的帧数插槽处理部的接收错误次数以太网层级的接收错误次数发送标记的次数 发送不含标记的循环帧的次数 发送 1:1 消息的次数发送 1:N 消息的次数接收标记的次数 接收不含标记的循环帧的次数 接收 1:1 消息的次数接收 1:N 消息的次数循环传输中的错误次数(包括以下内容) 报头的地址和位数与管理表的值不同与 CBN 有关的错误次数与 TBN 有关的错误次数与 BSIZE 有关的错误次数                                                                                                                                                                                                                                        4-32
           偏移概要项目 内容      36   消息传输 373839404142434445464748   ACK 相关 495051525354555657585960   标记相关 616263646566676869707172   状态 1 7374757677787980818283消息传输重传次数消息传输重新超时次数消息传输接收错误次数消息序列号版本错误次数消息序列号重传识别次数ACK 错误次数ACK 序列号版本错误次数 ACK 序列号编号错误次数 ACK 节点编号错误次数 ACK TCD 错误次数标记复用识别次数标记丢弃次数标记重发次数标记保持超时次数标记监控超时次数通算运行时间帧等待状态次数加入次数自己脱离次数因跳过而导致的脱离次数其他节点脱离识别次数重传消息的次数消息重传超时的次数接收的消息中有错误的次数接收的消息中有序列号版本错误的次数接收的消息识别为重传消息的次数与 ACK 的内容相关的错误次数 ACK 序列号版本不匹配的次数 ACK 序列号编号不匹配的次数 ACK 节点编号不匹配的次数 ACK 的 TDC 不匹配的次数识别出标记复用的次数标记丢弃次数标记的重发次数标记保持超时发生次数标记监视超时发生次数从启动时开始的运行时间 网络上没有其他节点, 形成帧等待的次数保持超时 3 次或因网络上没有节点而导致的脱离 标记未到达自身节点而连续跳过导致的脱离 识别出其他节点已脱离的次数                                                                                                                                                                                                                                                                                                                  4-33
     偏移   概要     项目   内容       84   状态 2     参加节点列表(1~31)    用位数单位来表示识别出参加的节点例)31 43210节点编号 31 节点编号 1 (1  参加, 0  不参加)                   85  参加节点列表(32~63)     86     参加节点列表(64~95)     87        参加节点列表(96~127)     88     参加节点列表(128~159)     89  参加节点列表(160~191)     90     参加节点列表(192~223)     91      参加节点列表(224~254)  (6) 日志的清除 将日志数据的所有计数器值清除为 0。(7) 消息回复  回复接收到的消息。  是测试用的功能。4-34
4.3.1.2远程编程、远程监控FL-net 由于与中继命令相对应, 所以可从以太网及 HPC-LINK 等的通信模块, 经由 FL-net, 进行远程编 程、远程监控。   命令响应CPU 2ET 2ET (以太 (FL-net)网)以太网通信系统      CPU 2ET (FL-net)  命令响应FL-net 通信系统     注1: 中继命令的详细内容请参照各通信模块的使用说明书。 注2: 利用从周边装置进行远程编程的功能, 对安装有 FL-net 的 CPU(上图 C )发出“重置”命令时, B 的 FL-net 的通信会因为重置而中断, 所以周边装置上会有异常应答返回。 即使在这种情况下, 针对 CPU C 的“重置”命令仍然可以正常执行。  4-35
4.3.2信息终端功能是向其他节点发送命令消息, 并接收响应的方式。该功能可在以下 CPU 模块中使用。命令 响应消息发送处理步骤 消息发送通过顺控程序的处理进行。其步骤如下所示。注意: 响应数据的读出完成之前, 不可发送下一个命令。   CPU 模块    版本   NanoCPU      1.00 ~             4.3.2.1 将发送数据设置在寄存器中  通过 SPW 命令,在 2ET 模块中写入发送数据  通过 SPR 命令,从 2ET 模块中读入控制信号,并 确认发送处理结束状态    通过 SPR 命令,从 2ET 模块中读入响应数据4-36仅拥有字节/文字程序段数据读出命令等,响应 数据的部分
4.3.2.2 顺控程序的构建方法 (1) 发送数据的设置      发送数据请按照以下格式设置。(数据为字节单位)     偏移 内容    数据范围     0    发送目的地节点 No.     01~FE    10 固定  0       2  TCD 代码(下位) 参照 4.3.1.1 章         3      TCD 代码(上位)    4 虚拟内存地址(下位)   参照 4.3.1.1(1)章         5      虚拟内存地址    6    虚拟内存地址    7 虚拟内存地址(上位)     8   数据数量(下位)   字节数据时 1024 以下 文字数据时 512 以下*1         9      数据数量(上位)    10    写入数据(顶部)     0~FF      · · · ·     1033(max)      写入数据(末尾)  *1 设置超过 1024 字节的数据后, 将发送 1024 字节量的数据) 将节点No.2 的 2ET模块在所连接的CPU模块R100、R101 中写入 2 文字数据的命令发送数据设置在 R200 以下时的例子    地址   数据   备注    R200     0002     发送目的地节点 No.    R201 FDEE 文字程序段数据写入 TCD 代码(65006)    R202     0900     数据写入目的地地址    R203 0000 (PC2 互换模式 R100 的间接文字地址)    R204   0002   数据数量(2 文字)    R205     写入数据     0000 ~ FFFF    R206    写入数据   0000 ~ FFFF  4-37
(2) 在 2ET 模块中写入发送数据发送数据在 2ET 模块上的写入通过 SPW 命令进行。 链接可使用标志*1 写入执行条件指定将链接 No.设置在上位 4 位数,发送数据的字节数量设置在 下位 12 位数上的寄存器          指定设置了发送数据的首个寄存器的设置了间          接字节地址的寄存器SPW OP1 OP2 → OP3指定设置了 2ET 模块上的发送数据写入地址(2000h 固定)的寄存器。                *1 链接可使用标志如下表所示, 设置在每个 2ET 模块的链接 No.上。 将前页的发送数据写入链接No.1 的 2ET模块时的序列 程序例   链接 No.      1   2     3   4    5   6  7     8   链接可使用标志   V90V92   V94V96  V98 V9AV9C   V9EV006       WMOVWMOV WMOVSPW100E → R1031400 → R104链接 No.1 (14=Eh)14 字节            V90执行条件2000 →R103R105R104 → R105R200 间接字节地址 2ET 模块发送数据写入目的地地址(2000h 固 定)在 2ET 模块中写入发送 数据          4-38
(3) 从 2ET 模块中读出控制信号, 确认发送处理结束通过从 2ET 模块中读出的控制信号, 来判断发送数据是否已正常发送、处理是否已结束。 控制信号的读出根据 SPR 命令进行。控制信号为 1 文字(=2 字节)。 链接可使用标志*1 读出执行条件指定将链接 No.设置在上位 4 位数,读出字节数量设置在下位 12 位数上的寄存器指定从 2ET 模块来设置控制信号读出地址(0000h 固定)的寄存器。SPR OP1 OP2 → OP3 指定设置了控制信号的读出目的地寄存器间接字             *1 链接可使用标志如下表所示, 设置在每个 2ET 模块的链接 No.上。 从链接No.1 的 2ET模块, 将控制信号读出到R109 上时的序列 程序例V006链接 No.1 2 字节2ET 模块控制信号 读出源地址R109 间接字节地址从 2ET 模块中读出控 制信号节地址的寄存器。    链接 No.    1 2    3 4   5  6 7    8   链接可使用标志      V90   V92     V94   V96    V98    V9A   V9C     V9E          WMOV 1002 → R106WMOV 0→ R107WMOV 1212 → R108            V90执行条件      SPR R106R107 → R108    4-39
控制信号 “0000”表示发送处理执行中, “0001”表示正常结束。如有异常, 则返回以下的错误代码。 控制信号在发送处理正常结束或异常结束之前, 必须持续通过顺控程序进行读出。    控制信号     内容    0000 发送处理执行中(等待来自对方节点的响应)    0001   正常结束    2102     传输字节数量异常    2302   未定义 TCD 代码    2502   传输数量异常, 无法处理    2702 • 发送处理尚未完成, 下一个发送请求却已执行• 发送处理尚未完成, 响应数据读出请求却已执行    2802     从对方节点有错误应答返回(m_rlt=1)    2902 响应等待超时(5 秒)(对方节点无应答)    4002     超出地址范围    4102   超出字节数量范围    6002   消息发送对方节点编号为 00 或 FF 或是自身节点  (4) 从 2ET 读出响应数据发送有来自对方节点的响应数据的命令(字节/文字程序段读出等)时, 发送处理正常结束后, 读出 响应数据。此项处理通过 SPR 命令进行。 链接可使用标志*1 读出执行条件指定将链接 No.设置在上位 4 位数,读出字节数量设置在下位 12 位数上的寄存器指定从 2ET 模块来设置响应数据读出地址(3000h 固定) 的寄存器。SPR OP1 OP2 → OP3    指定设置了响应数据的读出目的地寄存器间接字节地址的寄存    器。                *1 链接可使用标志如下表所示, 设置在每个 2ET 模块的链接 No.上。   链接 No.    1 2    3 4   5  6 7    8   链接可使用标志     V90 V92     V94 V96   V98  V9A V9C     V9E4-40
响应数据的格式如下所示。(数据为字节单位)     偏移 内容    数据范围     0    消息发送节点 No.     01~FE    10 固定  0       2    TCD 代码(下位)   发送数据的 TCD 代 码      3TCD 代码(上位)     4    响应数据(顶部)     0~FF    · ·· ·       1027(max)    响应数据(末尾)     0~FF   从链接No.1 的 2ET模块, 在R220 之后读出 8 字节响应数据时的顺控程序例 V006       WMOV 108 → R111链接 No.1 8 字节2ET 模块响应数据 读出源地址 (3000h 固定)R220 间接字节地址从 2ET 模块中读出响应 数据              V90执行条件WMOV 3000WMOV 1440SPR R111→ R112→ R113R112         → R113 注意:使用 SPW、SPR 命令时, 不仅可以延长扫描时间, 而且在命令执行过程中, 也可以使 2ET 模 块侧的部分处理等待。没必要地多次执行后, 会给通信处理带来影响, 因此, 请进行编程, 以使 命令的执行次数为最小限度。4-41
4.3.2.3(1)顺控程序例 文字程序段数据写入在该顺控程序中, 向节点 No.2 的 R100、R101 寄存器中发送写入 2 文字数据的命令, 并通过控制 信号, 检查有无正常处理。自身节点设定为链接 No.1、节点 No.1。发送数据设置在 R200~R206 的 7 文字(14 字节)中, 其中, 对方节点中的写入数据设置在 R205、R206 上。命令发送的执行条件在通信确立后, 为每秒钟 ON 一次的 T000。命令发送后, 将控制信号读出到 R109 中。 在来自对方节点的响应返回前期间, 控制信号始终为 0000, 因此, 在读出 0000 以外的代码之前, 将持续进行控制信号的读出。在以下的顺控程序例子中, 在 K001 为 ON 期间, 将进行控制信号的读出。 正常结束得到确认后, 递增写入数据。异常结束时, 使 K003 为 ON。2 文字链接 1、14 字节R200 地址 发送数据写入目的地地址控制信号读出缓存清除  写入数据初始值写入数据初始值保持继电器清除节点 No.1 节点 No.2 通信确立     节点编号 2 文字程序段写入 TCD (65006) R100 文字地址     ■文字程序段数据写入命令 发送 控制信号读出中 (接下页)4-42T000 在链接确立后,每秒 钟仅 1 个扫描为 ON
  链接 1・2 字节 控制信号读出源地址R109 间接地址 ■控制信号读出 控制信号读出中 消息发送异常结束 写入数据递增 写入数据递增(2) 文字程序段数据读出在该顺控程序中, 从节点 No.2 的 R100、R101 寄存器中发送读出 2 文字数据的命令, 并通过控制信号进行检查, 如果正常结束, 则读出响应数据。 自身节点设定为链接 No.1、节点 No.1。发送数据设置在 R210~R204 的 5 文字(10 字节)中。 命令发送的执行条件在通信确立后, 为每秒钟 ON 一次的 T000。命令发送后, 将控制信号读出到 R109 中。 在来自对方节点的响应返回前期间, 控制信号始终为 0000, 因此, 在读出 0000 以外的代码之前, 将持续进行控制信号的读出。在以下的顺控程序例子中, 在 K001 为 ON 期间, 将进行控制信号的读出。 正常结束得到确认后, 在 R220 之后读出响应数据。       4-43
  保持继电器清除 节点 No.1 节点 No.2 通信确立文字程序段读出 TCD(65005) R100 文字地址2 文字链接 1・10 字节R210 地址 发送数据写入目的地地址控制信号读出缓存清除 链接 1・2 字节控制信号读出源地址 R110 间接地址■控制信号读出 响应消息读出中 控制信号读出中 消息发送异常结束响应消息读出源地址 R220 地址 ■响应消息读出响应消息读出中T000 在链接确立后,每秒钟仅 1 个扫描为 ON 节点编号 2 指定       ■文字程序段数据读入命 令发送  控制信号读出中        链接 1・8 字节响应消息 读出源地址     4-44
4.3.3 4.3.3.1其他节点状态读出功能 是将其他节点的状态读出到 I/O 寄存器中的功能。其他节点状态数据 可以以参与通信的其他节点为对象, 读出以下数据。指定未参与通信的节点编号, 一旦读出其他节点状态后, 可全部以 0000 读出。     读出数据相对地址 内容   0000 00 固定    FA 链接的状态 *1   0001 上位层级的状态(H)*1    上位层级的状态(L)*1   0002 公用存储器区域 1 地址(H)      公用存储器区域 1 地址(L)   0003 公用存储器区域 1 容量(H)  公用存储器区域 1 容量(L)   0004 公用存储器区域 2 地址(H)    公用存储器区域 2 地址(L)   0005 公用存储器区域 2 容量(H)      公用存储器区域 2 容量(L)   0006 刷新周期允许时间(H)  刷新周期允许时间(L)   0007 00 固定    标记监视超时时间   0008 00 固定      最小允许帧间隔   0009 ···000A ···000B ···000C ···        000D供应商名称(H)*2    供应商名称(L)*2 ············                   000E ···000F ···0010 ···0011 ···        0012制造商型号(H)*2  制造商型号(L)*2 ············                   0013 ···0014 ···0015 ···0016 ···        0017节点名称(H)*2     节点名称(L)*2 ············                 *1 关于 FA 链接的状态与上位层级的状态, 请参照下页。*2 供应商名称、制造商型号、节点名称可用 ASCII 码读出。4-45
 FA链接的状态    上位层级的状态通信无效检 测0:无检测 1:检测预约上位层级动作信号错误0:无错误 1:有错误 公用存储器、数据有效通知 0:无效1:有效公用存储器(地址、容量)设定完成0:未完成 1:完成   节点的参与 脱离0:脱离 1:参与地址重复检测 0:无重复 1:有重复  用上位层级进行定义 预约 4-4600:正常 01:警告 10:报警 0:停止 1:运转 
4.3.3.2顺控程序的构建方法 其他节点状态的读出根据 SPR 命令进行。 链接可使用标志*1 读出执行条件指定将链接 No.设置在上位 4 位数,读出数据的字节数量(30h) 设置在下位 12 位数上的寄存器指定在作为其他节点状态读出对象的节点上, 设置了节点编号+1000h 的寄存器SPR OP1 OP2 → OP3指定在 2ET 模块上设置了其他节点状态数据读出目的地寄存器间接地址的寄存器。               *1 链接可使用标志如下表所示, 设置在每个 2ET 模块的链接 No.上。   链接 No.    1 2    3 4   5  6 7    8   链接可使用标志      V90   V92     V94   V96    V98    V9A   V9C     V9E   从链接No.1的2ET模块, 将节点编号2的其他节点状态, 读出到来自D0000的30h字节中时的顺控程序 例  链接 1、30 字节 节点编号 2 指定  读出目的地 D000 间接地址 其他节点状态读出执行注意: 其他节点状态的读出, 不可与消息数据的发送及响应数据的读出同时执行。 同时执行时, 会出现应用命令错误。4-47
4.44.4.1 错误显示2ET 模块检测到异常后, 会在模块前面的 LED 上显示 2 位的错误代码。通信无法正常进行时, 请首先确认此错误代码。 2ET STATUSFL-net的异常通告2ET 模块检测到异常时, 模块前面的 LED 上会显示 2 位的错误代码, 同时, 将对 CPU 模块通告异常情况。CPU 模块将按照该异常内容来设置特殊继电器、错误信息输出用特殊寄存器、链接错误信息输出用特殊 寄存器。     TXD    RXD TUU-6949      错误代码      错误内容     原因和处理方法    E5 链接参数未设定 未设定链接参数时, 请进行设定。已设定链接参数时, 请确认链接参数设定中的机架No.或插槽No.的设定与实际安 装位置是否一致。      E6      链接参数异常     链接参数中有错误。请参考下一章, 读出链接错误信息特殊寄存器, 进行对应的处置。    E7    节点编号重复   试图参与 FL-net 的通信时, 与自身节点的节点编号相同的的其他节点已参与通信 时会发生。请确认在自身节点或其他节点的链接参数设定中, 节点编号有无错误。    E8 公用存储器发送区域地址重复(继电器链接) 在 FL-net 的数据链接通信中, 通过各节点共享数据的虚拟存储空间, “公用存储 器//common memory,//”进行数据的发送、接收。各节点必须在公用存储器上设定发送区域, 以避免与其他节点重复, 但是, 自身 节点已参与通信时, 如果存在向与自身节点发送区域的部分或全部重复的区域发 送数据的其他节点, 则会出现 E8(继电器链接区域重复)或 E9(寄存器链接区域 重复)的错误。同一网络中有 FL 远程设备混入时, 请断开与 FL-net 的网络连接。请以“4.5.6 数据链接的设定”为参考, 确认自身节点或其他节点的发送区域设定有 无错误。         E9      公用存储器发送区域地址重复(寄存器链接)  4-48
     错误代码      错误内容     原因和处理方法    EA 标记监视超时 标记监视超时错误在链接参数的“Network(网络)”中设定的标记监视超时时间内, 未能发送自身节点的所有数据时会发生。 请将标记监视超时时间的“Auto(自动)”复选框设置为 ON, 或加大设定时间。      Ed      数据寄存器区域超出     链接区域的设定超出 CPU 模块所拥有的数据寄存器范围时会发生此异常。 例如, PC2J-CPU 的数据寄存器为 D0000~D0FFF, 但是, 设定的链接区域超出此 地址时, 会出现 Ed 的异常。请复核链接区域的地址。    -- -- -- 环回测试异常 2ET 模块在接入电源时或重置/启动时, 会自动进行数据能否正常发送的测试。进 行此项测试时, 如果出现错误, 则表示“环回测试异常”。出现环回测试异常时, 将自动反复进行测试, 直至正常为止, OK 之后才会开始通 信。请以“3. 设置与布线”为参考, 确认以下的项目。(1) 模块中是否确实安装了LAN电缆的连接器(2) HUB中是否确实安装了LAN电缆的连接器(3) LAN电缆有无发生断线或短路(4) HUB 中是否确实安装了收发器电缆的连接器, 有无用五金配件固定 (5) 将HUB堆叠在一起使用时,HUB之间的连接是否正确(6) 收发器中是否确实安装了收发器电缆的连接器, 有无用五金配件固定 (7) 收发器电缆有无发生断线或短路(8) 收发器与干线电缆的连接有无问题(9) 干线电缆的两端有无连接端接器(10) 干线电缆有无发生断线或短路在网络的所有 FL-net 模块中发生这种异常时, 可考虑(9)或(10)的可能性较 大       --      接收等待     网络上不存在参与通信的节点时, 或自身节点已脱离时会显示该信息。 请确认以下的项目。(1) HUB的电源有无OFF(2) 其他节点的电源有无OFF(3) 模块中是否确实安装了LAN电缆的连接器 (4) HUB中是否确实安装了LAN电缆的连接器 (5) LAN电缆有无发生断线或短路  4-49
     错误代码      错误内容     原因和处理方法    H5 CPU 模块 NAK 应答 有可能是以下的原因(1) CPU的参数设定未能正常进行(2) 对与FL-net的16K字节模式、32K字节模式不对应的CPU模块进行了此项设定(3) 2ET模块或CPU模块或基板故障对策(1) CPU模块参数设定的复核(2) 开关设定的修正(3) 2ET模块、CPU模块或基板的更换     Hd   特殊模块分配过大或 2ET 模 块硬件异常     有可能是 2ET 模块故障或 CPU 模块发生了错误代码 81 的“特殊模块分配过大”的 问题。异常无法解决时, 请更换模块。       H0       2ET 模块硬件异常               有可能是 2ET 模块的故障。 请更换模块。             H1     H2     H3     HE     HF     HL     HU     H4       2ET 模块与 CPU 模块的接口 部硬件异常               是因为 2ET 模块或 CPU 模块、I/O 电缆、基板的故障, 而导致 2ET 模块和 CPU 模块之间的数据交换无法正常进行的状态。请依次更换 2ET 模块、CPU 模块、I/O 电缆、基板。             H6     H7     H8     H9     HA     HC     DL    维护模式    是 2ET 模块设定在维护模式下的状态。请将旋转开关设定在机架 No.0 ~ No.7 以外的部分。异常无法解决时, 请更换模块。 4-50
4.4.2 CPU模块的错误显示 4.4.2.1 特殊继电器异常时, 下述特殊继电器将为 ON。    地址       内容    VA1 VA5 VA9 VAD VB1 VB5 VB9 VBD    链接 No.1 链接参数异常 链接 No.2 链接参数异常 链接 No.3 链接参数异常 链接 No.4 链接参数异常 链接 No.5 链接参数异常 链接 No.6 链接参数异常 链接 No.7 链接参数异常 链接 No.8 链接参数异常    VA2 VA6 VAA VAE VB2 VB6 VBA VBE 链接 No.1 通信异常 链接 No.2 通信异常 链接 No.3 通信异常 链接 No.4 通信异常 链接 No.5 通信异常 链接 No.6 通信异常 链接 No.7 通信异常 链接 No.8 通信异常     VC4      特殊模块的异常(通信模块故障)    VC8 I/O 构成异常(通信模块安装了 9 个以上。) (通信模块的存储器容量在 61Kbyte 以上)     VF2     特殊模块的分配异常(链接参数的机架 No.、插槽 No.、链接模块名称与安装状态不同。   4-51)
4.4.2.2特殊寄存器 特殊寄存器整图    地址       内容    S200 | S24F    CPU 错误信息输出用寄存器    S3*0 | S3*F FL-net 网络 节点参与状态 表示各节点的通信状态(参与=1/未参与=0)。 请参照“4.1.8 监视器功能”。     S3x0 | S3xB   链接错误信息输出用寄存器     S3xF     自身节点地址输出用寄存器   上述地址的#及*部分根据链接No.来确定。 基于各链接 No.的*、×等如下表所示。例) 链接 No.为 1 时, 节点参与状态保存在 S300~S30F 中, 链接错误信息保存在 S310~S31B 中。注: 保存在特殊寄存器中的信息, 在异常恢复后也不会被清除。 需要清除时, 请用 I/O 监视器及编程器等, 在寄存器中写入“0000”。   链接 No.    1    2  3    4  5   6    7    8    *          0        2    4        6    8      A        C      E   ×       1      3   5      7   9    B       D    F   4-52
(1) CPU错误信息输出用寄存器检出异常时, 将错误代码、错误相关信息及错误检出时刻保存在错误信息保存用特殊寄存器中。该寄存 器为 8 级(PC10 模式时为 64 级)移位寄存器结构, 可存储最大 8 次的异常发生。异常超过 8 次(PC10 模式时为 64 次)时, 将从最初保存的错误信息开始依次消失。  保存在此寄存器中的错误信息可通过周边装置来显示。 CPU错误信息输出用特殊寄存器的内容 地址S200 S20A S214 S21E S228 S232 S23C S246 S24FS1000S1008 ···· S11F0 S11F8 错误相关信息           错误0 信息错误代码           错误1 信息错误相关信息 1(下位)、2(上位)          错误2 信息错误相关信息 3(下位)、4(上位)          错误3 信息错误检出时刻(秒)          错误4 信息错误检出时刻(分)          错误5 信息错误检出时刻(时)          错误6 信息错误检出时刻(日)          错误7 信息错误检出时刻(月)        错误检出时刻(年)     错误检出时刻(星期)0~6:周日~周六      消失S1000S1001 S1002 S1003 S1004 S1005 S1006 S1007HL         异常 0       异常 1       ·       ·       ·       ·       异常 62       异常 63        程序 No     异常代码   相关信息 2    相关信息 1   相关信息 4      相关信息 3   相关信息 6  相关信息 5   相关信息 8      相关信息 7   时刻(分)  时刻(秒)   时刻(日)      时刻(时)   时刻(年)    时刻(月)            错误 代码     I/O 监视器的错误信息    错误内容     相关 1     相关 2    相关 3     相关 4       备注         81 FUNC. I/O OVER 2通信模块的存储器 容量超出 (61Kbyte 以上)  - --  - VC8 ON    84   I/O MODULE ERROR 2 通信模块 故障    *分类   机架编号 插槽编号     -   *2:CPU 检出 1、3:链接检出    88   FUNC. I/O OVER 1 9 个以上通信模块的安装    -   - -     -   VC8 ON             85     LINK PRAM. ERROR   链接参数异常     链接编号     -   -      -          86   LINK ERROR  通信异常   链接编号   -  -   -        89   FUNC. I/O ALARM  链接参数的机架 No.、插槽 No.、模块名称异常    机架编号   插槽编号  -    -   VF2 ON   注: 与 2ET 模块前面的 LED 中显示的错误代码不同。 4-53警报 重度异常
(2) 链接错误信息输出用特殊寄存器2ET 模块进行异常检测时, 将向 CPU 模块通告异常情况。CPU 模块将在链接错误信息输出用特殊寄存器中保存此异常内容。链接错误信息输出用特殊寄存器为 8 级移位寄存器结构, 最大可存储过去 8 次的异常发生情况。异常超 出 8 次时, 将从最初保存的错误信息开始依次消失。 保存在此寄存器中的错误信息可用周边装置等读出。 链接错误信息输出用特殊寄存器的内容    链接 No.    错误显示地址     1        S310~S31F    2   S330~S33F    3 S350~S35F      4        S370~S37F     5     S390~S39F      6   S3B0~S3BF    7     S3D0~S3DF    8    S3F0~S3FF       地址       MSB 内容 LSB       S3x0            自身节点编号(hex)          错误代码(hex)*1    S3x1   链接参数异常详细代码(hex)*2    S3x2 0000 固定      S3x3       0000 固定      S3x4       软件版本(BCD)*3      S3x5 S3x6 S3x7 S3x8 S3x9 S3xA S3xB             节点编号、错误代码保存区 1 新 节点编号、错误代码保存区 2 节点编号、错误代码保存区 3 节点编号、错误代码保存区 4 节点编号、错误代码保存区 5 节点编号、错误代码保存区 6 节点编号、错误代码保存区 7 旧           S3xC S3xD   标记重传次数(读出用)    S3xE     系统预约    S3xF   自身节点地址     *1 与模块前面显示的错误代码相同。(参照“4.4.1 错误显示”)*2 仅链接参数异常(错误代码=E6)时。 在其他的错误中为 0000 固定。*3 版本 1.23 时、0123h。注1: ×将根据链接 No.确定。例如, 在链接 No.=1 的 2ET 模块中, 错误信息保存在 S310~S31B 中。   链接 No.    1    2  3    4  5   6    7    8    ×            1          3      5          7      9        B          D        F   4-54
 链接参数异常详细代码链接参数中有异常时, 会在模块前面的 LED 中显示“E6”, 并在错误代码 E6 保存在链接错误信息输出用特殊寄存器 S3×0 中的同时, 将链接参数异常详细代码保存在 S3×1 中。 请参考下表来复核链接参数。而且, 链接参数的确认请从 CPU 模块中将参数读出到周边装置之后进行。 周边装置内的参数有时会与 CPU 模块内的参数不一致。另外, 在 PCwin 等周边装置中设定了链接参数后, 在周边装置中进行设定时会进行检查, 所以无法设定 异常的参数。即便如此, 在发生链接参数异常时, CPU 模块内的链接参数也有可能通过计算机链接的命 令等进行过改写。(0024:开关设定异常除外)    S3×1 的异常 详细代码 (hex)   异常内容 原因     通信 方式       0001     继电器链接区域起始地址异常    • 继电器链接区域起始地址非文字指定           N:N            0002   寄存器链接区域起始地址异常   • 寄存器链接区域起始地址非文字指定   0003   继电器链接发送区域起始地址异常  • 继电器链接发送区域起始地址有异常• 继电器链接发送区域文字数量有异常• 继电器链接区发送域起始地址非文字指定   0004   寄存器链接发送区域起始地址异常  • 寄存器链接发送区域起始地址有异常• 寄存器链接发送区域文字数量有异常• 寄存器链接发送区域起始地址非文字指定   0005 继电器链接区域超出• 继电器链接区域文字数量有异常• 继电器链接区域起始地址+文字数量有异常• 继电器链接区域顶部与发送区域顶部的识别不 一致    0006   寄存器链接区域超出 • 寄存器链接区域文字数量有异常• 寄存器链接区域起始地址+文字数量有异常• 寄存器链接区域顶部与发送区域顶部的识别不 一致    0010     继电器链接接收区域起始地址异常    • 继电器链接区域起始地址非文字指定           1:N          0011   寄存器链接接收区域起始地址异常   • 寄存器链接区域起始地址非文字指定   0012   继电器链接区域超出  在继电器链接的设定中• 接收文字数量有异常• 发送区域文字数量有异常• 接收区域起始地址+收发文字数量有异常 • 公用存储器地址有异常   0013 寄存器链接区域超出在寄存器链接的设定中• 接收文字数量有异常• 发送区域文字数量有异常• 接收区域起始地址+收发文字数量有异常 • 公用存储器地址有异常    0014   继电器链接发送公用存储器地址异常  • 继电器链接发送区域的公用存储器地址有异常    0015     寄存器链接发送公用存储器地址异常    • 寄存器链接发送区域的公用存储器地址有异常   0016   主站节点编号异常   • 主站节点编号为 1~254 以外的数字 • 主站节点编号与自站节点编号相同  4-55
    S3×1 的异常 详细代码 (hex)   异常内容 原因     通信 方式       0020     网络地址异常    • 网络地址为 0.0.0 或 255.255.255      N:N 1:N 共通             0021 X、Y 区域重复异常 • 在实际 I/O 中使用的 XY 区域与链接区域有重复    0022   通信方式未设定  • 通信方式不是 N:N 或 1:N    0023     自身节点编号异常    • 自站节点编号为 1~254 以外的数字   0024 开关设定异常 • 开关的设定有异常    0025     链接参数子代码异常    • 链接参数的子代码有异常   0026 标记监视超时异常 • 标记监视超时时间的设定为不足 10ms    0027   最小允许帧间隔异常   • 最小允许帧间隔的设定不是 1ms~5ms   链接 No.    1   2    3   4  5    6   7    8    x            1        3          5        7      9          B        D        F   4.4.3注意1: ×将根据链接 No.确定。 基于监视器功能进行的异常检出FL-net 节点的参与/脱离状态可用特殊寄存器 S3*0~S3*F 进行确认。(参照 4.1.8 监视器功能)该标志为 ON 时, 表示此站号的节点已加入网络, 为 OFF 时, 表示此站号的节点已从网络上脱离。可通过用顺控程序对此标志进行监视来检出已从网络上脱离的节点。因某种通信故障, 标志变为 OFF 后, 一旦故障恢复, FL-net 就会立即重新加入, 标志也会变为 ON。脱离状态不会持续保持, 因此, 要想检出瞬间的脱离, 请通过顺控程序, 并使用其他地址来保持与脱离的节 点相对应的标志。作为脱离原因的异常位置的特定, 请参考以下内容。 <步骤>1) 准备一张设备的网络系统图2) 在标志为 OFF 的节点上做上标识 3) 分别确认以下的情况情况 A:仅 1 个节点脱离例:在节点 100 中, 检出节点 3 脱离时的异常原因1 100      HUB1HUB2HUB3                434-56526     
异常原因有可能主要在节点 3 的模块、电缆上。  可能原因   处理  节点 3 的电源未接入   请接入电源  节点 3 的模块中发生了异常    请解除错误  节点 3 与 HUB 未用电缆连接  请切实地连接电缆  节点 3 的故障   请更换节点 3  节点 3 电缆不良(断线、短路、非指定品)    请更换节点 3 电缆  节点 3 电缆所连接的 HUB2 端口不良  请更换 HUB2。  节点 2 的电缆不良(断线、短路、非指定品)*    请更换节点 2 电缆  节点 2 的故障* 请更换节点 2* 节点 3 有时会非常罕见地因异常节点的前一节点(节点 2)的断续性通信故障而发生异常。 情况 B:同一 HUB 的节点全部脱离例:在节点 100 中, 检出节点 2 和 6 脱离时的异常原因1异常原因有可能在 HUB 周边。 100      HUB1HUB2HUB3                43526       可能原因    处理  HUB3 的电源电压下降    请供应额定电压  HUB2 和 HUB3 之间未用电缆连接     请切实地连接电缆   HUB2 和 HUB3 之间的电缆不良(断线、短路、非指定品)  请更换 HUB2、HUB3 之间的电缆  HUB3 的故障    请更换 HUB3。  HUB3 电缆所连接的 HUB(HUB2)的故障     请更换 HUB2。   节点 2 与节点 6 的电源未接入  请接入电源  节点 2 和 6 中发生了异常     请解除错误   节点 2 和 6 未与 HUB 连接  请切实地连接电缆  节点 2 和 6 的故障     请更换节点 2 和 6   节点 2 和 6 之间的电缆不良(断线、短路、非指定品)   请更换节点 2 和 6 的电缆  注: 所连接的节点 No 有异常时, 有时原因会非常罕见地在最小异常节点 No 的前一节点上。 (参照情况 C 例 2)4-57
情况 C:所有节点全部脱离, 或脱离节点各不相同时 例 1:在节点 100 中, 检出全部节点脱离时的异常原因1异常原因有可能主要在干线或节点 100 上。 100     HUB1HUB2HUB3                 43526       可能原因    处理  HUB 的电源电压下降    请供应额定电压  HUB1 与节点 100 的电缆未连接     请切实地连接电缆   HUB1 和节点 100 的电缆不良(断线、短路、非指定品)  请更换节点 100 电缆  HUB-HUB 之间的电缆不良(断线、短路、非指定品)    请更换电缆。  HUB 的故障(HUB1~3 的其中一个或全部)     请更换 HUB。   节点 100 的故障  请更换节点 100  点 6 电缆不良(断线、短路、非指定品)*    请更换节点 6 电缆  节点 6 的故障*    请更换节点 6* 节点 100 有时会因异常节点的前一节点(节点 6)的断续性通信故障而发生异常。 例 2:在节点 100 中, 检出多个节点脱离时的异常原因1异常原因有可能在干线或节点 100 上。* 发生断续性通信故障时, 有时会非常罕见地因最小异常节点的前一节点的原因而导致多个节点脱离。 这种情况仅限于多个异常节点连续的站号。 100      HUB1HUB2HUB3                3526   4    可能原因    处理  HUB1 和节点 100 的电缆不良(断线、短路、非指定品)     请更换节点 100 电缆   HUB-HUB 之间的电缆不良(断线、短路、非指定品) 注)包括 HUB2-HUB3 之间的电缆  请更换电缆。  HUB 的故障(HUB1~3 的其中一个或全部)    请更换 HUB。  节点 100 的故障     请更换节点 100   节点 3 的电缆不良(断线、短路、非指定品)*  请更换节点 3 电缆  节点 3 的故障*     请更换节点 3  4-58
5 FL远程5.1 5.1.1FL远程的功能 FL远程规格         项目规格            传输速度10 Mbps, 100 Mbps        最大电缆长*1Max 100 m(主机-HUB 之间、主机-从机之间(1 对 1 连接时)、从机-HUB 之间、HUB-HUB 之间)总延长距离 :Max 2100 m(HUB:Max20 台)        最大连接节点数64 台(其中主机 1 台,从机 63 台)         节点地址从机:01~63         I/O 点数输入:最大 2048 点、输出:最大 2048 点         每个从机的 I/O 点数输入:最大 64 点、输出:最大 64 点         I/O 的分配最小 8 点单位           链接区域X·Y, M, L, EX·EY, EM, EL, GX/GY, GM*1 指定 HUB 和 FRMT 是自动协商模式。自动协商模式之间相互连接时,将达到 100 Mbps。 开关式 HUB:Max20 台5           通信功能I/O 通信      24VDC     Max 100 m主机▪▪▪从机 02Max 100 m Max 100 m                     从机 01▪ ▪ ▪从机:Max63 台从机 63      5-1
(1) 链路 No.和链路区域链路参数可以对程序 1~3 的链路 1~8 进行任意设定。在链路区域设定了内部继电器(M)或链路继电器(L)时,设定了链路参数的程序继电器区域为链 路区域。输入输出(X·Y)区域及扩展区域(EX·EY、EM、EL、GX·GY、GM)在各程序中共通。链接参数可在程序 1~3 的 链接 1~8 中任意设定输入输出(X·Y)区域为各 程序的共享区域。在链路区域设定了内部继电 器(M)或链路继电器(L) 时,设定了链路参数的程序继 电器区域为链路区域。                                    扩充区域为各程序的共享                                    区域。 链路1-1 ~ 1-8链路2-1 ~ 2-8链路3-1 ~ 3-8        程序 1(PRG.1) 链接参数程序 2(PRG.2) 链接参数输入输出(X、Y)   PRG.1 内部继电器 (M)PRG.2 内部继电器 (M)程序 3(PRG.3) 链接参数  PRG.3 内部继电器 (M)     PRG.1 链接继电器 (L)PRG.2 链接继电器 (L)扩充输入输出(EX・ EY,GX・GY)PRG.3 链接继电器 (L) 扩充内部继电器(EM、 GM)扩展链接继电器(EL)           5-2
(2) 通信区域中使用输入输出(X、Y)时的注意事项1. 请注意避免 CPU 中安装的 I/O 模块的 I/O 地址与通信区域重复。CPU 的 I/O 区域 CPU的I/O区域与FL远程的 通信区域重复的区域FL 远程的通信区域2. 应用命令的输入输出刷新(RIO:FUNNo.=280)、输入刷新(RI:FUN No.=281)、输出刷新 (RO:FUN No.=282)不可用于通信区域。3. 通信区域的地址中使用 Y 时,CPU 内部的地址表记将全部变为 X。因此,用 I/O 监视器监视通 信区域时,将显示为 X。   X/Y000 X/Y000 X/Y000X/Y7FF X/Y7FF       X/Y7FF              X/Y000 X/Y000X/Y7FF X/Y7FF     在输入输出之间     加入通信区域时X/Y000X/Y7FF                       输入输出与通信区域 重复在通信区域后有输入输出时              5-3可以 ×不可
5.1.2 网络构成FL 远程的网络构成如下所示。主机Max:100 m从机 01 构成内容开关式 HUB:Max20 台▪▪▪从机 02▪▪▪从机:Max63 台Max:100 mMax:100 m 从机 63     24VDC                       通信电缆总长:Max2100 m (例:主机与从机 63 间)               名称         说明     节点 节点包括连接输入输出设备的子站点(从机)和将各子站点集中在一起的母站点(主机) 主机在每个网络中仅有 1 台。 主机和从机的位置没有具体规定,在上图的任何一个节点位置上,都可以配置主机或从机。 FL 远程-M 是主站(主机)模块。     FL 远程主机   可将 PC10G 内置链接、2ET 等作为 FL 远程的主机使用。     电缆      请使用本公司指定的 LAN 电缆。*1    连接方法    电缆使用直通线。0 仅在 1 对 1 连接时,使用交叉电缆。 连接多个从机时,请使用本公司指定的交换式 HUB*2。    通信电源 I/O 电源    向各节点提供通信用电源。 通信电源请在记载有+、−的端子台上加上+24 V、0 V 的电源。 I/O 电源请在记载有+V、−V 的端子台上加上+24 V、0 V 的电源。 通信电源和 I/O 电源请使用不同的系统进行供电。  *1 电缆请使用本公司指定的电缆。(请参照“2.2 FL-net/以太网/FL 远程的布线”)*2 HUB 请使用 FE-SWH05/08(捷太格特制)5-4
5.1.3电源投入顺序投入电源时,请按照子站→主站的顺序,或同时投入。 按照主站→子站的顺序投入电源时,有时会引起通信异常。 另外,通信开始后,一旦切断子站的电源,就会引起通信异常。主站对于投入电源时应答较慢的子站,最大在 18 秒钟内不会发生异常。 在此期间,主站将实施通信恢复操作。仍不能恢复通信时,将作为通信异常通告给 CPU。注1: 通信异常的解除请重置 CPU→启动,或使通信重置特殊继电器为 ON。(详细内容请参照“5.1.4 通 信重置”。)注2: 主站将在所有子站全部通信正常后继续通信。即使缺少 1 个站,也会作为通信异常而停止通信。(如 果使用脱离功能,则可以继续进行通信。详细内容请参照“5.1.5 脱离功能”。在 FL 远程中,可通过 链接参数的设定来选择通信异常时的通信停止进行/不进行。)   电源投入顺序    结果   主站→子站    ×   子站→主站         同时       5-5
5.1.4通信重置通信复位时在通信异常导致通信停止时再次开始通信的功能。 可通过使通信重置用特殊继电器由“OFF”→“ON”的方法对通信进行重置。 各链接 No.的通信重置用特殊继电器的 I/O 地址如下表所示。       链接 No.   I/O 地址          1       V80     2 V81      3   V82      4   V83      5   V84      6   V85      7      V86     8 V87  注1: 通信重置仅对特殊继电器的启动有效。注2: 通信重置仅在通信异常时有效。在通信正常时无效。通过重新启动CPU进行通信复位通过操作 CPU 重新启动开关进行通信复位。通信复位电路例电源投入后 18 秒钟以内,要进行通信运行的恢复,所以不需要有重置回路。 下图为回复通信异常时的通信所需电路例。 通信重置按钮信号 V82通信异常 特殊继电器VAA         通信重置通信异常注2: 通信异常时,如果是“CPU 的 RUN 停止”的设定,则上述回路不会变为有效。           注1: 上述例子是链接 No.=3 的回路例。 通信异常特殊继电器、通信重置根据链接 No.而有所不同。5-6
5.1.5 脱离功能如果子机发生了通信异常,主机就对全部子机停止通信,向 CPU 发出异常警报。所谓脱离功能,是指使特定的子站从通信网络上脱离(或重置)的功能。可通过此功能,使异常状态的子 站从通信网络上脱离开来,并对其他正常的子站继续进行通信。 脱离状态下的通信(1) 脱离的子站为正常时主站向指定脱离的子站发送 I/O 的 OFF 数据。来自该子站的接收数据将被丢弃,并作为已接收 I/O 的 OFF 数据来运行。即使针对脱离子站的输出为 ON,通信上还是可以进行 OFF 数据的通信。 可与其他未指定脱离的子站,像通常那样进行 I/O 数据的通信。 在指定脱离的状态下,主站投入电源或进行通信重置时,也会进行 OFF 数据的交换。(2) 脱离的子站为通信异常时 主站在该子站的异常解除之前,继续进行通信恢复操作。在异常解除,并有正常应答后,开始进行OFF 数据的交换。期间,可对其他子站,像通常那样进行 I/O 数据的通信。 为通告指定脱离的子站有通信异常,主站将在显示器上显示错误代码 D9(传输异常)和 7 段异常子站编号。(3) 指定脱离解除时子站为正常时  进行通常 ON/OFF 的 I/O 数据交换。子站为异常时  作为一般异常,进行异常通告,并停止针对所有子站的通信。(4) 其他总局在未进行分离指定的子机出现通信异常时,进行异常报警,停止有关全部子机的通信。  脱离子站的指定各子站的脱离状态可通过在特殊寄存器 S3*C~3*F 中设置数据的方法进行设定。 各位数 No.表示节点地址(站号)。MSBLSB   15    14  13    12  11     10   9   8 7    6 5     4 3     2  1   -   31      30 29       28 27       26    25    24 23       22 21       20 19       18    17   16   47        46     45        44      43        42         41       40    39        38      37        36      35        34         33      32   63    62  61    60  59    58    57   56  55   54   53   52   51   50    49   48  S3*D S3*E S3*F各位数=1:有脱离指定 各位数=0:无脱离指定 特殊寄存器的*部根据链接No.来确定。   链接 No.    1    2  3    4  5   6    7    8    *        1        3      5        7      9       B        D        F   5-7
5.2 5.2.1FL远程的初始设定 参数的设定用周边装置来设定“I/O 模块”和“链接参数”。下面,将以 PCwin2 为例,对参数的设定方法进行说明。注1: 参数的变更、追加,请务必从 CPU 中读出“所有程序+参数”后进行。 下面对如下所示组成结构的参数设定方法进行说明。将LS连接在i4上 将阀门连接在O2上子站I/O模块的设定例下面,关于将 L1 作为以太网,将 L2 作为 FL 远程使用时的参数设定例进行说明。机架编号设为 1。1. 启动 PCwin2,设定使用 2ET 的位置。从参数设定中选择机架编号,并将光标对准插槽编号。 按下[Settings(设定)],选择 2ET。               5.2.2   5-8
2. 从链接设定中,像以下那样设定链接参数。      关于未使用链接时的处理关于不使用的端口,请将链接参数的设定放在“Ethernet (32Port)(以太网(32 端口))”中实施。 而且,不需进行链接参数的详细设定。<L2 未设定时>  5-9
〔详细设定的设定步骤〕 FL 远程 M 的详细设定     (1)(2)(9) (8)         (3) (7)(4) (6)(5)               (10)  5-10
(1) “链接区域” 设定通信区域的起始地址。最终地址将根据子站的传输字节数量的合计自动进行设定。可使用的 I/O地址如下所示。• 链接继电器: • 内部继电器:L00L~L7FH、L1000L~L2FFFH、EL000L~EL1FFH M00L~M7FH、M1000L~M17FFH、EM000L~EM1FFH、M000L~GMFFFH X、Y00L~X、Y7FH、EXY000L~EXY7FH、GXY000L~GXYFFFH• 输入输出:注1: GX、GY、GM 区域可在 PC3JG 分割模式中使用。注2: 使用 X、Y 区域时,请在设定中避免与在 CPU 中使用的 I/O 发生重复。(2) “节点名称”请加入 FL 远程-M 的名称。(3) “子站设定列表”从子站设定列表中点击想要设定的子站 No.,并点击[Slave setup(子站设定)],进行子站的详细设 定。详细内容,请参照下页的子站设定。(4) “RUN 停止时的输出状态”设定 CPU 模块的 RUN 停止时的输出状态。设定在“Clear(清除)”上时,RUN 停止后,数据链接的自身节点发送数据将全部变为 0。设定在“Hold(保持)”上时,即使 RUN 停止,也会继续发送 RUN 将要停止之前的数据。(5) “通信异常时的通信停止” 通信异常时,将通信设定在“Stop(停止)”或“Not stop(不停止)”上。设定在“Not stop(不停止)”上时,主机在通信异常时不会向 CPU 进行异常通告,而仅与正常子站继 续进行通信,并在异常子站变为正常后,自动恢复与该子站的通信。(6) “通信异常时的 CPU 动作”设定模块发生异常时的 CPU 动作。设定在“RUN continued(RUN 继续)”上时,即使在通信异常时,RUN 也不会停止。 设定在“Stop(停止)”上时,发生通信异常时,RUN 就会停止。(7) “未连接检测 有效 I/O 地址列表” 关于在子站设定列表中点击到的子站,将显示已在未连接检测“Enable(有效)”中设定的 I/O 地址。(8) “诊断详细设定”设定在相关子站为 FRMT 系列时,将诊断信息(通用状态、短路状态、未连接状态)保存在 CPU 的哪个区域。诊断信息的详细内容,请参照“5.3 诊断信息的收集”。(9) “网络”   关于本项目,没必要进行设定。(10) 设定结束后,请点击画面右上的[OK]。 5-11
〔子局设定的设定步骤〕 FRMT 子站设定画面(1)(2)(3)(4)             (1) (1) “子站连接的设定”选择将相关子站“Do(连接)”到通信线路上还是“Do not(不连接)”到通信线路上。(2) “传输字节数量的设定” M:Master,S:Slave, ←:传输方向用 10 进制来设定相关子站的输入输出字节数量。在 M←S 传输数量中设定输入字节数量,在 S←M 传输数量中设定输出字节数量。I/O 地址的顺序按照传输数量设定栏的上段为前,下段为后的顺序进行分配。上述设定例中的 I/O 地址的顺序虽然是输入为前,输出为后,但点击[Transmission Direction(传输 方向)]后,传输方向将切换为输出为前,输入为后。每个子站的传输字节数量设定范围为输入 0~128,输出 0~128。 传输字节数量的合计为 256 字节以内。(3) “扩展设定”相关子站为 FRMT 系列时,设定如下。 (3-1) “诊断功能”将 FRMT 系列的诊断功能设定为“Enable(有效)”或“Disable(无效)”。诊断信息的详细内容,请参照“5.3 诊断信息的收集”。 (3-2) “未连接检测 有效/无效”在各个接点上设定未连接检测功能的有效或无效。 有勾选的为有效,无勾选 的为无效。00~3F 表示 I/O 地址。(2)  5-12
注: 即使将诊断功能设定为无效,FRMT 侧在诊断功能有效时设定的“未连接检测 有效/无效”数据的值 仍将保留下来。要将诊断功能设定为无效时,请在诊断功能有效下,全部置于无勾选的,然后将 电源由 OFF→ON,使诊断功能变为无效。要将诊断功能设定为无效时,请在诊断功能有效下,全 部置于无勾选的,然后将电源由 OFF→ON,使诊断功能变为无效。(4) 设定结束后,请点击画面右上的[OK]。 5.3 诊断信息的收集FL 远程除了 I/O 数据以外,还拥有“通用状态”、“短路信息”、“未连接信息”、“未连接检测功能的有效/无效 信息”等诊断信息。   I/O 数据与诊断信息的流程 CPU经常进行 I/O 刷新I/O 通信从机(FRMT 系列)     主机(FL 远程 M)         I/O 分配 (1)(2)(3) (4) (5)        I/O 数据I/O 数据      通用状态通用状态     异常履历重置&任 意读出开关    链接参数     未连接检测功能 有效/无效信息  设定值I/O 数据 通用状态 异常履历重置&任 意读出开关 未连接检测功能 有效/无效信息未连接检测功能 有效/无效信息           短路信息短路信息短路信息          未连接信息未连接信息未连接信息        发生短路、未连接时进行 I/O 刷新发出指令 响应数据 通过 FL 远程的链接参数进行的 I/O 分配(详细内容请参照“5.3.1 通过链接参数进行的诊断信息的收集”)(1) I/O 数据:在“链路区域“设定起始地址。(2) 通用状态和异常履历复位&任意读出开关:在扩充设定的“通用状态区域”设定起始地址。(3) 未连接检测功能 有效/无效信息:在每个子站的 I/O 地址上设定“未连接检测 有效/无效”。 该数据在重新投入从机的电源后也仍然会保留。(4) 短路信息:在扩展设定的“短路状态区域”中设定起始地址。(5) 未连接信息:在扩展设定的“未连接状态区域”中设定起始地址。注1: 通用状态、异常履历复位&任意读出开关、未连接检测功能 有效/无效信息、短路信息、未连接信 息的对象子机为 FRMT 系列,只在链路参数中的诊断功能设定为“有效”时有效。注2: 所有子局均设定为“无效”时,节点 01~63 的通用状态和异常履历复位&任意读出开关数据会始终进 行 I/O 刷新,因此,请设定在未使用的区域。 5-13
5.3.1 根据链路参数收集诊断信息“general-purpose status(通用状态)”、“short-circuit data(短路信息)”、“disconnection data(未连接 信息)”在 CPU 上的 I/O 分配,以及“未连接检测功能的有效/无效”设定,用 PCwin2 设定在 FL 远程的链 接参数中。链接参数的设定方法请参照“5.2.1 参数的设定”。初始设定为“general-purpose status area(通用状态区域)”D000L-D003FH、“short-circuit information area (短路信息区域)”D0040L-D007FH、“Un-connect information area(未连接信息区域)” D0080L-D00BFH。基于 PCwin2 的 FL 远程链接参数设定画面    在 FRMT 系列的从机中使用诊断功能时 设定为“Enable(有效)”。设定未连接检测功能的有效/无效。 在 I/O 地址上打勾进行勾选。 有勾选:有效,无勾选:无效     5-14
5.3.2 通用状态用链接参数进行通用状态的 I/O 分配后,可从所设定的起始地址[+00L],将通用状态区域分配在[+1FH]上, 从[+20L],将异常履历重置&任意读出开关区域(详细内容请参照“5.3.3 异常履历重置&任意读出开关”) 分配在 CPU 上。通用状态和异常履历复位&任意读出开关数据以每个节点 1 个字节为单位进行分配。注: 用“FRMT”的链接参数将所有子站设定在诊断功能“无效”上时,节点 01~63 的通用状态及异常履历重置&任意读出开关的数据将不会被分配。 通用状态区域与异常履历重置&任意读出开关区域的分配      相对字节地址  数据        +00L         +00H     节点 01 通用状态   || | | | |     +1FL     节点 62 通用状态   +1FH 节点 63 通用状态         +20L          +20H      节点 01 异常复位&任意读出开关       || |   | | |       +3FL       节点 62 异常复位&任意读出开关       +3FH    节点 63 异常复位&任意读出开关  通用状态区域异常履历复位& 任意读出开关区域  通用状态的格式如下所示。通用状态的格式     位数        内容        0   I/O 端子台 1(I/O 地址 0~F 用端子台)电源电压状态标记 0 :I/O 电源ON 、 1 :I/O 电源OFF     1   I/O 端子台 2(I/O 地址 10~1F 用端子台)电源电压状态标记 0 :I/O 电源ON 、 1 :I/O 电源OFF     2      未使用(不确定)    3    未使用(不确定)     4输入部分未连接检测标记0 :正常(所有点均已连接)1 :有未连接之处(即使只检测出 1 点未连接)输出部分未连接检测标记0 :正常(所有点均已连接)1 :有未连接之处(即使只检测出 1 点未连接)  标志的状态请参照 FRMT 系列 的使用说明书(“2.2.2 未连接检 测功能”)     5 输入部分短路检测标记0 :正常(所有点均正常)1 :有短路之处(即使只有 1 点短路)输出部分未连接检测标记0 :正常(所有点均已连接)1 :有短路之处(即使只有 1 点短路)    发生异常时为 1(最少保持 1s 时间),异常解除 后返回 0。     6       未使用(不确定)    7    未使用(不确定)     5-15
5.3.3异常履历重置&任意读出开关FRMT 系列的从机检测出“短路”及“未连接”后,虽然清除其发生原因后,I/O 控制会自动恢复,但“短路”信息及“未连接”信息以及 I/O_LED 显示的红灯闪烁状态将会保留。 可通过将异常履历重置开关的各种位数设置为 ON 来对这些保留的数据进行重置。可通过将任意读出开关的各种位数设置为 ON 来将各种异常履历信息和当前详细读出到诊断信息映射图 (详细内容请参照“5.3.4 诊断信息映射图”)中。异常履历重置&任意读出开关的格式     位数   内容           0      输入短路异常履历重置(1:重置)   异常履历重置开关注)为 ON 时的启动仅仅有效 1 次。         1   输入未连接异常履历重置(1:重置)     2   输出短路异常履历重置(1:重置)     3    输出未连接异常履历重置(1:重置)     4     输入短路的履历和当前的读出(1:读出)             5      输入未连接的履历和当前的读出(1:读出)        任意读出开关注)为 ON 时的启动仅仅有效 1 次。      6     输出短路的履历和当前的读出(1:读出)       7     输出未连接的履历和当前的读出(1:读出)                     5.3.4诊断信息映射图检测出 FRMT 系列的从机有“短路”及“未连接”时,主机将自动将诊断信息保存在“短路状态区域”及“未连接状态区域”中。 用链接参数设定的“短路状态区域”起始地址[+00L]至[+3FH]的数据格式,请参照(1)短路状态区域的格式。用链接参数设定的“未连接状态区域”起始地址[+00L]至[+3FH]的数据格式,请参照(2)未连接状态区域的 格式。“短路状态区域”和“未连接状态区域”的通用说明(1) 履历信息与当前信息可同时保存。(2) 此区域为 4 级的移位结构,信息 0 为最新数据,后面的数据依次以信息 1→信息 2→信息 3 的顺序进 行位移,数据将从信息 3 开始依次消失。(3) Get/Set 标志(仅信息 0 有效)主机(FL 远程)在设置履历信息和当前信息时,会将 Get/Set 标志的位数 0 设置在“1”上。用顺控程序来监视 Get/Set 标志的位数 0,当其变为“1”时,取出履历信息或当前信息,并使 Get/Set 标志的位数 0 返回“0”(初始值时也需设置在“0”上)。5-16
(1) 短路状态区域的格式    履历       相对地址 内容    数据格式 短路履历信息 0最新数 据                                                   +00L Get/Set 标志    Bit0=0:Get, Bit0=1:Set, Bit1~7=0 固定     +00H (未使用)      00h 固定    +01L 节点地址(Hex) 01h~3Fh(1~63)     +01H (未使用)   00h 固定     +02L 响应代码 Lo      69h    +02H 响应代码 Hi 00h 固定     +03L 错误代码 Lo   信息响应的错误代码 Lo 正常响应时:00h     +03H 错误代码 Hi      信息响应的错误代码 Hi 正常响应时:00h   +04L+04H +05L+05H 短路履历信息 +06L I/O 0~63 +06H+07L+07H                      MSB LSB数值表示 I/O 地址0:正常,1:有短路      07   06   05   04   03   02   01   00    0F   0E   0D   0C   0B   0A   09   08    |    |    |    |    |    |    |    |   |   |   |   |   |   |   |   |    3F   3E   3D   3C   3B   3A   39   38                 短路当前信息 0最新数 据                                                  +08L Get/Set 标志   Bit0=0:Get, Bit0=1:Set, Bit1~7=0 固定     +08H (未使用)   00h 固定     +09L 节点地址(Hex)      01h~3Fh(1~63)    +09H (未使用) 00h 固定     +0AL 响应代码 Lo   67h     +0AH 响应代码 Hi      00h 固定    +0BL 错误代码 Lo 信息响应的错误代码 Lo 正常响应时:00h     +0BH 错误代码 Hi      信息响应的错误代码 Hi 正常响应时:00h   +0CL+0CH+0DL+0DH 短路当前信息+0EL I/O 0~63 +0EH+0FL +0FH                      MSB LSB数值表示 I/O 地址0:正常,1:短路状态      07     06     05     04     03     02     01     00    0F 0E 0D 0C 0B 0A 09 08    |   |   |   |   |   |   |   |   |    |    |    |    |    |    |    |    3F 3E  3D  3C  3B  3A  39  38                 短路履历信息 1        +10L 与短路履历信息 0 相同 |+17H        与短路履历信息 0 相同    短路当前信息 1 +18L 与短路当前信息 0 相同 |+1FH 与短路当前信息 0 相同    短路履历信息 2        +20L 与短路履历信息 0 相同 |+27H        与短路履历信息 0 相同    短路当前信息 2   +28L 与短路当前信息 0 相同 |+2FH     与短路当前信息 0 相同    5-17
    履历     相对地址     内容      数据格式     短路履历信息 3 +30L|+37H 与短路履历信息 0 相同 与短路履历信息 0 相同     短路当前信息 3     +38L|+3FH     与短路当前信息 0 相同     与短路当前信息 0 相同   (2) 未连接状态区域的格式    履历       相对地址 内容    数据格式 未连接履历信息 0最新数 据                                                     +00L Get/Set 标志    Bit0=0:Get, Bit0=1:Set, Bit1~7=0 固定     +00H (未使用)   00h 固定     +01L 节点地址(Hex)      01h~3Fh(1~63)    +01H (未使用) 00h 固定     +02L 响应代码 Lo   6Ah     +02H 响应代码 Hi      00h 固定    +03L 错误代码 Lo 信息响应的错误代码 Lo 正常响应时:00h     +03H 错误代码 Hi      信息响应的错误代码 Hi 正常响应时:00h   +04L+04H +05L+05H 未连接履历信息 +06L I/O 0~63 +06H+07L+07H                      MSB LSB数值表示 I/O 地址0:正常,1:有未连接      07     06     05     04     03     02     01     00    0F 0E 0D 0C 0B 0A 09 08    |    |    |    |    |    |    |    |   | | | | | | | |    3F     3E     3D     3C     3B     3A     39     38               未连接当前信息 0最新数 据                                                  +08L Get/Set 标志   Bit0=0:Get, Bit0=1:Set, Bit1~7=0 固定     +08H (未使用)   00h 固定     +09L 节点地址(Hex)      01h~3Fh(1~63)    +09H (未使用)    00h 固定    +0AL 响应代码 Lo 68h     +0AH 响应代码 Hi   00h 固定     +0BL 错误代码 Lo      信息响应的错误代码 Lo 正常响应时:00h    +0BH 错误代码 Hi    信息响应的错误代码 Hi 正常响应时:00h   +0CL+0CH+0DL+0DH 未连接当前信息+0EL I/O 0~63 +0EH+0FL +0FH                         MSB LSB数值表示 I/O 地址0:正常,1:未连接状态      07     06     05     04     03     02     01     00    0F 0E 0D 0C 0B 0A 09 08    |   |   |   |   |   |   |   |   |    |    |    |    |    |    |    |    3F 3E  3D  3C  3B  3A  39  38                 未连接履历信息 1        +10L 与未连接履历信息 0 相同 |+17H       与未连接履历信息 0 相同    未连接当前信息 1   +18L 与未连接当前信息 0 相同 |+1FH     与未连接当前信息 0 相同    5-18
    履历     相对地址     内容      数据格式     未连接履历信息 2 +20L|+27H 与未连接履历信息 0 相同 与未连接履历信息 0 相同     未连接当前信息 2     +28L|+2FH     与未连接当前信息 0 相同     与未连接当前信息 0 相同     未连接履历信息 3 +30L|+37H 与未连接履历信息 0 相同 与未连接履历信息 0 相同     未连接当前信息 3     +38L|+3FH     与未连接当前信息 0 相同     与未连接当前信息 0 相同   5-19
5.3.5短路、断线信息的处理例构成例 向直接监视器(平板电脑)输出子站 No.41(DRMT-16/16P)的短路、断线履历信息的例子 通用状态保存区域:D0380L~D03BFH短路信息保存区域:D0300L~D033FH断线信息保存区域:D0340L~D037FH 顺控程序例短路信息任意读出 SW 短路重置 SWD3B4-C D3B4-8M000 FUN 111输入短路信息读出输入短路履历重置有短路                  短路履历 Get 标志 D300-0子站 41            有短路M000短路异常[ =DP000FUN 577 D0301L = 41d][ DMOVE [ WMOVT000[ TMRH短路信息→向监视器输出 0h → D0300 ]     短路履历 Get 标志清除    D0304 → EM104W ] FUN 101        FUN 752 [D>H EM104W >0h]M010C=0.00 ] D3B4-DM020 D3B4-9M001发生短路(检修呼叫蜂鸣器等)*1*1      断线检测标志D394-C 断线信息任意读出 SW断线通告延时T000*1K=2.00断线通告延时输入断线信息读出输出断线信息读出断线信息读出输入断线履历重置输出断线履历重置有断线                 D3B4-F             断线重置 SW断线履历 Get 标志 D340-0P001       D3B4-B                  有断线M001[ =D子站 41 FUN 577D0341L = 41d]断线信息读出M020*1[ DMOVE [ WMOVFUN 111D0344 → EM106W ]     断线信息→向监视器输出FUN 1010h → D0340 ]     断线履历 Get 标志清除              断线异常 FUN752[D>H EM106W >0h]端子台 1_I/O 电源状态 D394-8端子台 2_I/O 电源状态 D394-9M011EM1060 EM1061发生断线(检修呼叫蜂鸣器等)I/O 电源 1→向监视器输出 I/O 电源 2→向监视器输出                    *1 忽略 2 秒以内的瞬间断线的回路例5-20 
5.4 FL远程的异常通告在 FL 远程中进行异常检测时,将向 FL 远程和 CPU 进行异常通告。 在 FL 远程中,采用 MS、NS 的指示灯和信息显示器来进行异常通告。在 CPU 中,采用特殊继电器 、特殊寄存器(错误信息输出用寄存器、链接错误信息输出用寄存器)与信 息显示器来进行异常通告。另外,可用特殊寄存器来确认 FL 远程的通信状态。MS、NS 的各指示灯中分别有绿色和红色的指示灯,通过亮灯/闪烁/熄灯来表示以下的状态。MS、NS 的各指示灯中分别有绿色和红色的指示灯,通过亮灯/闪烁/熄灯来表示以下的状态。另外,ERR 指示灯通过亮灯/闪烁/熄灯来表示以下的状态。       指示灯名称指示灯的状态和内容       通信连接器MSL1NSMSL2NSMS. 显示硬件的状态。 亮绿灯:硬件正常亮红灯:硬件发生错误熄灯:程序非运行中 NS.显示通信的状态。亮绿灯:远程操作中 闪绿灯:FL 参与中 亮红灯:链接参数异常 闪红灯:通信异常 闪红绿灯:设定异常 熄灯:电缆未连接                           5-21
5.4.1 CPU中的错误通告 (1) 特殊继电器全站通信中标志在正常时为 ON,其他的标志在异常时为 ON。    地址     内容      正常      异常    VA0 VA4 VA8 VAC VB0 VB4 VB8 VBC链接 No.1 链接 No.2 链接 No.3 链接 No.4 链接 No.5 链接 No.6 链接 No.7 链接 No.8全站通信中全站通信中全站通信中全站通信中全站通信中全站通信中全站通信中全站通信中注)脱离设定后为 0  ON OFF     VA1 VA5 VA9 VAD VB1 VB5 VB9 VBD  链接 No.1 链接 No.2 链接 No.3 链接 No.4 链接 No.5 链接 No.6 链接 No.7 链接 No.8链接参数异常链接参数异常链接参数异常链接参数异常链接参数异常链接参数异常链接参数异常链接参数异常    OFF   ON     VA2 VA6 VAA VAE VB2 VB6 VBA VBE 链接 No.1 通信异常 链接 No.2 通信异常 链接 No.3 通信异常 链接 No.4 通信异常 链接 No.5 通信异常 链接 No.6 通信异常 链接 No.7 通信异常 链接 No.8 通信异常    OFF   ON     VC4 特殊模块的异常(通信模块故障)    OFF   ON     VC8    I/O 构成异常(通信模块的安装超过了规定数量。)     OFF     ON    VF2  特殊模块的分配异常(链接参数的机架 No.、插槽 No.、链接模块名称与安装状态不同。    OFF   ON   5-22)
(2) 特殊寄存器FL 远程在 PLC 的下述地址中保存异常时及通信状态的信息。    地址       内容    S200 S24F              CPU 错误信息输出用寄存器      S3#0 S3#1 S3#2 S3#3 正常从机信息区域 表示各从机的通信状态(正常/异常)。     S3#4   主机状态区域 表示主机与网络的状态。*1     S3#5   软件版本(BCD)     S3#6      标记重发次数    S3#7    标记保持超时次数    S3#8    标记监控超时次数    S3#9 S3#B           系统预约       S3#C S3#F             连接站设定状态       S3*0 S3*B                链接错误信息输出用寄存器      S3*C S3*D S3*E S3*F   脱离寄存器   注1: 上述地址的#及*部分根据链接 No.来确定。 基于各链接 No.的#、*等如下表所示。注2: 保存在这些寄存器中的信息,在异常恢复后也不会被清除。需要清除时,请用 I/O 监视器及编程器 等,在寄存器中写入“0000”。   链接 No.    1    2   3  4    5  6    7    8    #          0        2      4    6        8    A       C      E   *       1      3     5   7      9   B      D     F   5-23~ ~~~
*1 关于 S3#4 主机状态区域15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 0节点地址重复 E7传输异常 D9 对照异常 D6主机通信速度 [0:10M 1:100M]通信准备中 1:通信准备中(电源投入后至通信确立期间)公用存储器发送区域重复 异常 E8.E9 异常发生中(发生了 Bit1,6,7,10 的错误)I/O 通信动作中              *       *   *                                *      *   *      *         *            5-24
(3) CPU 错误信息输出用寄存器检出异常时,将错误代码、错误相关信息及错误检出时刻保存在错误信息保存用特殊寄存器中。该寄 存器为 8 级(PC10 模式时为 64 级)移位寄存器结构,可存储最大 8 次的异常发生。异常超过 8 次 (PC10 模式时为 64 次)时,将从最初保存的错误信息开始依次消失。保存在此寄存器中的错误信息可通过周边装置来显示。  CPU 错误信息输出用特殊寄存器的寄存器内容CPU 错误信息输出用特殊寄存器的内容 地址S200 S20A S214 S21E S228 S232 S23C S246 S24F           错误0 信息错误代码           错误1 信息错误相关信息 1(下位)、2(上位)          错误2 信息错误相关信息 3(下位)、4(上位)          错误3 信息错误检出时刻(秒)          错误4 信息错误检出时刻(分)          错误5 信息错误检出时刻(时)          错误6 信息错误检出时刻(日)          错误7 信息错误检出时刻(月)        错误检出时刻(年)     错误检出时刻(星期)0~6:周日~周六      消失HL         异常 0       异常 1       ·       ·       ·       ·       异常 62       异常 63        程序 No     异常代码   相关信息 2      相关信息 1   相关信息 4  相关信息 3   相关信息 6      相关信息 5   相关信息 8    相关信息 7   时刻(分)  时刻(秒)   时刻(日)      时刻(时)   时刻(年)    时刻(月)  S1000S1008 ·· · ·S11F0 S11F8S1000S1001 S1002 S1003 S1004 S1005 S1006 S1007 5-25
 错误相关信息          错误代 码    I/O 监视器的错误信息    错误内容      相关 1     相关 2     相关 3     相关 4      备注         84I/O MODULE ERROR 2 通信模块 故障  *分类 机架编 号 插槽编 号 - *2:CPU 检出 1、3:链接检出    88 FUNC. I/O OVER 1   24 个以上通信模块的 安装    -   -   -   -   VC8 ON           85 LINK PRAM. ERROR   链接参数异常    链接编 号   -   -   -       86   LINK ERROR    通信异常      链接编 号     -     -     -         89  FUNC. I/O ALARM   链接参数的机架 No.、 插槽 No.、模块名称异 常    机架编 号   插槽编 号   -   -   VF2 ON   注: 与内置 FL 遥控器的错误代码不同。5-26警报 重度异常
(4) 错误信息输出用特殊寄存器在 FL 远程中进行异常检测时,对 CPU 进行异常通告的同时,将 FL 远程的错误代码保存在链接错误  信息输出用特殊寄存器中。该寄存器为 8 级移位寄存器结构,最大可存储 8 次的异常发生。异常超过 8 次时,将从最初保存的 错误信息开始依次消失。 链路错误信息输出用特殊寄存器的寄存器内容    链接 No.    错误显示地址      1         S310~S31F    2     S330~S33F       3       S350~S35F       6    S3B0~S3BF     7   S3D0~S3DF     8     S3F0~S3FF       地址        MSB 内容 LSB        S3*0             节点地址(HEX)          错误代码(hex)    S3*1     实际输入字节数(HEX)低 位     实际输出字节数(HEX)低 位         S3*2         输入字节数(HEX)低位 输出字节数(HEX)低位字节地址、错误代码保存区 1 新 字节地址、错误代码保存区 2 字节地址、错误代码保存区 3 字节地址、错误代码保存区 4 字节地址、错误代码保存区 5 字节地址、错误代码保存区 6 字节地址、错误代码保存区 7 旧                  S3*5 S3*6 S3*7 S3*8 S3*9 S3*A S3*B                注1: *将根据链接 No.确定。注2: S3*1~S3*4 可保存对照异常(输入输出字节数量不一致)时的输入输出字节数量。仅在 S3*0 的错 误代码中发生 D6(对照异常)的异常时表示。除此之外时,为“0000”。S3*1:子机的实际输入输出字节数 低位 S3*2:链路参数中的输入输出字节设定值 低位例 S3*0 02D6S3*1 0400S3*2 0004从机 02 的对照异常从机02为 输入04字节 输出00字节 在参数中, 输入 00 字节 输出 04 字节   链接 No.    1   2    3  4   5    6   7    8    *            1        3          5      7        9          B        D        F    5-27
 错误代码详细内容与 FL 远程的错误显示                                          FL 远程                                                                                  错误代码 显示内容 S03*0 S03*1 内容             89 E5 --- --- 链接参数未设定         85 E7 00F0 00F2 自节点号码重复异常         85 ED 00ED 0000 区域超出             85 E6 0021 0000 字节数合计超过限制值          85 E6 0022 0000 有字节数为 0 的局号          85 E6 0023 0000 1 子机的输入或输出字节数超过限制值         85 E6 0025 0000 通信区域超出         85 E6 0026 0000 CPU 的输入输出和通信区域重复          85 E6 0027 0000 模块子代码异常          85 E6 0028 0000 模块 No.异常         85 E6 0029 0000 最小允许帧间隔异常          85 E6 002A 0000 自身节点编号异常          85 E6 002B 0000 网络地址异常             86 E8 E8 0000 共用内存1重复异常          86 E9 E9 0000 共用内存2重复异常         86 EA EA 0000 标记监视超时异常          86 EB EB 0000 循环数据读取异常          86 EC EC 0000 循环数据写入异常        对照异常S03*1 H 实际输入字节数(HEX) S03*1 L 实际输出字节数(HEX) S03*2 H 输入字节数(HEX)86 D6 ##D6 II00 S03*2 L 输出字节数(HEX)         86 D9 ##D9 0000 传输异常             84 H5 --- --- CPU 模块 NAK 应答              84 Hd --- --- 特殊模块分配过大或 2ET 硬件异常             84 H0 84 H1 84 H2 84 H3 84 HE 84 HF 84 HL 84 HU--- --- --- --- --- --- --- --- --- --- --- --- --- --- --- ---2ET 模块硬件异常                                                        84 H4 84 H684 H784 H884 H984 HA 84 HC--- --- --- ------ ------ ------ ------ --- --- ---2ET 模块与 CPU 模块的接口部硬件异常                                                         89 DL --- --- 维护模式               5-28
注1: 特殊寄存器 S3*0 的*部分根据链接 No.来确定。   链接 No.    1    2   3  4    5   6   7    8    *            1          3        5      7          9        B        D        F   S3*0 的内容##:异常从机的节点地址 5.4.2 通信状态FL 远程将通信状态输出到特殊寄存器中。(1) 正常从机信息区域是表示各从机的通信正常/异常状态的区域各子机的状态标记输出到特殊寄存器 S3#0~3#3 中。 各位数 No.表示节点地址(站号)。MSB LSBS3#0S3#1 S3#2 S3#3各位数=1:通信正常状态 各位数=0:通信异常状态(或未使用站) (发生传输异常或对照异常。) 特殊寄存器的#部分根据链接 No.来确定。注1: 在子机为分离指定状态或根据链路参数的设定“通信异常时通信不停止”的情况下,标记仍发挥功能。 (2) 通信状态确认功能      本功能可作为通信线路稳定性的基准。即使发生错误,也不一定就是通信异常。错误多发时,导致      通信异常的可能性会变大。 通信错误信息区域的内容各个错误内容(6 种)可分别输出到特殊寄存器 S3#6~3#8 内。地址的#部分根据链接 No.来确定。• 错误次数最大计数至 65535(FFFFh)次。• 错误次数可通过电源断开及 CPU 重置来清除。      但是,在通信重置中不会被清除。    15     14    13    12    11    10    9    8   7    6    5    4    3    2    1      31         30         29       28       27       26       25       24       23       22       21       20       19       18       17     16  47    46      45    44    43    42    41    40    39    38    37    36    35    34    33    32  63    62    61   60   59   58   57   56   55   54   53   52   51   50   49   48     链接 No.    1   2    3   4  5    6   7    8    #        0        2            4        6    8            A        C      E       地址       内容    S3#6 标记重发次数     S3#7      标记保持超时次数    S3#8   标记保持超时次数      链接 No.   1    2  3    4  5    6  7     8   #     0       2   4       6   8       A   C       E   5-29
 错误次数保存线路错误次数(错误信息区域)的内容可通过电源断开及通信异常时的 CPU 重置来清除。因此,为了保存发 生异常时错误次数的内容,请编制以下所示的时序电路。例. 以下为发生通信异常时,将子机状况、主机状态、错误次数、发生时刻保存到寄存器的顺序例。 通信异常标志(链接 No.1) VA2T000 P***T000 TMRWBMOV WBMOVK=1.0       1 秒计时器                    S3#0 → D0FF0= 0012d S019 → D0FFC= 003d从机状况主机状态错误次数传输发生时刻传输         特殊寄存器的#部分根据链接 No.来确定。通信异常标志的地址根据链接 No.来确定。根据上述命令,D0FF0~将变为以下这样。D0FF0 1 2 3 4 5 6 7 8 9 A B C D E   链接 No.    1  2   3    4   5  6    7   8   #       0   2     4       6     8   A       C    E      链接 No.    1   2   3  4    5   6   7    8   通信异常标志       VA2     VA6    VAA   VAE       VB2     VB6     VBA     VBE           正常从机信息区域            主机状态区域            错误次数                    时刻 分、秒 (BCD)    时刻 日、时 (BCD)    时刻 年、月 (BCD)5-30
(3) 连接站设定信息区域是表示 CPU 的链接参数中设定的从机连接状态的区域。各子机的状态标记输出到特殊寄存器 S3#C~3#F 中。 各位数 No.表示节点地址(站号)。MSBLSB    15     14    13    12    11    10    9    8   7    6    5    4    3    2    1      31       30    29    28    27    26    25    24    23    22    21    20    19    18    17  16   47         46         45       44       43       42       41       40       39       38       37       36       35       34       33     32  63    62    61   60   59   58   57   56   55   54   53   52   51   50   49   48  S3#CS3#D S3#E S3#F各位数=1:进行连接 各位数=0:不进行连接 特殊寄存器的#部分根据链接 No.来确定。   链接 No.       1        2          3      4          5     6         7            8    #    0    2  4    6  8   A    C   E   5-31
5.4.3 错误内容与推定原因     特殊 寄存器 内容 注)      主机7段 错误内容 显示H5 CPU 模块 NAK 应答       主要推测原因       排除方法     - (1) CPU的参数设定未能正常进行 (2) 在与FL-net的16KB模式、32KB 模式不对应的 CPU 模块中进行了此项设定(3) 2ET模块、CPU模块或基板的 故障  (1) CPU模块参数设定的复核(2) 开关设定的修正(3) 2ET模块、CPU模块或基板的更换     -    Hd特殊模块分配过大或 2ET 模 块硬件异常       2ET 模块故障或 CPU 模块发生了错 误代码 81 的“特殊模块分配过大”的 问题。       请更换模块。        -H0 H1 H2 H3 HE HF HL HU2ET 模块 硬件异常                            2ET 模块故障                      请更换模块。                     -     -     -     -     -     -     -     -    H4H6H7H8H9HAHCE6 字节数量的合计超出了限制值      2ET 模块与 CPU 模块的接口 部硬件异常                     是因为 2ET 模块或 CPU 模块、I/O 电缆、基板的故障,而导致 2ET 模 块和 CPU 模块之间的数据交换无法 正常进行的状态。                         请依次更换 2ET 模块、CPU 模块 I/O 电缆、基板。                        -     -     -     -     -     -     0021 链接参数异常• CPU 本体的存储器中发生了异 常。• CPU 本体的电池电压下降引起 的存储器内容消失。          请重新写入正常的参数,并进行重 置或电源重新接入。 详细内容请参考 CPU 使用说明书                     0022         E6 存在字节数为 0 的机       0023 E61 子机的输入或输出字节数超 过限制值     0024         E6 I/O 指定异常       0025 E6 区域超出     0026      E6 CPU 的 I/O 和区域重复     0027         E6 子代码异常       64F0    E7 主机重复      • 2 台以上的主机模块连接在网络 上• FL-net 模块连接在同一网络上         • 请将其他主机模块从网络上断 开后重新接入电源。• 请将 FL-net 模块从网络上断 开后重新接入电源。      00E8    E8公用存储器发送区域地址重复(继电器链接)       00E9 E9公用存储器发送区域地址重复(寄存器链接)     00EB         EB 循环数据读入异常      • FL-net 模块连接在同一网络上       • 请将 FL-net 模块从网络上断 开后重新接入电源。         00EC    EC 循环数据读入异常    5-32、。
   特殊 寄存器 内容 注)        主机 7段 显示      错误内容   主要推测原因       排除方法    00EA   EA 标记监视超时 标记监视超时错误在链接参数的“network(网络)”中设定的标记监视超 时时间内,未能发送自身节点的所有数据时会发生。请将标记监视超时时间的“Automatic(自动)”复选框设置为 ON,或加 大设定时间。     ##D6       D6  对照异常(字节数量不一致)  子机的输入输出字节数与链路参数的输入输出字节数存在不一致。     请确认所连接的子机输入输出字节数,变更链路参数。* 变更子机的节点地址后,请重 新接通子机电源并变更链路参 数。 拆下子机后,也需要变更链路 参数。   ##D9         D9       传输异常   从机无法加入通信。子机脱离。     请进行通信重置或电源重新接入, 或 CPU 重置。反复发生时,请确 认从机及 HUB 上有无供电。请确 认节点地址有无重复。请确认电缆 有无断线或短路。使用其他公司生 产的从机时,请参照该从机的使用 说明书。通信电缆请远离噪声源。         局号显示    MS 指示灯、NS 指示灯均亮绿 灯,并正常通信,但输入输出 数据不正确。 • 存在分离指定的子局。• 通信区域重复。• 输入输出地址顺序设定错误。 • 顺序程序覆盖通信区域    • 请确认分离寄存器的相应子局 是否设定为 0(无分离指定)。• 请确认主机参数中设定的通信 区域与其他链路模块的通信区 域是否重复。• 请确认主机参数中设定的输入 输出地址顺序是否正确。• 请确认有无通过顺序程序覆盖 通信区域。   5-33
6 EtherNet/IP通过在 Nano CPU 中安装 2ET,使其可以作为 EtherNet/IP 设备来使用。周边设备请使用 PCwin2。 6.1 概要所谓 EtherNet/IP,是指以广泛使用的以太网技术为基础的产业用网络。本标准通过 ODVA(Open DeviceNet Vendor Association)来管理,并在全球众多的设备中采用。通过使用 EtherNet/IP,控制器之间的网络自不必说,还可构建起控制器与设备之间的现场网络。<系统概要>EtherNet/IP 是一个多供应商的网络。因此,加入 TOYOPUC-Nano 之间的数据链接中后,TOYOPUC-Nano 还可以同其他公司生产的 EtherNet/IP 对应控制器及远程 I/O 设备等进行连接。   交换式集线器     TOYOPUC-Nano 2ET 扫描仪     TOYOPUC-Nano 2ET 扫描仪其他公司制控制器 其他公司制 远程 I/O 扫描仪 适配器   2ET 是与 EtherNet/IP 的扫描仪对应的设备。既可以在 PCwin2 上进行发端连接和目标连接两个扫描列表的设定,还可以与安装了 CIP 的 Transportclass1 的其他公司 EtherNet/IP 控制器、I/O 设备连接(与 Transport class3 不对应) 。所谓扫描仪 ···· 是指可在扫描仪-扫描仪之间或扫描仪-适配器之间构筑起连接的设备。扫描仪具有打开其他设备连接的发端功能。所谓适配器 ···· 是指自身不具有打开连接功能的设备。要想进行 EtherNet/IP 通信,就必须打开来自扫描仪的通信。远程 I/O 设备等中较多的类型。 所谓连接 ······· 是指用 EtherNet/IP 进行数据通信所需的通信线路。注意1: 不可在适配器之间进行数据链接。注意2: 与其他公司制设备的连接有一定限制。详细内容请参照下页的注意事项。6-1 6
6.2 EtherNet/IP规格    项目       规格     物理层 100BASE-TX    传输速度     100 Mbps    最大电缆长度 Max 100 m(节点-节点之间(1 对 1 连接时)、节点-HUB 之间、HUB-HUB 之 间)    最大连接数量     384    会话数量(I/O 连接数量+UCMM 使用 端口数量合计)   最大 384    RPI (数据包间隔) 0.5~32.5 ms:0.5 ms 单位进行设定 33~10000 ms:1 ms 单位进行设定    发送触发器   Cyclic / Change of state(COS)    连接类型   Point2Point / Multicast    连接设定应用程序类型     Exclusive Owner/Input Only    通信超时时间 [ms] RPI x *( *= 4, 8, 16, 32, 64, 128, 256, 512)    设备允许带宽     3000 pps    每个连接的最大链接规模 504 字节或 1448 字节(Large Forward Open 规格对应)    全连接 规模   24 Kbyte    每个连接的输入输出区域数量     最大 8    可登录的输入输出区域数量   最大 1000    通用 TCP 端口   8口  *1 关于在目标中使用多点传送时的连接占用率,请参照“6.4.2 链接参数的设定”-“(2-2) 发端”-“(d-2) 连 接类型”中的注意事项。        功能            NanoCPU 中可设定数量     16   可设定通信区域       I/O 识别码 L,X/Y,M,EL,EX/EY,EL,GX/GY*1,GM*1     寄存器      识别码 R,D,U*1    每个连接的输入输出区域数量   最大 8    可登录的输入输出区域数量     最大 1000    通信脱离站的输入 清除/保留 可设定    RUN 停止时的输出   清除/保留 可设定    脱离连接设定   可通过参数设定  注意1: 用 Transport Class1 连接不可与以下这种设定的设备进行连接。(1) 连接类型与“Point to Point”或“Multicast”不对应的设备。(2) 触发器与“Cyclic”或“Change of State (COS)”不对应的设备。(3) 传输类型为“Listen Only”或“Redundant Owner”的设备。(4) 实时格式为“零长度格式”的设备。(5) 网络连接参数的 Fixed / Variable 为“Variable(可变) ”的设备。(6) 需通过数据段进行参数设定的设备。注意2: 与 Transport Class3 不对应。注意3: PCwin2 没有 EDS 文件抓取功能。注意4: TOYOPUC-Nano 的 EtherNet/IP 与 DHCP 服务器功能、BOOTP 功能不对应。关于本书中未加以说明的用语,请参照 CIP 规格书。所谓 EDS 文件·····是指由各供应商提供的 EtherNet/IP 设备的设定信息所记述的文件。6-2
6.3 I/O通信功能1) 连接想要进行数据的收发,就必须打开与对方设备的连接。 打开连接的一侧称为发端侧,被打开的一侧称为目标侧,从发端侧向目标侧请求开放连接。 开放成功后,即可进行数据通信。TOYPUC-Nano 的 EtherNet/IP 可使用发端和目标双方的功能。 连接的建立有以下几种方法。<Exclusive Owner> 是一个连接中,可从发端向目标和从目标向发端进行双向数据通信的功能。 可在连接点设定为实例 ID 时使用。为标签时不能使用。 (关于连接点,请参照下页的 2) 数据的分配。) TOYOPUC-NanoTOYOPUC-Nano 或其他公司 EtherNet/IP 模块目标     建立连接  发端    输入I/O 数据输出   I/O 数据   输出输入 <Input Only> 是在一个连接中,可从目标侧向发端侧进行数据通信的设定。 连接点为标签指定时,如下所示,可通过设置 2 个连接,进行双向的通信。 TOYOPUC-NanoTOYOPUC-Nano 或其他公司 EtherNet/IP 模块目标发端     建立连接  发端   输入输出 I/O 数据    建立连接  目标  I/O 数据   输出输入 6-3
2) 数据的分配 建立连接时,在目标侧上设置的连接点将从发端侧进行指定。 连接点的指定方法有实例 ID 和标签 2 种方式。a) 实例ID是用实例 ID(0~65535 的编号) 来指定对方设备连接位置的通信方法。 在发端侧指定作为对象的目标侧连接的 ID。 在连接的详细设定中设定输入输出区域的地址。PLC A连接点发端→目标 ID=“101” 目标→发端“100”PLC B    CPU用户存储器EtherNet/IP通信功能部分EtherNet/IP通信功能部分CPU用户存储器         输入区域 输入区域输出区域 输出区域          输入区域          输出区域实例 ID实例 ID   I/O 刷新进行上述指定后,请求开放数据“100”I/O 刷新输出区域  输出区域   输出区域 连接点数据“101”目标  输入区域  I/O 刷新I/O 刷新 输入区域   输入区域                         发端6-4
b) 标签是用标签(变量名称) 来指定对方设备连接位置的通信方法。PLC APLC B    CPU用户存储器EtherNet/IP通信功能部分tag_456”目标连接点 EtherNet/IP 通信功能部分指定标签名称 “tag_123”后,请求开放CPU用户存储器        标签名称   输入区域 输入区域输出区域 输出区域”tag_123”输出区域      I/O 刷新数据I/O 刷新输出区域            输入区域 发端标签名称“指定标签名称“tag_456”后,请求开目标输出区域    放数据    I/O 刷新      连接点  输出区域发端I/O 刷新输入区域输入区域   输入区域                           3) 连接的建立 发端侧在电源接通,且可开始通信的状态下,向连接位置上设定的目标连接请求建立连接。目标侧为 可应答状态,并针对来自发端侧的连接请求,判断可以连接时,即可建立连接。在目标侧,将用发端侧的连接请求来确认 ID(或标签) 信息、数据容量等。 发端侧和目标侧中参数信息不一致时,将无法建立连接。发端侧与目标设备不能建立连接时,将成为连接异常,并更新各状态信息。关于状态,请参照 6.5 章。 发生连接异常时,发端将进行重新连接。 对方设备及网络设备没有问题时,虽然会再次建立连接,但由于网络构成及连接设定状况的不同,重 新连接有时会需要 1 分钟左右的时间。4) 数据包间隔(RPI)建立连接后,发端侧和目标侧两方面将以一定间隔来发送数据。这个间隔就叫做数据包间隔。可设定 范围为 2~10,000 ms。数据包间隔可分别设定为发端→目标(OT) 方向、目标→发端(TO) 方向。 数据的发送间隔以 2 ms 为一个刻度单位。设定值为奇数时,将把设定值舍入到偶数后发送。例如, 数据包间隔的设定值为 5 ms 时,将以 6 ms 的间隔进行发送。连接点中使用了标签时,仅设定 TO 侧数据表间隔的值。OT 侧的数据表间隔可使用 TO 侧的设定值。但是,TO 侧的设定值小于 250 ms 时,将以 250 ms 的间隔进行发送。注意: 在其他公司制的设备中,有些设备可将 RPI 设定在 2 ms 以下。将 RPI 设定在 2 ms 以下时, 有时会引起通信异常。另外,将 RPI 设定在 2 ms 以下时,无论设定值是多少,来自 2ET 的 数据发送间隔都是 2 ms。RPI 请在 2 ms~10,000 ms 的范围内进行设定。6-5
5) 通信超时 在连接建立后,数据通信可实施的状态下,接收数据中断一定时间时,将成为连接异常,数据通信将 停止。接收数据的监视时间用数据包间隔的设定值和通信超时乘数来确定。通信参数乘数可从 RPIx4, RPIx8, RPIx16, RPIx32, RPIx64, RPIx128, RPIx256, RPIx512 中选择。例如,数据包间隔为 50 ms,超时为 RPIx8 时,如果在 400 ms 的时间内未能接收数据,就会成为连 接异常。成为连接异常时,将停止该连接的发送动作,并更新各状态信息。 关于状态,请参照 6.5 章。RPI 为 10 ms 以下时,超时请设定在 RPI x 8 以上。6) 通信负载EtherNet/IP 可通过数据包间隔来确定所发送的数据量。数据包间隔如果是较大的值,则通信负载变  小,数据包间隔较小时,通信负载将变大。设定多个连接,并以较小的数据包间隔运行时,模块将承受较大的负载。可收发数据包的量有一定限 度,超出这个限度时,就无法正常运行。  因此,在构建系统时,需进行连接数量与数据包间隔的设定,避免超出模块的能力。  可进行通信的数据量,大致可使用单元允许带宽,用以下的计算公式计算得出。计算结果用负载率来表示,负载率超过 100%时,请复核 RPI 的值等,将通信负载设定为合适的值。 另外,在同一线路上有 EtherNet/IP 通信以外的其他设备等混用时,请以具有更大余量的负载设定进 行使用。负载率 = 各连接的负载率合计 [%]各连接的负载率 = ((1000 / TO 侧 RPI) +(1000 / OT 侧 RPI)) / 3000 pps × 100 [%]单元允许带宽注: 连接点中使用标签时的 OT 侧的 RPI 如下所示。 TO侧RPI为250ms以下时: OT侧RPI=250ms。 TO 侧 RPI 大于 250 ms 时: OT 侧 RPI = TO 侧 RPI。  6-6
负载率计算 例)在这里,考虑设 3 台 TOYOPUC-Nano。左起,分别称为 A、B、C。 在 A 和 B 之间,设定了实例 ID 通信。在 A 和 C 之间,设定了标签通信。A、B、C 各自的发端、目标和 RPI 的设定值如下图所示。TOYOPUC-Nano ATOYOPUC-Nano BCRPI=20 ms RPI=20 msRPI=50 ms RPI=250 ms就各 TOYOPUC-Nano (A,B,C),计算负载率,确认有无超出 100%。 TOYOPUC-Nano ATOYOPUC-Nano A 由于使用了 2 个连接,因此,要就各连接计算负载率,最后合计求出 A 的负载率。实例 ID 通信的负载率负载率={(1000 / 20) + (1000 / 20) }/ 3000 pps × 100= 3.3 [%]标签通信的负载率负载率={(1000 / 50) + (1000 / 250) }/ 3000 pps × 100= 0.8 [%]合计负载率= 3.3 + 0.8= 4.1[%]TOYOPUC-Nano B求出 TOYOPUC-Nano B 的负载率。负载率={(1000 / 20) + (1000 / 20) } / 3000 pps × 100 = 3.3 [%]TOYOPUC-Nano C求出 TOYOPUC-Nano C 的负载率。负载率={(1000 / 50) +(1000 / 250) } / 3000 pps × 100 = 0.8 [%]由于所有的 TOYOPUC-Nano 的负载率都在 100%以内,所以,以该设定可以毫无问题地使用。注意: RPI 的值设定过小时,负载率将变高。在不需进行高速通信的地方,RPI 请尽可能设定较大的值, 以避免抬高负载率。TOYOPUC-Nano                 实例 ID 通信标签通信 目标 发端          目标发端  6-7
6.4 6.4.1EtherNet/IP的设定方法想要实施 EtherNet/IP 的通信设定,请使用 PCwin2。I/O模块的设定在 Nano CPU 的 I/O 模块中追加 2ET。(1) 从项目中双击参数的 I/O 模块。(2) 选择机架=“0”,插槽=“1”~“7”,并点击设定按钮。            6-8
(3) 选择模块种类=特殊/通信,选择显示出来的“2ET”。 (分配点数、识别代码会在“2ET”的选择中自动输入。)(4) 点击 OK 按钮。      (5) 点击 OK 按钮。  2ET 已被选中。  6-9
6.4.2链接参数的设定 链接模块的分配在 Nano-CPU 中进行通信相关的模块设定。(1) 从项目中双击参数的链接参数。(2) 选择设定 EtherNet/IP 的程序 No.及链接 No.。(3) 点击链接设定按钮。确定设定 EtherNet/IP 的链接 No.。(任意) 在这里,作为例子,选择了链接 No.1。           (4) 在机架 No.、插槽 No.中选择机架 0、插槽 1~7。(5) 从链接模块名称中选择“EtherNet/IP”。(6) 端口选择“Port A (端口 A)”或“Port B (端口 B)”。6-10
(7) 点击 OK 按钮。        打开标签,选择 EtherNet/IP。(8) 确认 EtherNet/IP 是否为选择状态,并点击“Detail (详细设定)”按钮。在 EtherNet/IP 已被选择的状态下,点击详细设定。      6-11
链接参数详细设定 (1) 自身节点 IP 地址  显示进行设定后的结果。 (6) 目标设定保存     (2) 个别设定(3) 列表设定(4) 选项 (5) 网络详细设定 (1) 自身节点IP地址设定自身节点地址。IP 地址请从以下列表中进行设定。128.0.0.0~223.255.255.2556-12
(2) 个别设定在所选择的连接 No.中进行设定。1. 选择“Do (进行)”连接设定。2. 功能从“Target (目标)”、“Originator (发端)”中选择。3. 按下设定按钮,就功能进行设定。   从“目标” “发端” 进行选择。    (2-1) 目标的设定 进行目标的设定。(a)(b) (c)(d)         (a) 通信方式从“Instance ID (实例 ID)”、“Tag (标签)”中选择通信方式。(b) 目标→发端 信息 设定目标→发端 信息。(b-1) 连接点 设定连接点。   通信方式   ID   可设定的值   实例 ID    以数值进行设定。     100~199, 768~1279    标签   以标签名称(字符串) 进行设定。   字母(有大写小写区别) 数字、符号(有部分符号不可使用)  6-13
(b-2) 输出设定 输出区域可设定 8 个区域。注意: 可使用的区域数量为输入区域、输出区域合计 1000 区域为止。(b-3) 地址 地址可设定以下的区域。可设定区域    继电器链接     寄存器链接    M00L~7FH, L00L~7FH, X,Y00L~7FH, EM00L~1FFH, EL00L~1FFH, EX,EY00L~7FH, GM000L~FFFH, GX,GY000L~FFFH   R0000~07FF, D0000~FFF, U0000~7FFF  注意: 地址中请务必设定 L(Low)或 H(High)。(例D000L 及R100H 等)(b-4) 字节数就 8 个区域分别设定输出区域的字节数量。 根据所设定的实时格式,能够设定的合计字节数量上限会有所不同。 8 个区域的字节数量合计请务必设定在以下范围内。(b-5) 异常时的状态异常时的状态可从 OFF(默认) /保留中选择。关于设定为 OFF 或保留时的动作,请参照“6.8 异常时输入输出的设定”。    实时格式     可设定的字节数量范围    Modeless Heartbeat 0~1448 字节    32birHeader   0~1444 字节 6-14
(c) 发端→目标 信息 设定发端→目标 信息。(c-1) 连接点 设定连接点。(c-2) 输入设定输出区域可设定 8 个区域。注意: 可使用的区域数量为输入区域、输出区域合计 1000 区域为止。(c-3) 地址 地址可设定以下的区域。可设定区域   通信方式   连接点   可设定的值   实例 ID    以数值进行设定。     100~199, 768~1279    标签   不可设定   不可设定       继电器链接     寄存器链接    M00L~7FH, L00L~7FH, X,Y00L~7FH, EM00L~1FFH, EL00L~1FFH, EX,EY00L~7FH, GM000L~FFFH, GX,GY000L~FFFH   R0000~07FF, D0000~FFF, U0000~7FFF  注意: 地址中请务必设定 L(Low)或 H(High)。(例 D000L 及 R100H 等)6-15
(c-4) 字节数就 8 个区域分别设定输入区域的字节数量。 根据所设定的实时格式,能够设定的合计字节数量上限会有所不同。 8 个区域的字节数量合计请务必设定在以下范围内。(c-5) 异常时的状态异常时的状态可从 OFF(默认) /保留中选择。关于设定为 OFF 或保留时的动作,请参照“6.8 异常时输入输出的设定”。    实时格式     可设定的字节数量范围    Modeless Heartbeat 0~1448 字节    32birHeader   0~1444 字节 6-16
(d) 详细设定 (d-1) 实时格式用 EtherNet/IP 将 2ET 相互连接时,请选择自动。(默认为自动。)自动上有勾选   自动上无勾选   去除自动上的勾选时,将变为手动设定。从以下列表中选择实时格式。    通信方式    通信方向  所选择的实时格式 实例 ID      目标→发端  Modeless   发端→目标    32bitHeader  标签     目标→发端 Modeless   发端→目标     HeartBeat      通信方向   可选择的实时格式    目标→发端   Modeless , HeartBeat , 32bitHeader   发端→目标     Modeless , HeartBeat , 32bitHeader  6-17
(a)(b)(c) (d)(e)(f)(g)(2-2) 发端               (a) (b) (c)(d)目标节点 IP 地址 设定目标节点的 IP 地址。通信方式选择“Instance ID (实例 ID)”方式或“Tag (标签)”方式中的其中一个。通信超时用 RPI 的乘数进行设定。 从 X4 至 X512 中选择。例如,RPI=50 ms,超时为 RPIX4 时,如果在 50 msX4=200 ms 以内无法接收数据,就会成为 连接异常。目标→发端信息(d-1) 数据包间隔(RPI)设定从发端向目标发送的数据包的发送间隔。(0.5~32.5 ms: 0.5 ms 单位)(33~10,000 ms: 1 ms 单位)6-18
(d-2) 连接类型从“Point to Point”或“Multicast”中选择连接类型。Point to Point是将发端与目标按 1:1 建立起来的连接。Multicast可用多个发端(同一模块的除外) 来接收来自 1 个目标的发送数据。使用多点传送时,请将同一目标中连接的各发端 TO 侧数据包间隔(RPI) 的设定值设定为 相同的值。注意: 不可从一台 2ET 的多个发端连接中,对同一目标使用多点传送。下面的例子中,就是以多点传送来使用左侧的 2ET 所拥有的多个发端,并试图连接到右 侧 2ET 的目标上。这种情况下,左侧的 2ET 发端连接将反复连接、断开,不会正常运行。 另外,将分别向NanoCPU通告错误代码86(链接通信异常) ,向S3*0通告错误代码5A。  发端   发端目标  发端        2ET2ET   发端目标    发端  发端 6-19目标
注意: 作为目标侧来使用多点传送时,需要有与所连接的发端数量相对应的连接数量。例) 在下图中,针对 1 个进行多点传送的目标,连接了 3 个发端。虽然目标的多点传送 连接设定是一个,但实际上连接了 3 个,所以,这种情况下的多点传送连接为 3 个 连接。  发端  发端 发端(d-3) 连接点 设定连接点。可设定的值从以下范围中选择。(d-4) 输入设定6-20目标 消费 3 个连接   通信方式    连接点     可设定的值    实例 ID  以数值进行设定。   0~65535   标签 以标签名称(字符串) 进行设定。  字母(有大写小写区别) 数字、符号(有部分符号不可使用)  输出区域可设定 8 个区域。注意: 可使用的区域数量为输入区域、输出区域合计 1000 区域为止。
(d-5) 地址 地址可设定以下的区域。可设定区域    继电器链接     寄存器链接    M00L~7FH, L00L~7FH, X,Y00L~7FH, EM00L~1FFH EL00L~1FFH, EX,EY00L~7FH, GM000L~FFFH, GX,GY000L~FFFH   R0000~07FF, D0000~FFF, U0000~7FFF  注意: 地址中请务必设定 L(Low)或 H(High)。(例 (d-6) 字节数D000L 及R100H 等)就 8 个区域分别设定输入区域的字节数量。 根据所设定的实时格式,能够设定的合计字节数量上限会有所不同。 8 个区域的字节数量合计请务必设定在以下范围内。(d-7) 异常时的状态异常时的状态可从 OFF(默认) /保留中选择。关于设定为 OFF 或保留时的动作,请参照“6.8 异常时输入输出的设定”。(e) 发端→目标 信息(e-1) 数据包间隔(RPI)设定从发端向目标发送的数据包的发送间隔。(0.5~32.5 ms: 0.5 ms 单位) (33~10,000 ms: 1 ms 单位)(e-2) 连接类型连接类型为“Point to Point”(固定) 。(e-3) 连接点 设定连接点。    实时格式     可设定的字节数量范围    Modeless Heartbeat 0~1448 字节    32birHeader     0~1444 字节     通信方式   连接点   可设定的值   实例 ID    以数值进行设定。     0~65535    标签   不可设定   不可设定  6-21
(e-4) 输出设定 输出区域可设定 8 个区域。注意: 可使用的区域数量为输入区域、输出区域合计 1000 区域为止。(e-5) 地址 在地址中从以下的寄存器区域开始设定。可设定区域    继电器链接     寄存器链接    M00L~7FH, L00L~7FH, X,Y00L~7FH, EM00L~1FFH, EL00L~1FFH, EX,EY00L~7FH, GM000L~FFFH, GX,GY000L~FFFH   R0000~07FF, D0000~FFF, U0000~7FFF  注意: 地址中请务必设定 L(Low)或 H(High)。(例D000L 及R100H 等)(e-6) 字节数就 8 个区域分别设定输出区域的字节数量。 根据所设定的实时格式,能够设定的合计字节数量上限会有所不同。 8 个区域的字节数量合计请务必设定在以下范围内。(e-7) 异常时的状态异常时的状态可从 OFF(默认) /保留中选择。关于设定为 OFF 或保留时的动作,请参照“6.8 异常时输入输出的设定”。     实时格式      可设定的字节数量范围    Modeless Heartbeat 0~1448 字节     32birHeader    0~1444 字节 6-22
(f-1)(f-2) (f-3) (f-4) (f-5)(f) 详细设定           (f-1) 触发器设定发送数据的发送时间。 触发器从“Cyclic”或“COS”中选择。(f-2) 最小发送间隔 设定把触发器设定在“COS”时的最小发送间隔。 自动时,为 RPI/4 的值。注意: 最小发送间隔的最小值为 6 ms。因此,使用自动时,请将 OT 方向和 TO 方向的 RPI 设定值设定在 24 ms 以上。设定在 23 ms 以下时,将无法正常发挥作用。(f-3) 配置实例 是配置连接实例。默认为 1。 通常,请保持 1 的状态。 设定范围为 0~65535。(默认 1)用 EtherNet/IP 将 2ET 相互连接时,请设定为 1。该参数在连接对方设备所拥有的配置实例的值为 1 以外的值时将进行变更。其他公司制的 设备有时会有配置实例的设定值为 1 以外的值的情况。请以其他公司制的设备使用说明书 或 EDS 文件为参考,设定为与其他公司制设备所拥有的配置实例相同的值。注意: 配置实例不一致时,通信将无法进行。    Cyclic     按 RPI 的设定间隔来进行数据的发送。    COS(Change of State) 数据没有变化时,按 RPI 的设定间隔发送数据。 数据有变化时,从发生变化时开始,在最小发送间隔的设定时间内发送数据。 6-23
(f-4) 端口编号、链接地址结合所连接的设备,设定端口编号与链接地址。默认为端口编号 0,链接地址 0。用 EtherNet/IP 将 2ET 相互连接时,请设定为默认的端口编号 0,链接地址 0。其他公司制的设备中,有些会带有端口编号及链接地址。请以其他公司制的设备使用说明 书或 EDS 文件为参考,结合对方设备来设定端口编号及链接地址。注意: 与带有端口编号及链接地址的设备进行连接时,如果端口编号及链接地址未能正 确设定,则无法进行通信。(f-5) 实时格式实时格式请根据连接对象设备进行设定。用 EtherNet/IP 将 2ET 相互连接时,请选择自动。(默认为自动。)注意: 选择自动时,可选择下表“自动上有勾选”中的实时格式。并非自动进行与对方设 备相匹配的设定的功能。自动上有勾选   自动上无勾选   去除自动上的勾选时,将变为手动设定。从以下列表中选择实时格式。注意: 进行与其他公司制的设备的连接时,请根据其他公司制的设备中设定的实时格式 进行设定。       实时格式在各连接设备之间有差异时,有时会无法进行通信。    通信方式    通信方向  所选择的实时格式 实例 ID     目标→发端  Modeless   发端→目标  32bitHeader  标签      目标→发端  Modeless   发端→目标  HeartBeat    通信方向     可选择的实时格式    目标→发端 Modeless , HeartBeat , 32bitHeader   发端→目标   Modeless , HeartBeat , 32bitHeader 6-24
(g) 目标设定打开 目标设定打开按钮可在使用发端的标签通信时应用。通过读入事先保存的目标的标签名称,即可选择可使用的目标的标签名称。选择可从发端的连接 点设定栏对话框中进行。要使用该功能,必须事先使用目标设定保存功能,来保存目标的标签名称信息。详细内容请参照 “(6) 目标设定保存”。   读入标签名称的设定已保存下来的文本文件。   (3) 列表设定 参数设定信息可用表格形式进行显示、编辑。 可进行 EXCEL 等数据的复制粘贴。即可从列表中选择标签名称。 6-25
(4) 选项 (4-1) 连接目的地 IP 地址输出信息地址输出各连接的连接目的地 IP 地址最下位位数的 1 字节。 连接设定为发端时,可保存用参数设定的目标 IP 地址。 为目标设定时,可在连接建立后,保存对方发端的 IP 地址。 初始值为 00。保存格式如下所示。占用 64 字的寄存器。 多点传送时,仅保存与所连接的对方 1 台设备相对应的 IP 地址。偏移+0 +1 +2+62 +63例) 将 192.168.0.1 的连接 0 的对方 IP 地址为 192.168.0.8 时,连接 3 的对方 IP 地址为 192.168.0.12 时的状态输出到 D0C00~中    上位   下位    CN1     CN0    CN3   CN2    CN5   CN4               CN125   CN124    CN127   CN126 192.168.0.1地址D0C00 D0C01 D0C02192.168.0.8192.168.0.12     CN0   CN3        上位   下位    00     08    0C 00    00     00  6-26
(4-2) 数据包丢失次数输出连接的接收数据包丢失次数。 计数值为接收侧监视数据包的连号,并累计其编号在顺序号中丢失的数量。 该值定期进行更新时,至对方设备为止的线路就有可能出现问题。注:(1)数据包丢失次数由于对顺序号丢失次数进行监视,所以在拔下 LAN 电缆的状态下,将无法进行次 数的更新。 (2) (3)异常(12) (13)异常(4)(5)连接异常(15)(6)(7) (8)(9) (10)                       异常      00    00    01   01     01    01   01   01     04     04   计数数量  重新建立连接      (11)(14)(16)(17)(18) (19)异常                          04    04    04   04     04    04   **   **     **     **   计数数量    04    04     04     05   发端侧时目标侧时   00   00    00   01  发生连接超时时,将保留该计数值。 之后,重新建立连接时,发端连接中值会被保留,但目标连接中计数值则会被初始化(0000) 。数据包丢失次数可用 0~65535 的字数据来输出。计数计至 65535 时,计数值将返回 0。 数据包丢失次数的保存格式如下所示。占用 128 字的寄存器。    内容    CN0 数据包丢失次数    CN1 数据包丢失次数    CN2 数据包丢失次数            CN126 数据包丢失次数    CN127 数据包丢失次数 参数的设定 地址偏移+0 +1 +2+126 +1276-27
(4-3) 脱离寄存器区域地址 设定脱离指定用寄存器区域。 设定区域的格式如下所示。占用 8 字的寄存器。注意: 所谓脱离功能,是指确认指定脱离的连接出现通信异常的状况,并对其他正常的连接继续进行通 信的功能。详细内容请参照“6.7 脱离功能”。 偏移 15+0 15+1 31+2 47+3 63+4 79+5 95+6 111110109108107106105104103102101100 99 98 97 96+7 127 126 125 124 123 122 121 120 119 118 117 116 115 114 113 1120 14131211109876543210302928272625242322212019181716 1:脱离指定 464544434241403938373635343332 0:脱离解除 626160595857565554535251504948 787776757473727170696867666564 949392919089888786858483828180(4-4) 异常时的 CPU 通告设定在发端连接中发生连接超时(错误代码 0050) 时,是否向 CPU 模块进行通告异常状况。初始值为“Do not. (不进行)”。(5) 网络详细设定5-1) 子网掩码、网关 IP 地址自身节点 IP 地址和通信对象的 IP 地址的网络 ID 不同时,需进行子网掩码、网关 IP 地址的设定。 详细内容请参照资料 4。5-2) 命令通信用 UDP 端口 No 是在分层通信中使用的端口 No。 通常情况下,请勿变更本设定。(6) 目标设定保存 将目标侧的标签名称信息作为文本数据保存。保存后的数据可在设定对方 TOYOPUC-Nano 的发端侧标签通信的标签名称时使用。详细内容请参照“(2-2) 发端”的“(g) 目标设定打开”。     不向 CPU 进行通告。 (默认值)      即使检出连接异常,也不向 CPU 进行通告。    向 CPU 进行通告。 (选项)  检出连接异常时,将通告异常情况,并在 CPU 中显示通信异常(错误代码 86) 。 通信异常(VA2) 将变为 ON。发生连接异常后,将以 10 秒间隔进行连接重建。但是,即使可以建立连接,CPU 中的异常状态在通 信重置(V80:链接 1 时) 实施之前也将被保留。  6-28
6.5 状态6.5.1链接用特殊寄存器在 EtherNet/IP 中,特殊寄存器里配备有以下的状态信息。 15 0 S3*0S3*1 S3*2 S3*3 S3*4 S3*5 S3*6 S3*7 S3*8 S3*9 S3*A S3*B S3*C S3*D S3*E S3*F连接建立状态区域连接异常状态区域15 0 S3#0 错误代码  S3#1 S3#2 S3#3 S3#4 S3#5 S3#6 S3#7 S3#8 S3#9 S3#A S3#B S3#C S3#D S3#E S3#F详细 1 详细 2 详细 3 系统版本错误代码履历连接异常状态区域自身的以太网地址第 4 位 自身的以太网地址第 6 位 自身的 IP 地址第 1 位 自身的 IP 地址第 3 位自身的以太网地址第 5 位 (系统预约) 自身的 IP 地址第 2 位 自身的 IP 地址第 4 位自身以太网地址的第 1~3 位为 00:60:53。  特殊寄存器的*、#部根据链接No.来确定。   链接 No.    1   2    3  4   5    6   7    8    *          0      2        4    6      8        A      C      E   #       1     3      5   7    9       B    D     F   6-29
(1) 连接建立状态区域输出连接的建立状态。 连接已确立时,相关连接编号的位数位置将变为“1”。 15 0S3*0 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 0S3*1 313029282726252423222120191817161:正常S3*2 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 320:无分配或连接异常发生中S3*3 63626160595857565554535251504948S3*4 79787776757473727170696867666564S3*5 95949392919089888786858483828180S3*6 111110109108107106105104103102101100 99 98 97 96S3*7 127 126 125 124 123 122 121 120 119 118 117 116 115 114 113 112(2) 连接异常状态区域输出连接异常发生状态。 发生异常的相关连接编号的位数位置将变为“1”。 本区域为履历信息,即使连接异常恢复之后,也将保留“1”的状态。 通信重置(V80:链接 No.1 时) ON 之后将变为“0”。 15 0S3*8 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 0S3*9 313029282726252423222120191817161:有连接异常S3*A 474645444342414039383736353433320:无分配或正常S3*B 63626160595857565554535251504948S3*C 79787776757473727170696867666564S3*D 95949392919089888786858483828180S3*E 111110109108107106105104103102101100 99 98 97 96S3*F 127 126 125 124 123 122 121 120 119 118 117 116 115 114 113 112注意1: 对方正在接入电源,或启动花费时间时,在连接建立前,有时会发生连接异常。在这种情况 下,连接建立后,请实施通信重置(V80:链接 No.1 时) 解除异常。注意2: 发端侧在电源接入时或 CPU 重置时,即使相关连接上没有连接对象,约 40 秒钟时间,连接 异常状态区域的相关位数都不会为 ON。另外,设定在“异常时的 CPU 通告=进行”时,也同样 有约 40 秒钟时间,不会通告通信异常。注意3: 目标侧在电源接入时或 CPU 重置时,如果相关连接上没有连接对象,则连接异常区域的相关 位数不会为 ON。目标侧使连接异常区域的相关位数为 ON 的情况仅在业已正常建立的连接出现异常时会发生。 特殊寄存器的*部根据链接No.来确定。   链接 No.    1   2    3  4   5    6   7    8    *            0        2          4      6        8          A        C        E   6-30
表示电源接入时 LAN 电缆未连接时的发端侧、目标侧各自的连接异常区域相关位数的 ON/OFF 状态。 而且在本例中,将 2 台 TOYOPUC-Nano 中的左边 1 台称为 A,右边 1 台称为 B,并将 A 作为发端侧, 将 B 作为目标侧使用。另外,假设双方都使用了连接编号 0。(根据连接编号,表示连接异常区域相关连 接的特殊寄存器的位数位置(以下用 S3*8-0 表示) 将会发生变化。) 构成例 ATOYOPUC-Nano IP 地址 192.168.1.1发端A 的发端连接的连接异常区域的状态 因配线未连接等而没有连接对象交换式集线器配线未连接BTOYOPUC-Nano IP 地址 192.168.1.2目标                     连接连接 未连接   约 40 秒 OFF     S3*8-0ON   电源 ONB 的目标连接的连接异常区域的状态    因配线未连接等而没有连接对象  连接S3*8-0连接 未连接ON OFF电源 ON        6-31
6.5.2 特殊继电器 表示通信状态的特殊继电器有以下几种。    地址       内容        VA0 VA4 VA8 VAC VB0 VB4 VB8 VBC 链接 No.1 链接 No.2 链接 No.3 链接 No.4 链接 No.5 链接 No.6 链接 No.7 链接 No.8 OFF:一个连接也没有建立时。 ON:所设定的连接中,已建立一个以上的连接时。     VA1 VA5 VA9 VAD VB1 VB5 VB9 VBD   链接 No.1 链接 No.2 链接 No.3 链接 No.4 链接 No.5 链接 No.6 链接 No.7 链接 No.8     链接参数异常OFF:链接参数异常未发生时。 ON:链接参数异常正在发生时。     VA2 VA6 VAA VAE VB2 VB6 VBA VBE   链接 No.1 链接 No.2 链接 No.3 链接 No.4 链接 No.5 链接 No.6 链接 No.7 链接 No.8     通信异常OFF:连接异常未发生时。(在选项设定中,当“异常时的 CPU 通告 = 不进行”时,始终为 OFF)ON:在选项设定中,设定在“异常时的 CPU 通告 = 进行”上的情况下, 有一个以上的连接异常发生时     VC4          特殊模块的异常(通信模块故障)    VF2   特殊模块的分配异常(链接参数的机架 No.、插槽 No.、链接模块名称与安装状态不同。)   6-32
6.6 通信重置EtherNet/IP 中的通信重置为通信异常履历的重置。通过进行通信重置,特殊寄存器 S3*8~S3*F 的信息将被清除。(*符号将根据链接 No.而变化。详细内容请 参照“6.5.1 链接用特殊寄存器”。)可通过使通信重置用特殊继电器由“OFF”→“ON”的方法对通信进行重置。 各链接 No.的通信重置用特殊继电器的 I/O 地址如下表所示。       链接 No.   I/O 地址          1       V80     2 V81      3   V82      4   V83      5   V84      6   V85      7   V86      8   V87     连接V8#约 40 秒钟,不会向连接异常区域通告异常。 因配线未连接等而没有连接对象连接未连接ON OFF注意1: 通信重置仅在特殊继电器启动时有效。注意2: “错误代码:0051 IP 地址重复异常”、“错误代码:0052 处理能力限度异常”、“错误代码:0053自身节点帧接收异常”的状态下的通信重置将无效。注意3: TOYOPUC-Nano 为发端的设定时,在没有连接对象的状态下进行通信重置后,通信重置后       约 40 秒 ON约 40 秒           S3*8-0OFF    电源 ON6-33
注意4: 目标侧仅在正常状态的连接出现异常时,连接异常区域的位数将会为 ON。因此,如下所示, 目标侧的连接从正常状态,因断线等变为异常,并在其状态下进行通信重置时,连接异常区 域的位数将保持 OFF 不变。  发生断线等 特殊寄存器的*部根据链接No.来确定。因断线等持续保持未连接状态 连接 未连接ON OFFON OFF电源 ON 特殊继电器的#部根据链接No.来确定。  连接V8#         S3*8-0     从正常变成了异 常,所以为 ON通信重置后,连接由正常→变为异常为 止为 OFF。    链接 No.    1   2    3  4   5    6   7    8    #            0        1          2      3        4          5        6        7      链接 No.       1           2         3        4       5         6         7         8      *    0   2    4  6   8    A   C   E   6-34
6.7 脱离功能某个发端或目标从通信网络上脱离时,连接异常状态区域的相关连接位数将变为 ON,且链接参数中设定在“通告通信异常”上时,会向 CPU 通告通信异常。 所谓脱离功能,是指确认指定脱离的连接出现通信异常的状况,并对其他正常的连接继续进行通信的功能。另外,链接参数中设定在“通告通信异常”上时,脱离时将向 CPU 通告异常。 根据该功能,可并未发生连接异常的情况下,使特定的发端或目标从通信网络上脱离。 脱离状态下的通信        脱离 I/O 的状态 OFF/保持     通信正常   通信异常    正常状态(S3*0~S3*7) I/O 数据的状态    异常履历状态(S3*8~S3*F)  I/O 数据的状态  0       OFF  1 通信的 I/O 数据交换    1  OFF 数据    保持    1  通信的 I/O 数据交换     1    异常发生前的数据  1     OFF 1OFF 数据交换  0 OFF 数据    保持    1   通常的 I/O 数据交换     0    异常发生前的数据   特殊寄存器的*部根据链接No.来确定。 脱离对象的指定 仅在链接参数中设定了脱离寄存器区域地址时,可在所设定的寄存器中设定各发端或目标的脱离状态。   链接 No.       1           2         3        4       5         6         7         8      *    0   2    4  6   8    A   C   E   各位数 No.表示连接编号。 偏移 MSB   +0   +1   +2   +3   +4   +5   +6   +7各位数=1:有脱离指定 各位数=0:无脱离指定LSB   15     14   13 12    11    10 9     8 7     6 5     4 3     2  1   0   31       30    29 28       27    26 25       24 23       22 21       20 19       18    17  16   47       46    45 44       43    42 41       40 39       38 37       36 35       34    33  32   63       62    61 60       59    58 57       56 55       54 53       52 51       50    49  48   79    78  77 76     75   74 73     72 71    70 69     68 67     66   65  64   95       94    93 92       91    90 89       88 87       86 85       84 83       82    81  80   111         110         109    108        107         106    105        104      103        102      101        100      99        98         97     96  127    126    125  124   123   122   121   120   119   118   117   116   115   114    113   112  6-35
6.8 异常时输入输出的设定可用链接参数来设定 EtherNet/IP 的通信出现异常时的输入数据和 RUN 停止时的输出数据。输入设定是保留通信异常或脱离时输入区域中的数据还是使其为 OFF。注意: 电源接入及 CPU 重置启动时,模块的通信部分会被重置,因此,与保留、OFF 的设定无关,输 入区域将变为 0。保留:通信异常时:将保留发生异常之前接收到的数据。  对方设备 输出数据 1111h  输入区域的数据 1111h 输入区域的数据 2222h 输入区域的数据 3333h 输入区域的数据 3333h 输出数据 2222h      保留数据TOYOPUC-Nano· · ·通信异常   OFF:发生通信异常时,使输入区域的数据为 0000h。   输入区域的数据 1111h 输入区域的数据 2222h 输入区域的数据 3333h 输入区域的数据 0000h     使数据为 OFFTOYOPUC-Nano· · ·通信异常   6-36输出数据 3333h 输出数据 4444h  对方设备 输出数据 1111h 输出数据 2222h 输出数据 3333h 输出数据 4444h
输出设定是保留 RUN 停止时输出区域中的数据还是使其为 OFF。 保留:RUN 停止时,将输出区域中的数据输出。TOYOPUC-Nano 对方设备   输出区域的数据 1111h 输出区域的数据 2222h 输出区域的数据 3333h       发生 RUN 停止 将输出区域中的 数据输出  输出区域的数据 3333h· · ·OFF:RUN 停止时,使输出数据为 0000h。(输出区域(寄存器) 的值不会变化。)输入数据 1111h 输入数据 2222h 输入数据 3333h输入数据 3333h       输出区域的数据 1111h 输出区域的数据 2222h 输出区域的数据 3333h       发生 RUN 停止TOYOPUC-Nano· · ·对方设备输入数据 1111h 输入数据 2222h 输入数据 3333h输入数据 0000h  输出区域的数据 3333h输出数据0000h     使输出数据为OFF 6-37
6.9 与以往通信模块的差异EtherNet/IP 功能在 PC 链接、DeviceNet、FL 远程等方面,与以往远程 I/O 的网络规格有所不同。 不同部分记载如下。     规格      PC 链接 FL 远程 DeviceNet    EtherNet/IP   全站通信中标志(根据链接 No,V**会有所不同。 VA0,VA4,VA8,VAC VB0,VB4,VB8,VBC) 即使 1 个站脱离时也会 OFF 脱离时不会 OFF     通信异常时的输入、输出   通信停止时 使所有节点的输入输出为 OFF  仅出现通信异常的相关连接的输入输出将成 为链接参数中所设定的异常时的状态的动 作。关于动作的内容,请参照“6.8 异常时输 入输出的设定”。     通信异常的检出 [DLNK-S2 , PC 链接子站]      子站侧中也将发生 ERR86。 以主站的重新连接来解除异常    目标连接不会发生 ERR86。 仅是状态的履历位数为 ON 解除为目标侧的通信重置  6-38
6.10 连接例6.10.1实例ID通信的连接例 1表示使 TOYOPUC-Nano 相互使用 EtherNet/IP 的实例 ID 来进行数据链接的连接例。使用实例 ID 通信时,可在一个连接中,以“目标→发端”和“发端→目标”双向进行 I/O 数据的接收、发送。 如同以下构成例所示,使用 TOYOPUC-Nano 平台,以 EtherNet/IP 的实例 ID 通信来进行数据链接。设:将构成例左侧的 TOYOPUC-Nano 称为 A,将右侧的 TOYOPUC-Nano 称为 B。在这个例子中,将 A 作为发端、将 B 作为目标使用,从 A 向 B 收发 256 字节的数据,从 B 向 A 收发 512字节的数据。首先,进行 B(目标) 的链接参数设定。 构成例   ATOYOPUC-Nano交换式集线器BTOYOPUC-NanoIP 地址 192.168.1.2 目标       IP 地址 192.168.1.1 发端目标的参数设定I/O 数据RPI : 50 msI/O 数据 256 字节 RPI : 50 ms          D000L:D0FFH  输入区域 512 字节输出区域 256 字节输入区域输出区域   D200L:D27FH  512 字节        连接点:100输出区域512 字节 连接点:101输入区域 256 字节    R000L:R0FFH        R200L:R27FH            6-39
接前页 进行 A(发端) 的参数设定。 构成例ATOYOPUC-Nano IP 地址 192.168.1.1           IP 地址 192.168.1.2     发端交换式集线器I/O 数据RPI : 50 msI/O 数据 256 字节 RPI : 50 msBTOYOPUC-Nano目标         输入区域512 字节输出区域 256 字节 D000L:D0FFH  512 字节            D200L:D27FH连接点:100输出区域512 字节 连接点:101输入区域 256 字节  R000L:R0FFH   R200L:R27FH          发端的参数设定  对方设备的 IP 地址           6-40
6.10.2实例ID通信的连接例 2 在一个连接中设定不同的数据区域时的设定例在 TOYOPUC-Nano 中,可用 EtherNet/IP 链接参数的设定,在一个连接中设定最大 8 区域的数据区域。 所设定的多个区域可在发送时合在一起发送,并在接收时将接收到的数据分离后保存。在以下的构成例中,与连接例 1 同样,将 Nano 称为 A、B。A 在链接参数中,接收区域使用 3 区域,发送区域使用 1 区域。 B 在链接参数中,接收区域使用 2 区域,发送区域使用 2 区域。 注意: 用连接来进行通信的数据量必须完整。首先,进行 B(目标) 的链接参数设定。 构成例交换式集线器 BTOYOPUC-NanoIP 地址 192.168.1.2 目标 ATOYOPUC-NanoIP 地址 192.168.1.1 发端目标的参数设定连接点:100连接点:101输出区域 512 字节输出区域 512 字节输入区域 128 字节输入区域 128 字节                           D000L::D0FFH   输入区域 512 字节输入区域 256 字节输入区域 256 字节输出区域 256 字节  I/O 数据 1024 字节 RPI : 50 ms  输出数 据D000L::D0FFH     R000L:R07FH           R100L:R17FH               D200L:D27FH输入数 据R000L::R0FFH R200L:R23FH    I/O 数据 256 字节 RPI : 200 ms   输入数 据    R300L:R33FH              6-41
接前页构成例进行 A(发端) 的参数设定。 ATOYOPUC-NanoIP 地址 192.168.1.1 发端交换式集线器 BTOYOPUC-NanoIP 地址 192.168.1.2 目标连接点:100                              D000L::D0FFH   输入区域 512 字节输入区域 256 字节输入区域 256 字节输出区域 256 字节      R000L:R07FH               连接点:101对方设备的 IP 地址输出区域 512 字节输出区域 512 字节输入区域 128 字节输入区域 128 字节         D200L:D27FH输入数 据I/O 数据 1024 字节 RPI : 50 ms 输出数 据D000L::D0FFH    R100L:R17FHR000L::R0FFH R200L:R23FH    I/O 数据 256 字节 RPI : 200 ms   输入数 据     R300L:R33FH        发端的参数设定                6-42
6.10.3实例ID通信的连接例 3仅使用实例 ID 通信进行一个方向的数据链接时仅使用实例 ID 通信进行从目标侧向发端侧的数据发送。从发端侧向目标侧的数据发送设定为 0 字节,表面上看是设定为仅从目标侧向发端侧进行数据链接。在以下的构成例中,与连接例 1 同样,将 Nano 称为 A、B。发端 A 将接收从目标 B 发送来的 512 字节的数据。不从 A 进行数据发送。 首先,进行 B(目标) 的链接参数设定。 构成例   ATOYOPUC-NanoIP 地址 192.168.1.1 发端交换式集线器BTOYOPUC-NanoIP 地址 192.168.1.2 目标                 输入区域I/O 数据RPI : 50 ms512 字节连接点:100输出区域 512 字节    R000L:R0FFH     输入区域 512 字节D000:D0FF        目标的参数设定去掉实时格式中自动上的勾选选择 HeartBeat输入区域的连接 点设为 0。输入区域中不输入任何内容。                  6-43
接前页 进行 A(发端) 的参数设定。 构成例ATOYOPUC-NanoIP 地址 192.168.1.1 发端发端的参数设定   交换式集线器I/O 数据RPI : 50 msBTOYOPUC-NanoIP 地址 192.168.1.2 目标                       D000L:D0FFH512 字节连接点:100输出区域 512 字节 R000L:R0FFH     输入区域 512 字节        对方设备的 IP 地址        将输出区域的连接 点设为 254     去掉实时格式中自动上的勾选选择 HeartBeat输出区域中不输入任何内容。         6-44
6.10.4 使用多个连接时的连接例TOYOPUC-Nano 最大可使用 128 个连接。 在这里,作为多个连接的例子,使用 3 台 2ET 来进行 EtherNet/IP 通信。 将下述构成例中的 TOYOPUC-Nano,自左至右称为 A、B、C。在发端 A 和目标 C 之间,在目标→发端方向上收发 512 字节的数据,在发端→目标方向上收发 256 字节 的数据。在发端 A 和目标 B 之间,在目标→发端方向上收发 8 字节的数据,在发端→目标方向上收发 128 字节的 数据。如上所述,A 通过设定 2 个发端,使各个发端建立连接后进行通信。 构成例 ATOYOPUC-NanoIP 地址 192.168.1.1CTOYOPUC-NanoIP 地址 192.168.1.10    交换式集线器   BTOYOPUC-Nano IP 地址 192.168.1.2              发端目标  连接点:100输出区域512 字节 连接点:101输入区域 256 字节       输入区域512 字节输出区域 256 字节D000L:D0FFH   I/O 数据 512 字节    RPI : 100 ms I/O 数据 256 字节R000L:R0FFH        D400L:D47FH        RPI : 100 msR400L:R47FH   发端  I/O 数据 8 字节RPI : 20 ms I/O 数据128 字节 RPI : 50 ms目标连接点:102输出区域8 字节 连接点:103输入区域 128 字节      R000L:R003H  输入区域 8 字节输出区域 128 字节R000L:R003H            R100L:R13FHR100L:R13FH       6-45
TOYOPUC-NanoB(目标) 的链接参数设定 构成例D400L连接点:100输出区域512 字节 连接点:101输入区域 256 字节   A     B   TOYOPUCNanoIP 地址 192.168.1.1 链接参数发端 TOYOPUC-Nano IP 地址 192.168.1.2         I/O 数据 512 字节RPI : 100msR000L:R0FFH目标    输入区域512 字节 :D000L D0FFH      输出区域 256 字节R400L:R47FH   :D47FHI/O 数据 256 字节RPI : 100ms  发端   连接点:102输出区域8 字节 连接点:103输入区域 128 字节     R000L:R003HCTOYOPUC-NanoIP 地址 192.168.1.10  交换式集线器  输入区域 8 字节输出区域 128 字节R000L:R003H          R100L:R13FHI/O 数据 8 字节 R100L:R13FH                                        目标     RPI : 20 ms I/O 数据128 字节 RPI : 50 ms            6-46
TOYOPUC-NanoC(目标) 的链接参数设定 构成例目标CTOYOPUC-NanoIP 地址 192.168.1.10       A  链接参数TOYOPUC-Nano IP 地址 192.168.1.1BTOYOPUC-Nano IP 地址 192.168.1.2交换式集线器          发端    连接点:100输出区域512 字节 连接点:101输入区域 256 字节     输入区域512 字节输出区域 256 字节D000L:D0FFH   I/O 数据 512 字节   RPI : 100 ms I/O 数据 256 字节R000L:R0FFH     D400L:D47FH      RPI : 100 msR400L:R47FH    发端目标   连接点:102输出区域8 字节 连接点:103输入区域 128 字节    R000L:R003H  输入区域8 字节 :R000L R003H    RPI : 20ms I/O 数据128 字节 RPI : 50ms         输出区域 128 字节R100L:R13FHI/O 数据 8 字节 R100L:R13FH                                           6-47
TOYOPUC-NanoA(发端) 链接参数的设定 构成例TOYOPUC-Nano IP 地址 192.168.1.1A链接参数BTOYOPUC-Nano IP 地址 192.168.1.2交换式 C 集线器TOYOPUC-NanoIP 地址 192.168.1.10                             发端目标   连接点:100输出区域512 字节 连接点:101输入区域 256 字节         输入区域512 字节输出区域 256 字节 D000L:D0FFH  I/O 数据 512 字节     RPI : 100 ms I/O 数据 256 字节R000L:R0FFH          D400L:D47FH        RPI : 100 msR400L:R47FH   发端目标   连接点:102输出区域8 字节 连接点:103输入区域 128 字节  I/O 数据 8 字节RPI : 20 ms I/O 数据128 字节 RPI : 50 ms        输入区域 8 字节输出区域 128 字节R000L:R003HR000L:R003H             R100L:R13FHR100L:R13FH                  6-48
6.10.5标签通信的连接例 1在标签通信中,连接点中使用字母(有大小写区别) 和数值及符号(也有不可使用的符号) 。本次将目标的连接点作为 Tag1 来设定。采用标签通信时,数据链接为目标→发端的一个方向。 在以下的构成例中,与连接例 1 同样,将 Nano 称为 A、B。 A 在链接参数中,接收区域使用 2 区域。B 在链接参数中,发送区域使用 2 区域。注意: 用连接来进行通信的数据量必须完整。首先,进行 B(目标) 的链接参数设定。 构成例 ATOYOPUC-NanoIP 地址 192.168.1.1 发端目标的参数设定交换式集线器BTOYOPUC-NanoIP 地址 192.168.1.2 目标连接点:T ag1                            D000L::D0FFH   输入区域 512 字节输入区域 256 字节 输出区域 512 字节输出区域 256 字节     R000L:R07FH输入 数据I/O 数据 768 字节 RPI : 50 ms 输出数 据D000L::D0FFH  R000L:R07FH             6-49
    构成例ATOYOPUC-NanoIP 地址 192.168.1.1 发端交换式集线器BTOYOPUC-NanoIP 地址 192.168.1.2 目标接前页 进行 A(发端) 的参数设定。                 连接点:T ag1R000L:R07FH对方设备的 IP 地址输出区域 512 字节输出区域 256 字节          D000L::D0FFH   输入区域 512 字节输入区域 256 字节   输入数 据I/O 数据 768 字节 RPI : 50 ms输出数 据D000L::D0FFH        R000L:R07FH         发端的参数设定          6-50
6.10.6标签通信的连接例 2 采用标签通信时,数据链接为目标→发端的一个方向。想要在标签通信中进行双向数据链接时,要设定 2 个连接。在以下的构成例中,与连接例 1 同样,将 Nano 称为 A、B。 第一个连接(连接点:Tag1) 中,从目标 B 向发端 A 发送 8 字节的数据。 第二个连接(连接点:Tag2) 中,从目标 A 向发端 B 发送 16 字节的数据。 各路径的参数设定方法请参照标签通信的连接例 1。 构成例  ATOYOPUC-NanoIP 地址 192.168.1.1B 的链接参数设定交换式集线器BTOYOPUC-NanoIP 地址 192.168.1.2            发端   D000L:D003H  输入区域 8 字节 目标  连接点:T ag2输出区域 16 字节  D200L:D207H    目标  连接点:T ag1输出区域 8 字节   R000L:R003H    发端   R200L:R207H  输入区域 16 字节   I/O 数据RPI : 50 msI/O 数据 16 字节 RPI : 50ms8 字节                  A 的链接参数设定      6-51
6.10.7构成例TOYOPUC-Nano IP 地址 192.168.1.1多点传送的连接例 1EtherNet/IP 中,可实现从一个目标向多个发端同时发送同一数据的多点传送。(不可从发端进行多点传送。)在这里,表示用实例 ID 通信进行多点传送的连接例。在这里,与之前的连接例相同,3 台 Nano 分别称为 A、B、C。 目标 C 通过多点传送向发端 A 和 B 发送 512 字节的数据。 发端 A 通过 Point to Point 向目标 C 发送 256 字节的数据。 不从发端 B 进行数据发送。 ACTOYOPUC-NanoIP 地址 192.168.1.10    交换式集线器   BTOYOPUC-Nano IP 地址 192.168.1.2             发端连接类型:Multicast 输入区域512 字节连接类型:Point to Point输出区域 256 字节   D000L:D0FFH     D400L:D47FH    I/O 数据 512 字节RPI : 100 ms I/O 数据 256 字节连接点:100输出区域512 字节 连接点:101输入区域 256 字节目标    R000L:R0FFH          RPI : 100 msR400L:R47FH  发端 连接类型:Multicast输入区域 512 字节   U000L:U0FFH512 字节 0 ms            目标的参数设定I/O 数据 RPI : 10        6-52
接前页 进行发端 A 的链接参数设定。A 构成例CTOYOPUC-NanoIP 地址 192.168.1.10    交换式集线器      TOYOPUC-Nano IP 地址 192.168.1.1BTOYOPUC-Nano IP 地址 192.168.1.2          发端 连接类型:Multicast 输入区域512 字节连接类型:Point to Point输出区域 256 字节   D000L:D0FFH     D400L:D47FH     I/O 数据 512 字节RPI : 100 ms I/O 数据 256 字节R000L:R0FFH目标  连接点:100输出区域512 字节 连接点:101输入区域 256 字节              RPI : 100 msR400L:R47FH  连接类型:Multicast输入区域 512 字节发端    U000L:U0FFH           I/O 数据RPI : 100 ms512 字节   A 发端的参数设定       6-53
接前页 进行发端 B 的链接参数设定。 A 构成例TOYOPUC-Nano IP 地址 192.168.1.1CTOYOPUC-NanoIP 地址 192.168.1.10    交换式集线器   BTOYOPUC-Nano IP 地址 192.168.1.2              发端连接类型:Multicast 输入区域512 字节连接类型:Point to Point 输出区域256 字节目标  连接点:100输出区域512 字节 连接点:101输入区域 256 字节         D000L:D0FFH  I/O 数据 512 字节R000L:R0FFH     RPI : 100 ms I/O 数据 256 字节        D400L:D47FHR400L:R47FH        RPI : 100 ms  发端  连接类型:Multicast输入区域 512 字节  I/O 数据RPI : 100 ms512 字节    U000L:U0FFH     B 发端的参数设定     去掉实时格式中自动上的勾选选择 HeartBeat    输出区域中不输    入任何内容。将输出区域的连接 点设为 254            6-54
6.10.8构成例TOYOPUC-Nano IP 地址 192.168.1.1点传送的连接例 2 采用多点传送的通信也可在标签通信中使用。在这里,表示用标签通信进行多点传送的连接例。在这里,与之前的连接例相同,3 台 Nano 分别称为 A、B、C。 目标 C 通过多点传送向发端 A 和 B 发送 8 字节的数据。A 及 B 因为是发端,所以仅进行接收。首先设定目标 C 的链接参数。 A交换式集线器CTOYOPUC-Nano      BTOYOPUC-Nano IP 地址 192.168.1.2IP 地址 192.168.1.10              发端 连接类型:Multicast输入区域 8 字节   D000L:D003H    I/O 数据 8 字节连接类型:Multicast输入区域 8 字节RPI : 100 ms目标  连接点:T ag2输出区域 8 字节   R000L:R003H     发端    U000L:U003H        目标的参数设定I/O 数据 RPI : 100 ms8 字节       6-55
接前页,进行发端 A 的链接参数设定。 A 构成例TOYOPUC-Nano IP 地址 192.168.1.1CTOYOPUC-Nano IP 地址 192.168.1.10    交换式集线器  BTOYOPUC-Nano IP 地址 192.168.1.2              发端  连接类型:Multicast输入区域 8 字节   D000L:D003H    I/O 数据 8 字节连接类型:Multicast输入区域 8 字节RPI : 100 ms目标  连接点:T ag2输出区域 8 字节   R000L:R003H     发端    U000L:U003H        A 发端的参数设定I/O 数据 RPI : 100 ms8 字节       6-56
 构成例接前页,进行发端 B 的链接参数设定。 ACTOYOPUC-NanoIP 地址 192.168.1.10    交换式集线器      TOYOPUC-Nano IP 地址 192.168.1.1BTOYOPUC-Nano IP 地址 192.168.1.2          发端连接类型:Multicast输入区域 8 字节   D000L:D003H    目标   连接点:T ag2输出区域 8 字节    I/O 数据 8 字节R000L:R003H 连接类型:Multicast输入区域 8 字节RPI : 100 ms  发端     U000L:U003H        I/O 数据 RPI : 100 ms8 字节    B 发端的参数设定      6-57
6.10.9 与其他公司制扫描仪设备的连接例其他公司制的设备中,有些会带有端口地址和链接地址。其他公司相关产品的使用说明书或 EDS 文件内 有记载时,请参照其内容来设定链接参数。其他公司产品中存在着仅可设定实例 ID 发端功能的设备(不可作为目标来设定) 。在这种情况下,可通过 将 2ET 设定为实例 ID 的发端来进行连接。 其他公司产品中,即使是作为目标侧,也有一些不能接收任意 RPI 值的设备。在这种情况下,即使用 2ET 的发端设定了 RPI,RPI 还是会按照对方设备的设定运行。 详细内容请参照其他公司产品的使用说明书等。采用 2ET 和其他公司制扫描仪设备标签通信的连接例其他公司产品中设定有端口地址时,参照使用说明书,或参照 EDS 文件的[Port]之项。 从对方设备(其他公司制扫描仪设备) 的 EDS 文件中可以看出,EDS 文件的[Port]之项中有 Port1=Backplane 的内容,所以,该设备端口编号为 1。注意: 虽然在 EDS 文件的[Port]之项中有 TCP 端口的记载(在此例中为 Port2) ,但 TCP 端口与链接参 数中设定的端口编号没有任何关系。因此,请勿在链接参数的端口编号中设定 TCP 的端口编号。    首先,请以使用说明书等为参考,进行作为目标侧的其他公司制扫描仪设备的设定。构成例 ATOYOPUC-Nano IP 地址 192.168.1.1发端交换式集线器                     连接点:T ag2     输入区域 256 字节D000L:D07FH I/O 数据RPI : 100 ms其他公司制扫描仪设备 IP 地址 192.168.1.20目标以使用说明书为参考来设定连接点的标签名称和输出数据数量。256 字节  输出数据256 byte     因为 EDS 文件的[Port]之项中有 Port1=Backplane 的内容,由此可以看 出,该设备使用端口编号 1。 EDS 文件[Port]Port1 = Backplane,“Backplane”,: Port2 = TCP,  6-58
接前页,进行 TOYOPUC-Nano 的链接参数设定。构成例 ATOYOPUC-Nano IP 地址 192.168.1.1发端发端的参数设定根据对方设备的设定,将端口编号设定 为 1。交换式集线器              其他公司制扫描仪设备 IP 地址 192.168.1.20目标       连接点:T ag2     D000L:D07FH  输入区域 256 字节I/O 数据RPI : 100 ms256 字节  输出数据256 byte              6-59
6.10.10 与其他公司制适配器设备的连接例表示 TOYOPUC-Nano 与其他公司制适配器设备的连接例。适配器设备由于大多自带了预先设定的连接点,所以在进行连接设定时,需参照其他公司产品的使用说明 书及 EDS 文件,确认适配器设备自带的实例 ID 连接点是否具有自己想要使用的功能。本次使用的适配器为数字输入 8 点,数字输出 8 点的模块。按照适配器的使用说明书,在适配器上设定 IP 地址等必要的信息。接着,从适配器的使用说明书中找出可使用的实例 ID。从使用说明书中可以看到,有一个名称叫做程序集实例的实例 ID 和功能的一览表。从该表可以看出,数 字输入数据用的实例 ID 分配了 108 个,数字输出数据用的实例 ID 分配了 102 个。 构成例交换式集线器       数字输入 8点数字输出 8点   TOYOPUC-NanoIP 地址 192.168.1.1 发端其他公司制适配器设备 IP 地址 192.168.1.30目标           输入区域 1 字节输出区域 1 字节输入区域D000L输出区域D100L        I/O 数据RPI : 50 msI/O 数据 1 字节 RPI : 50 ms1 字节          目标 连接点:108数字输入 8 点连接点:102 数字输出 8 点        程序集实例实例 101(65hex)· ·· ·模拟/数字输出数据用实例 102(66hex) 数字输出数据用6-60适配器使用 说明书  实例 108(6Chex) 数字输入数据用
 构成例接前页,进行 TOYOPUC-Nano 的链接参数设定。 交换式集线器       数字输入 8点数字输出 8点   TOYOPUC-NanoIP 地址 192.168.1.1 发端其他公司制适配器设备 IP 地址 192.168.1.30目标           输入区域 1 字节输出区域 1 字节输入区域D000L输出区域D100L         I/O 数据RPI : 50 msI/O 数据 1 字节 RPI : 50 ms1 字节       目标 连接点:1088 点输入连接点:102 8 点输出      发端的参数设定    6-61
6.11 EtherNet/IP的异常通告EtherNet/IP 在检测异常时,会向 CPU 通告异常。CPU 将按照该异常内容来设置特殊继电器、错误信息输出用特殊寄存器、链接错误信息输出用特殊寄存 器。6.11.1 特殊继电器 异常时,下述特殊继电器将为 ON。    地址       内容       VA0 VA4 VA8 VAC VB0 VB4 VB8 VBC 链接 No.1 链接 No.2 链接 No.3 链接 No.4 链接 No.5 链接 No.6 链接 No.7 链接 No.8 OFF:一个连接也没有建立时。 ON:所设定的连接中,已建立一个以上的连接时。     VA1 VA5 VA9 VAD VB1 VB5 VB9 VBD   链接 No.1 链接 No.2 链接 No.3 链接 No.4 链接 No.5 链接 No.6 链接 No.7 链接 No.8    链接参数异常OFF:链接参数异常未发生时。 ON:链接参数异常正在发生时。     VA2 VA6 VAA VAE VB2 VB6 VBA VBE   链接 No.1 链接 No.2 链接 No.3 链接 No.4 链接 No.5 链接 No.6 链接 No.7 链接 No.8    通信异常OFF:连接异常未发生时。(在选项设定中,当“异常时的 CPU 通告 = 不进行”时,始终为 OFF)ON:在选项设定中,设定在“异常时的 CPU 通告 = 进行”上的情况下, 有一个以上的连接异常发生时     VC4         特殊模块的异常(通信模块故障)    VF2   特殊模块的分配异常(链接参数的机架 No.、插槽 No.、链接模块名称与安装状态不同。)   6-62
6.11.2 特殊寄存器  特殊寄存器整图    地址      内容    S200 | S24F CPU 错误信息输出用寄存器(注)    S3*0 | S3*7   连接建立状态区域    S3*8 | S3*F   连接异常状态区域    S3x0 | S3xB     链接错误信息输出用寄存器(注)    S3xC | S3xF   自身节点地址输出用寄存器    上述地址的x及*部分根据链接No.来确定。 基于各链接 No.的*、x,如下表所示。注: 特殊寄存器 S200~S24F 和 S3x0~S3xB 中保存的信息,在异常恢复后也不会被清除。 另外,异常恢复后,即使进行电源重新接入及重置启动,特殊寄存器 S200~S24F 和 S3x0~S3xB 中保存的信息也不会被清除。需要清除时,请用 PCwin2 等,在寄存器中写“0000”。   链接 No.    1    2  3    4  5   6    7    8    *            0           2      4         6      8       A         C         E  x    1    3  5    7  9   B    D   F   6-63
(1) CPU错误信息输出用寄存器检出异常时,将错误代码、错误相关信息及错误检出时刻保存在错误信息保存用特殊寄存器中。该寄存器 为 8 级移位寄存器结构,最大可存储 8 次的异常发生。异常超过 8 次时,将从最初保存的错误信息开始 依次消失。  保存在此寄存器中的错误信息可用周边装置等读出。 CPU错误信息输出用特殊寄存器的内容 地址S200 S20A S214 S21E S228 S232 S23C S246 S24F           错误0 信息错误代码        错误1 信息错误相关信息 1(下位) 、.2(上位)        错误2 信息错误相关信息 3(下位) 、.4(上位)        错误3 信息错误检出时刻(秒)        错误4 信息错误检出时刻(分)        错误5 信息错误检出时刻(时)        错误6 信息错误检出时刻(日)        错误7 信息错误检出时刻(月)        错误检出时刻(年)    错误检出时刻(星期) 0~6:周日~周六       错误相关信息消失          错误代 码    错误内容     相关 1     相关 2     相关 3     相关 4      备注       84特殊模块异常 网络负载过大(网络为环状等)  *分类 机架编 号 插槽编 号 - *1:ALM2:CPU 检出 3:I/O 模块检出           85  链接参数异常    链接编 号   -   -   -        86   通信异常     链接编 号     -     -     -         89  链接参数的机架 No.、插槽 No. 模块名称异常    机架编 号   插槽编 号   -   -   VF2 ON   6-64警报 重度异常
(2) 连接建立状态区域a) 连接建立状态区域输出连接的建立状态。 连接已确立时,相关连接编号的位数位置将变为“1”。 15 0S3*0 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 0S3*1 313029282726252423222120191817161:正常S3*2 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 320:无分配或连接异常发生中S3*3 63626160595857565554535251504948S3*4 79787776757473727170696867666564S3*5 95949392919089888786858483828180S3*6 111110109108107106105104103102101100 99 98 97 96S3*7 127 126 125 124 123 122 121 120 119 118 117 116 115 114 113 112b) 连接异常状态区域输出连接异常发生状态。 发生异常的相关连接编号的位数位置将变为“1”。 本区域为履历信息,即使连接异常恢复之后,也将保留“1”的状态。 通信重置(V80:链接 No.1 时) ON 之后将变为“0”。 15 0S3*8 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 0S3*9 313029282726252423222120191817161:有连接异常S3*A 474645444342414039383736353433320:无分配或正常S3*B 63626160595857565554535251504948S3*C 79787776757473727170696867666564S3*D 95949392919089888786858483828180S3*E 111110109108107106105104103102101100 99 98 97 96S3*F 127 126 125 124 123 122 121 120 119 118 117 116 115 114 113 112注意1: 对方正在接入电源,或启动花费时间时,在连接建立前,有时会发生连接异常。在这种情况 下,连接建立后,请实施通信重置(V80:链接 No.1 时) 解除异常。注意2: 发端侧在电源接入时或 CPU 重置时,即使相关连接上没有连接对象,约 40 秒钟时间,连接 异常状态区域的相关位数都不会为 ON。另外,设定在“异常时的 CPU 通告=进行”时,也同样 有约 40 秒钟时间,不会通告通信异常。注意3: 目标侧在电源接入时或 CPU 重置时,如果相关连接上没有连接对象,则连接异常区域的相关 位数不会为 ON。目标侧使连接异常区域的相关位数为 ON 的情况仅在业已正常建立的连接出现异常时会发生。 特殊寄存器的*部根据链接No.来确定。   链接 No.    1   2    3  4   5    6   7    8    *            0        2          4      6        8          A        C        E   6-65
表示电源接入时 LAN 电缆未连接时的发端侧、目标侧各自的连接异常区域相关位数的 ON/OFF 状态。 而且在本例中,将 2 台 TOYOPUC-Nano 中的左边 1 台称为 A,右边 1 台称为 B,并将 A 作为发端 侧,将 B 作为目标侧使用。另外,假设双方都使用了连接编号 0。(根据连接编号,表示连接异常区 域相关连接的特殊寄存器的位数位置(以下用 S3*8-0 表示) 将会发生变化。) 构成例 ATOYOPUC-Nano IP 地址 192.168.1.1发端A 的发端连接的连接异常区域的状态 因配线未连接等而没有连接对象交换式集线器 B         配线未连接TOYOPUC-Nano IP 地址 192.168.1.2目标            连接连接 未连接   约 40 秒 OFF     S3*8-0ON   电源 ONB 的目标连接的连接异常区域的状态    因配线未连接等而没有连接对象  连接S3*8-0连接 未连接ON OFF电源 ON        6-66
(3) 链接错误信息输出用特殊寄存器EtherNet/IP 在进行异常检测时,会向 CPU 通告异常。CPU 将在链接错误信息输出用特殊寄存器中保存 该异常内容。链接错误信息输出用特殊寄存器为 8 级移位寄存器结构,最大可存储过往发生的 8 次异常。异常超过 8 次时,将从最初保存的错误信息开始依次消失。保存在此寄存器中的错误信息可用周边装置等读出。  链接错误信息输出用特殊寄存器的内容    链接 No.    错误显示地址     1      S310~S31F    2   S330~S33F    3   S350~S35F    4     S370~S37F    5 S390~S39F    6   S3B0~S3BF    7     S3D0~S3DF    8    S3F0~S3FF       地址           MSB 内容 LSB              S3x0  错误代码(hex)    S3x1   链接参数异常详细代码(hex)    S3x2   0000 固定    S3x3     0000 固定    S3x4   系统版本*1    S3x5 S3x6 S3x7 S3x8 S3x9 S3xA S3xB             节点编号、错误代码保存区 1 新 节点编号、错误代码保存区 2 节点编号、错误代码保存区 3 节点编号、错误代码保存区 4 节点编号、错误代码保存区 5 节点编号、错误代码保存区 6 节点编号、错误代码保存区 7 旧           S3xC   MAC 地址(第 4 位)   MAC 地址(第 5 位)    S3xD     MAC 地址(第 6 位)     系统预约    S3xE   自身的IP地址(第1位)   自身的 IP 地址(第 2 位)    S3xF   自身的IP地址(第3位)   自身的 IP 地址(第 4 位)     *1 版本 1.23 时、0123(BCD) 。 注1: x 将根据链接 No.确定。例如,在链接 No.=5 的 EtherNet/IP 中,错误信息保存在 S390~S39F 中。   链接 No.    1    2  3    4  5   6    7    8    x            1          3      5          7      9        B          D        F   6-67
 链接参数异常详细代码链接参数中有异常时,在错误代码保存到链接错误信息输出用特殊寄存器 S3x0 中的同时,链接参数异常详细代码将保存到 S3x1 中。 请参考下表来复核链接参数。而且,链接参数的确认请从 CPU 中将参数读出到周边装置之后进行。 周边装置内的参数有时会与 CPU 内的参数不一致。链接参数中有异常时,不会开始 EtherNet/IP 通信。    错误 代码   详细 1   详细 2  异常内容   原因     处理        S3x0     S3x1     S3x2    0030          辅助链接参数异 常  辅助链接参数的和数校验异常      用 PCwin2 来修正链接参数,并重新 进行参数写入。     0034   自身节点 IP 地 址非法IP 地址设定如下(1) 网络ID的所有位数为0或所有位数为1 (2) 主机ID的所有位数为0或所有位数为1 (3) 最上位字节为127  正确设定自身节点 IP 地址。(注)    0035        网关 IP 地址非 法 网关 IP 地址不正确     正确设定网关 IP 地址。(注)    0036              子网掩码非法  子网掩码不正确      正确设定子网掩码。(注)     0037   UDP 端口 No 非 法端口 No 不在 1025~65534 的范围内  正确设定 UDP 端口 No。 (默认值: 7872)    0040     连接No.     *1    其他节点 IP 地 址非法  *1 0:IP 地址非法 1:网关地址未设定      修正用详细 1 中连接的详细 2 表示的 内容。(注)     0043         链接寄存器地址 异常 使用 SFC 时,在链接地址中设定 R580~R7FF (请确认数据区域与选项区域)   变更输入、输出区域中设定的 R580~R7FF 的地址。     0044   区域地址异常地址超出用户存储器范围  在用户存储器范围内的地址上进行设定。将输入输出区域的使用数量变更为 1000 区域以内。    0045   *1     I/O 容量异常 输入合计/输出合计超过 4096 byte *1 0:输入 1:输出     修正为输入合计/输出合计在 4096 byte 以内。    0046     连接No.         数据包间隔异常  RPI 不在 2~10000 以内      将 RPI 修正在 2~10000 的范围以内。     0047 连接No.  连接类型异常连接类型在 Point to Point, Multicast 以外  将连接类型修正为 Point to Point, Multicast。    0048   连接No.   区域 No  个别输入输出区域容量异常 容量在 1448(1444)以上     将 1 个输入区域/输出区域的容量修正 到 1448(1444)以内。    0049     连接No.         连接容量异常  容量在 1448(1444)以上      将 1 个连接的输入区域/输出区域的容 量修正到 1448(1444)以内。     004a 连接No. *1 实例 ID 值异常ID 非法(不是 0x64~C7,0x300~0x4FF) *1 0:T→O 1:O→T  修正详细 1 中连接的详细 2 方向上的 ID。    004b   连接No.   连接No.  目标侧实例 ID 重复异常 目标侧中 ID 重复     修正详细 1 和详细 2 的连接 ID,以避 免重复。    004c     连接No.     *1    标签异常  标签名称非法(*1 0:字超出 1:其他)      修正详细 1 连接的标签名称。     004d 连接No. 连接No. 目标标签重复异 常目标中标签名称有重复  修正详细 1 和详细 2 连接的标签名称, 以避免重复。    004e     连接No.     *1    连接详细设定异 常   *1 0:最小发送间隔超出范围 1:其他      修正详细 1 连接的详细设定。   注: 关于 IP 地址、子网掩码、网关的设定值,请参照资料 4。 6-68
 通信异常发生以下的异常时,如果链接参数的选项设定中设定在“异常时的 CPU 通告 = 进行”上,则在发生连接异常时向 CPU 通告通信异常。    错误 代码   详细 1   详细 2   异常内容       说明       处理        S3x0     S3x1     S3x2    0050 连接No.  连接异常 发生了连接超时 1) 确认 LAN 电缆有无正确布线。2) 确认 LAN 电缆有无断线或短路。3) 确认连接对象的电源有无接入。4) 确认连接对象有无切实安装 LAN 电缆。5) 确认有无使用推荐的 HUB。6) 确认 HUB 的电源有无接入。7) 确认 HUB 有无切实安装 LAN 电缆。8) 确认通信负载有无超过 100%。超过 100%时,调 整 RPI,修正到 100%以内。9) 选择较大的通信超时的值。10) 连接设备为其他公司制时,确认对方设备的 RPI设定值是否在 2 ms~10,000 ms 的范围内。超出 范围时,修正设定值。*2    0051               IP 地址重 复*3     其他节点与 IP 地址重复 *1     修正 IP 地址。    0052   处理能力 限度 *3 内部处理负载过大,继续处 理有困难 *1 1) 确认通信负载有无超过 100%。超过 100%时,调 整 RPI,修正到 100%以内。2) 将目标侧设定为 64 个连接以上时,修正到 64 个 连接以内。3) 连接设备为其他公司制时,确认对方设备的 RPI 设定值是否在 2 ms~10,000 ms 的范围内。超出 范围时,修正设定值。*2    0053         自身节点 帧接收 *3   由于网络为环状网络,所以接收到了自身节点所发送的 帧 *1   消除网络的环路。    005A   连接No.    连接No.    连接 ID 重 复异常    在网络内部使用的 ID 有重 复。*1    确认有无从一个设备的多个发端对一个目标使用多点传送。有使用时进行修正。 *1 即使不在“异常时的 CPU 通告 = 不进行”上也会向 CPU 通告。*2 在其他公司制的设备中,有些设备可将 RPI 设定在 2 ms 以下。将 RPI 设定在 2 ms 以下时,有时会 引起通信异常。另外,将 RPI 设定在 2 ms 以下时,无论设定值是多少,来自 2ET 的数据发送间隔 都是 2 ms。RPI 请在 2 ms~10,000 ms 的范围内进行设定。*3 “错误代码:0051 IP 地址重复异常”、“错误代码:0052 处理能力限度异常”、“错误代码:0053 自身 节点帧接收异常”的状态下的通信重置将无效。 上述地址的x部分根据链接No.来确定。 基于各链接 No.的、x,如下表所示。   链接 No.    1    2  3    4  5   6    7    8    x            1          3      5          7      9        B          D        F   6-69
6.11.3 输入输出数据交换未能正确进行时虽然连接正常状态区域的位数为 ON,但输入输出数据交换未能正确进行时,请参考下表进行处置。    No.    现象    处置    1 虽然连接异常状态区域的相关位数为 OFF,但正 确数据却无法输入。 2ET 连接的设定为发端,并与罗克韦尔公司制的扫描仪设备进行标签连接时。与罗克韦尔公司制的扫描仪设备进行标签连接时,请将 2ET 的连接 类型设定为多点传送。    2  虽然正在进行数据的接收,但保存所接收数据的 寄存器移位了 4 字节   实时格式的设定在发端和目标上有误。请在发端和目标上调整实时格式。 输入输出数据的交换未能正确进行时,在连接正常状态区域的位数为 OFF,连接异常状态区域的位数也 为 OFF 的情况下,请注意以下几点。注1: 电源接通时或重置启动时,即使在通信重置实施后发生通信异常,也有大约 40 秒钟时间,相关连 接异常区域的位数不会为 ON。    No.    现象    处置    1    连接建立状态区域和连接异常状态区域的相关 位数均为 OFF(注 1) 。   2ET 的连接为目标设定时,在正常建立连接之前,连接异常状态区 域的位数不会为 ON。请确认对方发端的异常情况。  6-70
7 EtherCAT规格及参数设定、使用方法等详细内容请参照 TOYOPUC EtherCAT 使用说明书(T-326N)。 7-17
资料 1 根据 SPR、SPW 命令进行的文件存储器的读/写  文件存储器读出(特殊模块字节数据读出命令SPR)执行条件 V** FUN 304[SPR OP1 OP2 → OP3]                  • 在执行 SPR 命令之前设定的数据内容OP1 1 005 OP2 0000 OP3 3000OP1~OP3 在实际的顺控程序中使 用数据寄存器或链接寄存器。   执行上述例子中的读出命令后,数据即可如下所示那样进行传输。SPR 命令 助记符           链接可使用标志(与各链接 No.对应:V90,92,94,96,98,9A,9C,9E)↑↑链接 No.1 链接 No.8      执行条件 (执行条件为 ON 之前,需事先设定下述数据)       在上位 4 位数中设置 2ET 模块的链接 No.(1~8)             在下位 12 位数中设置进行读出的字节数量 (最大 3FFh(1023)字节)           用 16 进位来设置文件存储器的起始地址               以太网文件存储器CPU数据寄存器 数据D0800L D0800H D0801L D0801H D0802L地址00000001000200030004数据用 16 进位来设置 CPU 模块读取目标寄存器的间接字节地址。 有关地址,请参照“3.4.2 地址列表”。         12     34     56     78     9A        12     34     56     78     9A     读出执行命令3000h 为 D0800L 的字 节地址 从 OP2 中指定的文件存储器的读出起始地址,向 OP3 中指定的 CPU 模块的地址,读出 OP1 中指定的 字节数量。资料 1-1 资
 文件存储器写入(特殊模块字节数据读出命令SPW) 执行条件 V** FUN 306[SPW OP1 OP2 → OP3]          SPW 命令 助记符               • 在执行 SPW 命令之前设定的数据内容OP1 1 005 OP2 3000 OP3 0000OP1~OP3 在实际的顺控程序中使 用数据寄存器或链接寄存器。   执行上述例子中的写入命令后,数据即可如下所示那样进行传输。链接可使用标志(与各链接 No.对应:V90,92,94,96,98,9A,9C,9E)↑↑链接 No.1 链接 No.8          执行条件 (执行条件为 ON 之前,需事先设定下述数据)        在上位 4 位数中设置 2ET 模块的链接 No.(1~8)             在下位 12 位数中设置进行写入的字节数量 (最大 3FFh(1023)字节)             用 16 进位来设置 CPU 模块数据传输源寄存器的间接字节地址。 有关地址,请参照“3.4.2 地址列表”。               用 16 进位来设置文件存储器写入目标的起始地址    CPU数据寄存器数据(3000h 地址=D0800L)以太网文件存储器地址 数据    12   34   56   78   9A        12     34     56     78     9A   D0800L     0000 D0800H     0001 D0801L     写入执行命令 0002 D0801H     0003 D0802L     0004从 OP2 中指定的 CPU 模块地址,向 OP3 中指定的文件存储器写入目标地址,传输 OP1 中指定的字节 数量。 资料 1-2
资料 2 以太网 文件存储器地址映射表 控制信号输出、通信参数区域(地址 0000~00FF)[写入专用]bit7 bit0                 0000 0001 0002 0003 0004 0005 0006 0007 0008 0009 000A 000B 000C 000D 000E 000F 0010 0011 0012 0013 0014 0015 0016 0017 0018 0019 001A 001B 001C 001D 001E 001F 0020 0021 0022 0023 0024 0025 0026 00278 8 8 81 1:初始化请求 8:参数区域禁止写入 1:解除 0:禁止 * 1 1~8:连接 1~8 主动开放请求1 1~8:连接 1~8 发送请求1 1~8:连接 1~8 接收请求(00 固定)                    765432                     765432                     765432                 (00 固定)(00 固定)(00 固定) (00 固定)1 1:错误日志接收确认2:ICMP 日志接收确认32                   自身节点 IP 地址 00000001 ~ FFFFFFE(下位)(上位)      7  6 5  4  3  2  7    6   5   4    3    2  15  14  13 12  11  10    8               18               116               9(00 固定) 连接开放方式通用通信设定 (00 固定)连接开放方式通用通信设定 (00 固定)连接开放方式通用通信设定 (00 固定)1~8:连接使用 1~16:表格使用                       自身节点端口 No. 0401h~FFFEh        其他节点表 No. 0001h~0010h       (下位)(上位)(下位)(上位)(下位)(上位)(下位)(上位)(下位)(上位)(下位)(上位)TCP 主动开放:0000h, TCP 对方特定被动开放:0100h TCP 对方不特定被动开放:0200h, UDP:0001h通用通信禁用: 00h, 通用通信启用: FFhTCP 主动开放:0000h, TCP 对方特定被动开放:0100hTCP 对方不特定被动开放:0200h, UDP:0001h通用通信禁用: 00h, 通用通信启用: FFhTCP 主动开放:0000h, TCP 对方特定被动开放:0100hTCP 对方不特定被动开放:0200h, UDP:0001h通用通信禁用: 00h, 通用通信启用: FFh                      自身节点端口 No. 0401h~FFFEh        其他节点表 No. 0001h~0010h                              自身节点端口 No. 0401h~FFFEh        其他节点表 No. 0001h~0010h                   资料 2-1连接 No.3 连接 No.2 连接 No.1
         0028 连接开放方式 0029002A 自身节点端口 No. (下位)002B 0401h~FFFEh   (上位)002C 其他节点表 No. (下位)002D 0001h~0010h   (上位)002E 通用通信设定002F (00 固定)0030 连接开放方式 00310032 自身节点端口 No. (下位)0033 0401h~FFFEh   (上位)0034 其他节点表 No. (下位)0035 0001h~0010h   (上位)0036 通用通信设定0037 (00 固定)0038 连接开放方式0039003A 自身节点端口 No. (下位)003B 0401h~FFFEh   (上位)003C 其他节点表 No. (下位)003D 0001h~0010h   (上位)003E 通用通信设定003F (00 固定)0040 连接开放方式 00410042 自身节点端口 No. (下位)0043 0401h~FFFEh   (上位)0044 其他节点表 No. (下位)0045 0001h~0010h   (上位)0046 通用通信设定0047 (00 固定)0048 连接开放方式0049004A 自身节点端口 No. (下位)004B 0401h~FFFEh   (上位)004C 其他节点表 No. (下位)004D 0001h~0010h   (上位)TCP 主动开放:0000h, TCP 对方特定被动开放:0100h TCP 对方不特定被动开放:0200h, UDP:0001h通用通信禁用: 00h, 通用通信启用: FFhTCP 主动开放:0000h, TCP 对方特定被动开放:0100hTCP 对方不特定被动开放:0200h, UDP:0001h通用通信禁用: 00h, 通用通信启用: FFhTCP 主动开放:0000h, TCP 对方特定被动开放:0100hTCP 对方不特定被动开放:0200h, UDP:0001h通用通信禁用: 00h, 通用通信启用: FFhTCP 主动开放:0000h, TCP 对方特定被动开放:0100hTCP 对方不特定被动开放:0200h, UDP:0001h通用通信禁用: 00h, 通用通信启用: FFhTCP 主动开放:0000h, TCP 对方特定被动开放:0100hTCP 对方不特定被动开放:0200h, UDP:0001h通用通信禁用: 00h, 通用通信启用: FFh                                                                                         004E 通用通信设定 004F (00 0050固定)               005100520053其他节点 IP 地址 00000001 ~ FFFFFFE(下位)(上位)(下位)(上位)       0054 其他节点端口 No.0055 0401h~FFFEh0056 0057(00固定)         资料 2-2表格 No.1 连接 No.8 连接 No.7 连接 No.6 连接 No.5 连接 No.4
               00580059005A005B(下位)  其他节点 IP 地址 00000001 ~ FFFFFFE       005C 其他节点端口 No.005D 0401h~FFFEh 005E005F0060(00固定)固定)固定)固定)固定)(上位)(下位)(上位)(下位)(上位)(下位)(上位)(下位)(上位)(下位)(上位)(下位)(上位)(下位)(上位)(下位)(上位)(下位)(上位)(下位)(上位)(下位)(上位)                 006100620063其他节点 IP 地址 00000001 ~ FFFFFFE       0064 其他节点端口 No.0065 0401h~FFFEh006600670068(00                   0069 006A 006B其他节点 IP 地址 00000001 ~ FFFFFFE       006C 其它节点端口 No. 006D 0401h~FFFEh     006E 006F 0070 0071 0072 0073(00其他节点 IP 地址 00000001 ~ FFFFFFE                     0074 其它节点端口 No.0075 0401h~FFFEh     0076 0077 0078 0079 007A 007B(00其他节点 IP 地址 00000001 ~ FFFFFFE                     007C 其它节点端口 No. 007D 0401h~FFFEh     007E007F0080008100820083(00其他节点 IP 地址 00000001 ~ FFFFFFE                      0084 其它节点端口 No.0085 0401h~FFFEh0086 0087(00固定)           资料 2-3表格 No.7 表格 No.6 表格 No.5 表格 No.4 表格 No.3 表格 No.2
             0088   (下位)  0089 008A008B   (上位)008C 其它节点端口 No. (下位)008D 0401h~FFFEh   (上位)008E 008F0090   (下位)其他节点 IP 地址 00000001 ~ FFFFFFE            (00 固定)           0091 00920093   (上位)0094 其它节点端口 No. (下位)0095 0401h~FFFEh   (上位)0096 00970098   (下位)其他节点 IP 地址 00000001 ~ FFFFFFE            (00 固定)             0099 009A009B   (上位)009C 其它节点端口 No. (下位)009D 0401h~FFFEh   (上位)009E009F00A0   (下位) 00A100A200A3   (上位)00A4 其它节点端口 No. (下位)00A5 0401h~FFFEh   (上位)其他节点 IP 地址 00000001 ~ FFFFFFE            (00 固定)             其他节点 IP 地址 00000001 ~ FFFFFFE          00A6 00A7(00 固定)          00A8   (下位)  00A9 00AA00AB   (上位)00AC 其它节点端口 No. (下位)00AD 0401h~FFFEh   (上位)其他节点 IP 地址 00000001 ~ FFFFFFE         00AE 00AF(00 固定)           00B0   (下位)  00B100B200B3其他节点 IP 地址 00000001 ~ FFFFFFE       00B4 其它节点端口 No.00B5 0401h~FFFEh00B6 00B7(上位)(下位)(上位)    (00 固定)     资料 2-4表格 No.13 表格 No.12 表格 No.11 表格 No.10 表格 No.9 表格 No.8
           其他节点 IP 地址 00000001 ~ FFFFFFE         其它节点端口 No. 0401h~FFFEh           00B8     (下位) 00B900BA00BB     (上位)00BC     (下位)00BD     (上位)00BE      00BF(00 固定)           其他节点 IP 地址 00000001 ~ FFFFFFE         其它节点端口 No. 0401h~FFFEh        00C0     (下位) 00C100C200C3     (上位)00C4     (下位)00C5     (上位)00C6      00C7(00 固定)            其他节点 IP 地址 00000001 ~ FFFFFFE         其它节点端口 No. 0401h~FFFEh        00C8     (下位) 00C900CA00CB     (上位)00CC     (下位)00CD     (上位)00CE      00CF(00 固定)       00D0   (下位)00D1 子网掩码    00D200D3   (上位)00D4   (下位)00D5 网关 IP 地址00D6 00000001 ~ FFFFFFE00D7   (上位)00D8 00D900DA 00DB 00DC 00DD 00DE 00DF                (00 固定)        资料 2-5表格 No.16 表格 No.15 表格 No.14
          (下位)    (上位)    (下位)    (上位)    (下位)    (上位)    (下位)    (上位)    (下位)    (上位)    (下位)    (上位)    (下位)    (上位)    (下位)    (上位)    00E0 00E1 00E2 00E3 00E4 00E5 00E6 00E7 00E8 00E900EA 数据包生存时间 00EB00EC IP 组装计时器 00ED00EE 等待重置重传次数 00EF00F0 00F100F2 00F3 00F4 00F5 00F6 00F7 00F8 00F9 00FA 00FB 00FC 00FD 00FE 00FF响应计时器 无接收计时器 重传计时器(数据) 重传数据(SYN/FIN) 关闭计时器                   (00 固定)           资料 2-6
0100 0101 0102 0103 0104 0105 0106 0107 0108 0109 010A 010B 010C 010D0120 0121 0122 0123 0124 0125 0126 0127 0128 0129 012A 012B 012C 012D 012E 012F 0130 0131 0132 0133 0134 0135 0136 0137 0138 0139 013A 013B 013C 013D 013E 013F8 8 88 811 1111 11:初始化正常 1~8:连接 1~8 开放正常 1~8:连接 1~8 连接异常 1~8:连接 1~8 发送完成1~8:连接 1~8 接收完成1:错误日志接收 2:ICMP 日志接收 3:PING 正常 4:PING 异常 1~8:连接 1~8 通用通信方式启用以太网地址在 1 台 1 台的以太网设备中设定了固有的值。连接异常代码也可以在 CPU 模块的特殊寄存器中进行监控。 请参照“3.1.6 状态监控功能”。 控制信号输入、连接异常区域(地址 0100~013F)[读出专用]bit7bit0(下位)(上位)                           7     6    5  4   3     2   7  6 54 3  2  7    6  5 4  3    2                        7  6 54 3  2         4  3    2  7     6    5  4   3     2                     自身以太网地址连接 1 连接异常代码                                             连接器 2:连接器异常代码连接器 3:连接器异常代码连接器 4:连接器异常代码连接器 5:连接器异常代码连接器 6:连接器异常代码连接器 7:连接器异常代码连接器 8:连接器异常代码                                                                                                                                                         资料 2-7
 文件存储器方式收发数据区域(地址 1000~8FFD)bit71000   LL(传输数量下位)1001   LH(传输数量上位)bit0                           100217FD发送数据 (最大 2044 字节)                              1800   LL(传输数量下位)1801   LH(传输数量上位)              18021FFD接收数据 (最大 2044 字节)                              2000   LL(传输数量下位)2001   LH(传输数量上位)              200227FD发送数据 (最大 2044 字节)                             2800   LL(传输数量下位)2801   LH(传输数量上位)               28022FFD接收数据 (最大 2044 字节)                            3000   LL(传输数量下位)3001   LH(传输数量上位)               300237FD发送数据 (最大 2044 字节)                             3800   LL(传输数量下位)3801   LH(传输数量上位)               38023FFD接收数据 (最大 2044 字节)                        资料 2-8连接 3 接收 连接 3 发送 连接 2 接收 连接 2 发送 连接 1 接收 连接 1 发送
          4000   LL(传输数量下位)4001   LH(传输数量上位)              400247FD发送数据 (最大 2044 字节)                              4800   LL(传输数量下位)4801   LH(传输数量上位)              48024FFD接收数据 (最大 2044 字节)              5000   LL(传输数量下位)5001   LH(传输数量上位)             500257FD发送数据 (最大 2044 字节)                               5800   LL(传输数量下位)5801   LH(传输数量上位)              58025FFD接收数据 (最大 2044 字节)                                6000   LL(传输数量下位)6001   LH(传输数量上位)              600267FD发送数据 (最大 2044 字节)                              6800   LL(传输数量下位)6801   LH(传输数量上位)            68026FFD接收数据 (最大 2044 字节)                              7000   LL(传输数量下位)7001   LH(传输数量上位)               700277FD发送数据 (最大 2044 字节)                     资料 2-9连接 7 发送 连接 6 接收 连接 6 发送 连接 5 接收 连接 5 发送 连接 4 接收 连接 4 发送
                                 LL(传输数量下位)       LH(传输数量上位)         接收数据 (最大 2044 字节)                                                   LL(传输数量下位)       LH(传输数量上位)         发送数据 (最大 2044 字节)                                                   LL(传输数量下位)       LH(传输数量上位)         接收数据 (最大 2044 字节)                7800780178027FFD80008001800287FD8800880188028FFD资料 2-10连接 8 接收 连接 8 发送 连接 7 接收
资料 3以太网 控制输出信号、控制输入信号向保持继电器的传输文件存储器的地址 0000~0004 是给 2ET 模块的控制输出信号,0100h~0106h 是来自 2ET 模块的控制 输入信号。通过将这些区域分配给保持继电器,即可轻易地编制出顺控程序。 通过以下的顺控程序,即可利用对保持继电器(K**)进行设置/重置,进行各控制输出信号的 ON/OFF, 还可以尝试着把控制输入信号的状态作为保持继电器接点的状态。而且,保持继电器在 CPU 模块重置及电源为 OFF 时不会进行重置,因此,请务必在电源为 ON 之后用 第 1 扫描进行清除。• 顺控程序例2ET 模块的链接 No.=1将 K00~K28 分配到文件存储器地址 0000~0004 的控制输出信号中,并将文件存储器地址 0100h~0106h 的控制输入信号分配到 K30~K68 中时     V006V006仅第 1 扫描为 ON 的 特殊继电器V90(链接 1 可使用标志)V006V90[ FIL1 00h → K00L - K06L ] (K00~K68 清除) [ WMOV 1007 → R000 ](链接 No.1,7 字节传输) [ WMOV 0100 → R001 ](0100h = 文件存储器起始地址) [ MOVAD (K30) → R002 ][ SPR R000, R001 → R002 ](从文件存储器地址 0100h 中将 7 字节读入到 K30~K68 中) [ WMOV 1005 → R003 ](链接 No.1, 5 字节传输)[ MOVAD (K00) → R004 ][ WMOV 0000 → R005 ] (0000 = 文件存储器起始地址)[ SPW R003, R004 → R005 ](将 K00~K28 的 5 字节数据写入文件存储器地址 0000~0004 中)                         资料 3-1
通过该顺控程序,控制输入输出信号将像下述那样分配。                             初始化请求标志     K00 主动开放请求标志     K08 - 0F 发送请求     K10 - 17 接收确认     K18 - 1F 错误日志接收确认      K20   ICMP 日志接收确认  K21                       初始化正常     K30   初始化异常     K31   开放正常     K38 - 3F   连接异常     K40 - 47   发送完成     K48 - 4F   接收完成     K58 - 5F   错误日志接收     K60   ICMP 日志接收     K61   PING 正常       K62    PING 异常    K63   资料 3-2控制输出信号 控制输入信号
资料 4以太网 关于 IP 地址、网关 IP 地址、子网掩码IP 地址虽然是用 4 字节来表示,但要通过第 1 字节的上位 1~3 位数,来判断要将 4 字节中的上位几个字节视为网络 ID。  第 1 字节位数设定     第 1 字节   第 2 字节     第 3 字节     第 4 字节   Hi Lo 0******* (A 级)  网络 ID主机 ID  主机 ID 主机 ID  Hi Lo 10****** (B 级)    网络 ID 网络 ID    主机 ID   主机 ID  Hi Lo 110***** (C 级)    网络 ID 网络 ID     网络 ID   主机 ID 发送目的地的网络 ID 与用自身节点 IP 地址指定的 IP 地址的网络 ID 不同时,将向在网关 IP 地址中设定 的地址的网关发送命令。(即使在这种情况下,目标 IP 也依然保持原先的状态,以太网地址将使用网 关的地址)例)          主机 1IP 地址 80. 00. 01. 01主机 2IP 地址 80. 00. 01. 02                 网关 1IP 地址 80. 00. 01. 03 (用通信参数进行设定)IP地址 80.11.01.01    网络 ID: 80. 11网络 ID: 80. 00         主机 3IP地址 80.11.01.02   从主机 1 发出向主机 3 的发送命令时,由于网络 ID 不同,所以 2ET 模块将向网关 1 进行发送。 可从网关 1 向主机 3 发送数据。资料 4-1(注:各 IP 地址用 16 进位来表记)
子网掩码在将主机 ID 的上位几个位数视为网络 ID 的一部分,并希望经由网关发送数据时进行设定。 在下图的例子中,将子网掩码作为 FF.FF.FF.00(255.255.255.0)时,从主机 1 来看,主机 3 可视为与自身的网络处于不同的网络上,并可通过网关 1 来发送数据。 例)         主机 2IP 地址 81. 00. 01. 02主机 3IP 地址 81. 00. 41. 03                      主机 1IP 地址 81. 00. 01. 01网关 1IP 地址 81. 00. 41. 01IP地址 81.11.01.02 (用通信参数进行设定)                  网络 ID: 81. 00子网掩码的位数数据的转换必须为一处。(例) 1111 1111 . 1111 1111 . 1111 1111 . 0000 0000 (FF.FF.FF.00)h例如,B 级的 IP 地址和该子网掩码进行组合时,IP 地址的各个位数将显示以下 3 个 ID 部分。   .   .   .  网络 ID 子网 ID 主机 ID各个 ID 部分的所有位数为 1 或 0 的 IP 地址将无法设定。例如,IP 地址为 81.00.FF.01(129.0.256.1),子网掩码为 FF.FF.FF.00(255.255.255.0)时,由于子 网的 ID 部分全部为 1,所以无法进行设定。子网掩码及网关 IP 地址设定为 00.00.00.00 时,可判定为无设定。在这种情况下,将仅由网络 ID 部分 与主机 ID 部分来构成。资料 4-2(注:各 IP 地址用 16 进位来表记)   
资料 5以太网 关于连接的重新开放将 2ET 模块与个人电脑相连接,并从个人电脑在连接开放后,通过个人电脑的电源 OFF 及重置等,不 做连接的关闭或重置处理,仅个人电脑侧进行重启时,以前的连接将仍以开放的状态保留在 2ET 模块侧, 因此,即使想要从个人电脑再次开放连接,在端口 No.与上次不同的情况下,无论重试多少次,连接都 不可能开放。为避免这种问题,2ET 模块中配备了以下这种功能,即当“对方不特定被动”中设定的连接开放后,对于 该连接来说,从相同的 IP 地址的节点,以不同的端口 No.,有连接开放请求过来时,会先行对当前的连 接进行重置,然后当再次有连接开放请求过来时,即可开放与该请求源的连接。           个人电脑(1) 从个人电脑开放连接 (2) 通信执行(3) 不进行连接的关闭、重置,而由个人电脑进行电源 OFF 或重启 2ET   以前的连接将仍以开放的状态保留在 2ET 模块侧 (4) 从个人电脑发出连接开放请求(5) 以太网将对当前连接进行重置(6) 从个人电脑再次发出连接开放请求时连接就会开放(:连接开放状态,:连接关闭状态)模块        连接错误 4014 发生*   连接错误 4014 解除*   根据该功能,即使无意间发生个人电脑侧的电源 OFF 及重置时,只要从个人电脑侧进行连接开放的重 试,即可再次开放连接。* (5)→(6)的数据间隔较短时,连接错误 4014 会立即解除错误,因此,有时会无法对确认异常的状况。资料 5-1
资料 6 从 Windows 个人电脑进行 PING 测试的方法PING 测试是对线路的连接及 IP 地址的设定等有无正确实施,是否处于可通信状态等进行的测试。 测试方法(1) 请点击 Windows 的[开始]按钮,并选择[所有程序]→[附件]→[命令提示符]。(2) 请在 C:¥WINDOWS> 的后面输入“ping”+ 2ET 模块的 IP 地址,并按下 Enter 键。 (例) 2ET 模块的 IP 地址为 192.168.1.1 时C:¥WINDOWS>ping 192.168.1.1(3) 如果测试结果 OK,则显示如下Reply from 192.168.1.1:byte 32 time = **ms 这样的内容。如果结果为 NG,则显示 Request time out.等的错误信息。在这种情况下,请确认布线是否正确、集线器等的电源有无接入、个人电脑的 IP 地址的网络 ID 与2ET 模块的 IP 地址的网络 ID 是否一致(参照资料 4)等。资料 6-1
资料 7不能在 2ET 模块更换过后,立即与个人电脑进行通信时的处置方法与个人电脑进行通信的 2ET 模块更换过后,有时会有短时间无法与个人电脑进行通信的情况。 这是因为以太网的通信除了 IP 地址和端口 No.之外,还使用了设备固有的值——以太网地址(也称为 MAC 地址),个人电脑将以太网地址和 IP 地址的对应表作为 ARP 映射表而进行保存。更换 2ET 模块 后,即使 IP 地址相同,由于硬件中保存的以太网地址发生了变化,所以在 ARP 映射表中尚残留着以前 的设定期间,通信就无法开始进行。ARP 映射表通常只要几分钟不进行通信就会自动被清除,之后即可正常开始通信,也可以通过以下操作 手动进行清除。(1) 请点击个人电脑的 Windows 的[开始]按钮,并选择[程序]→[MS-DOS 提示符]。(2) 请在 C:¥WINDOWS> 的后面输入“arp -d”+ 2ET 模块的 IP 地址,并按下 Enter 键。(例) 2ET 模块的 IP 地址为 192.168.1.1 时 C:¥WINDOWS>arp -d 192.168.1.1通过此项操作,即可恢复通信。ARP 映射表也可以通过个人电脑的电源 OFF 及重启进行清除。2ET 侧的 ARP 映射表用 2 分钟即可清除。资料 7-1
资料8 Ex编号用“8 位(16 进制)的字节地址”来表示整个数据区域。“8 位的字节地址”和“Ex 编号”有时会在“检索功能”及“闪存寄存器”中使用。 8 位的字节地址 = “00”+“Ex 编号(2 位)”+“间接字节地址”* 基本区域的指定请使用 Ex 编号“0D”~“0F”。 “00”为在自身区域内进行的指定。 在“01”中为【PC3JG/PC10 标准模式】的区域为止的指定。上位 2 位0001 02 03 04 05 06 07 08 09 0A 0B 0C 0D下位 4 位上位 2 位 下位 4 位 上位 2 位20 4021         4122         4223     4324     4425     4526         4627     4728     48下位 4 位上位 2 位6061 62 63 64 65 66 67 68 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 7B 7C 7D 7E 7F下位 4 位例:P1-D0000 ⇒ 000D2000 EB01234 ⇒ 00102468h EM0L ⇒ 00010C00h       自身区域      E*      G*      U 0000-FFFFU1 0000-FFFFU2 0000-FFFFU3 0000-FFFF                 FR00 0000-FFFFFR01 0000-FFFF FR02 0000-FFFF FR03 0000-FFFF FR04 0000-FFFF FR05 0000-FFFF FR06 0000-FFFF FR07 0000-FFFF FR08 0000-FFFF FR09 0000-FFFF FR10 0000-FFFF FR11 0000-FFFF FR12 0000-FFFF FR13 0000-FFFF FR14 0000-FFFF FR15 0000-FFFF FR16 0000-FFFF FR17 0000-FFFF FR18 0000-FFFF FR19 0000-FFFF FR20 0000-FFFF FR21 0000-FFFF FR22 0000-FFFF FR23 0000-FFFF FR24 0000-FFFF FR25 0000-FFFF FR26 0000-FFFF FR27 0000-FFFF FR28 0000-FFFF FR29 0000-FFFF FR30 0000-FFFF FR31 0000-FFFF                                                                                          FR32 0000-FFFFFR33 0000-FFFFFR34 0000-FFFFFR35 0000-FFFFFR36 0000-FFFFFR37 0000-FFFFFR38 0000-FFFFFR39 0000-FFFFFR40 0000-FFFFFR41 0000-FFFFFR42 0000-FFFFFR43 0000-FFFFFR44 0000-FFFFFR45 0000-FFFFFR46 0000-FFFFFR47 0000-FFFFFR48 0000-FFFFFR49 0000-FFFFFR50 0000-FFFFFR51 0000-FFFFFR52 0000-FFFFFR53 0000-FFFFFR54 0000-FFFFFR55 0000-FFFFFR56 0000-FFFFFR57 0000-FFFFFR58 0000-FFFFFR59 0000-FFFFFR60 0000-FFFFFR61 0000-FFFFFR62 0000-FFFFFR63 0000-FFFF                                                                                         U0000-U1FFFF29       49 2A     4A 2B         4B       系统用      P1 0000-FFFF    P2 0000-FFFF    P3 0000-FFFF    EB0 0000-FFFFEB1 0000-FFFFEB2 0000-FFFFEB3 0000-FFFFEB4 0000-FFFFEB5 0000-FFFFEB6 0000-FFFFEB7 0000-FFFF    2C       4C FR0000-FR1FFFFF4D 4E 4F 50 51 52 53 54 55 56 57    2D    0E     2E0F     2F10     30 11     31 12     32 13     33 14     34 15     35 16     36 17     37                         18 EB8 19 EB9 1A EB10 1B EB11 1C EB12 1D EB13 1E EB14 1F EB1538     5839     593A         5A      预约   3B3C     5C3D     5D3E     5E5B         3FEB0000-EB3FFFF5F 资料 8-1
 基本 区域 2P1 PC10 扩展P2PC3JG 互换*2P2 PC10 扩展P3 PC3JG 互换 *2P3 PC10 扩展0E参考).地址表 名称P1PC3JG边缘 保持继电器 特殊继电器 计时器/计数器 链接继电器 输入输出 内部继电器 特殊寄存器 当前值寄存器 链接寄存器 数据寄存器 1 数据寄存器 2 边缘 特殊继电器 计时器/计数器 内部继电器 链接继电器 特殊寄存器 当前值寄存器 边缘 保持继电器 特殊继电器 计时器/计数器 链接继电器 输入输出 内部继电器 特殊寄存器 当前值寄存器 链接寄存器 数据寄存器 1 数据寄存器 2 边缘 特殊继电器 计时器/计数器 内部继电器 链接继电器 特殊寄存器 当前值寄存器 边缘 保持继电器 特殊继电器 计时器/计数器 链接继电器 输入输出 内部继电器 特殊寄存器 当前值寄存器 链接寄存器 数据寄存器 1 数据寄存器 2 边缘 特殊继电器 计时器/计数器 内部继电器 链接继电器 特殊寄存器 当前值寄存器Ex No. (16 进制)0D地址P000 - P1FF K000 - K2FF V000 - V0FF TC000 - TC1FF L000 - L7FF XY000 - XY7FF M000 - M7FF S0000 - S03FF N0000 - N01FF R0000 - R07FF D0000 - D0FFF D1000 - D2FFF P1000 - P17FF V1000 - V17FF TC1000 - TC17FF M1000 - M17FF L1000 - L2FFF S1000 - S13FF N1000 - N17FF P000 - P1FF K000 - K2FF V000 - V0FF TC000 - TC1FF L000 - L7FF XY000 - XY7FF M000 - M7FF S0000 - S03FF N0000 - N01FF R0000 - R07FF D0000 - D0FFF D1000 - D2FFF P1000 - P17FF V1000 - V17FF TC1000 - TC17FF M1000 - M17FF L1000 - L2FFF S1000 - S13FF N1000 - N17FF P000 - P1FF K000 - K2FF V000 - V0FF TC000 - TC1FF L000 - L7FF XY000 - XY7FF M000 - M7FF S0000 - S03FF N0000 - N01FF R0000 - R07FF D0000 - D0FFF D1000 - D2FFF P1000 - P17FF V1000 - V17FF TC1000 - TC17FF M1000 - M17FF L1000 - L2FFF S1000 - S13FF N1000 - N17FF字节地址0000 - 003F 0040 - 009F 00A0 - 00BF 00C0 - 00FF 0100 - 01FF 0200 - 02FF 0300 - 03FF 0400 - 0BFF 0C00 - 0FFF 1000 - 1FFF 2000 - 3FFF 4000 - 7FFF C000 - C0FF C100 - C1FF C200 - C2FF C300 - C3FF C400 - C7FF C800 - CFFF D000 - DFFF 0000 - 003F 0040 - 009F 00A0 - 00BF 00C0 - 00FF 0100 - 01FF 0200 - 02FF 0300 - 03FF 0400 - 0BFF 0C00 - 0FFF 1000 - 1FFF 2000 - 3FFF 4000 - 7FFF C000 - C0FF C100 - C1FF C200 - C2FF C300 - C3FF C400 - C7FF C800 - CFFF D000 - DFFF 0000 - 003F 0040 - 009F 00A0 - 00BF 00C0 - 00FF 0100 - 01FF 0200 - 02FF 0300 - 03FF 0400 - 0BFF 0C00 - 0FFF 1000 - 1FFF 2000 - 3FFF 4000 - 7FFF C000 - C0FF C100 - C1FF C200 - C2FF C300 - C3FF C400 - C7FF C800 - CFFF D000 - DFFF互换*20F资料 8-2
            名称扩展边缘 扩展保持继电器 扩展特殊继电器 扩展计时器/计数器 扩展链接继电器 扩展输入输出 扩展内部继电器 扩展特殊寄存器 扩展当前值寄存器 扩展设定值寄存器 扩展输入输出扩展内部继电器 区域             扩展数据寄存器3扩展区域               扩展缓存寄存器4Ex No. (16 进制)0102 0310 11 12 1317地址EP000 - EPFFF EK000 - EKFFF EV000 - EVFFF ETC000 - ETC7FF EL0000 - EL1FFF EXY000 - EXY7FF EM0000 - EM1FFF ES0000 - ES07FF EN0000 - EN07FF H0000 - H07FF GXY0000 - GXYFFFFGM0000 - GMFFFF U00000 - U07FFFEB00000 - EB07FFF EB08000 - EB0FFFF EB10000 - EB17FFF EB18000 - EB1FFFF字节地址0000 - 01FF 0200 - 03FF 0400 - 05FF 0600 - 06FF 0700 - 0AFF 0B00 - 0BFF 0C00 - 0FFF 1000 - 1FFF 2000 - 2FFF 3000 - 3FFF C000 - DFFFE000 - FFFF 0000 - FFFF0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF                                 扩展 区域 1       PC3JG 互换                                             扩展 区域 2PC3JG 互换      PC3JG 互换          扩展         04  PC10 扩展                06U08000 - U0FFFFU10000 - U17FFF0000 - FFFF       050000 - FFFF       U18000 - U1FFFF0000 - FFFF                                PC3JG 互换             14   EB20000 - EB27FFF 0000 - FFFF   15   EB28000 - EB2FFFF 0000 - FFFF   16   EB30000 - EB37FFF 0000 - FFFF                      PC10 扩展                  EB38000 - EB3FFFF               0000 - FFFF                资料 8-3
 扩展区域 PC10 扩展5闪存寄存器名称Ex No. (16 进制)40 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F 50 51 52 53 54 55 56 57 58 59 5A 5B 5C 5D 5E 5F 60 61 62 63 64 65 66 67 68 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 7B 7C 7D 7E 7F地址FR000000 - FR007FFF FR008000 - FR00FFFF FR010000 - FR017FFF FR018000 - FR01FFFF FR020000 - FR027FFF FR028000 - FR02FFFF FR030000 - FR037FFF FR038000 - FR03FFFF FR040000 - FR047FFF FR048000 - FR04FFFF FR050000 - FR057FFF FR058000 - FR05FFFF FR060000 - FR067FFF FR068000 - FR06FFFF FR070000 - FR077FFF FR078000 - FR07FFFF FR080000 - FR087FFF FR088000 - FR08FFFF FR090000 - FR097FFF FR098000 - FR09FFFF FR0A0000 - FR0A7FFF FR0A8000 - FR0AFFFF FR0B0000 - FR0B7FFF FR0B8000 - FR0BFFFF FR0C0000 - FR0C7FFF FR0C8000 - FR0CFFFF FR0D0000 - FR0D7FFF FR0D8000 - FR0DFFFF FR0E0000 - FR0E7FFF FR0E8000 - FR0EFFFF FR0F0000 - FR0F7FFF FR0F8000 - FR0FFFFF FR100000 - FR107FFF FR108000 - FR10FFFF FR110000 - FR117FFF FR118000 - FR11FFFF FR120000 - FR127FFF FR128000 - FR12FFFF FR130000 - FR137FFF FR138000 - FR13FFFF FR140000 - FR147FFF FR148000 - FR14FFFF FR150000 - FR157FFF FR158000 - FR15FFFF FR160000 - FR167FFF FR168000 - FR16FFFF FR170000 - FR177FFF FR178000 - FR17FFFF FR180000 - FR187FFF FR188000 - FR18FFFF FR190000 - FR197FFF FR198000 - FR19FFFF FR1A0000 - FR1A7FFF FR1A8000 - FR1AFFFF FR1B0000 - FR1B7FFF FR1B8000 - FR1BFFFF FR1C0000 - FR1C7FFF FR1C8000 - FR1CFFFF FR1D0000 - FR1D7FFF FR1D8000 - FR1DFFFF FR1E0000 - FR1E7FFF FR1E8000 - FR1EFFFF FR1F0000 - FR1F7FFF FR1F8000 - FR1FFFFF字节地址0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF 0000 - FFFF资料 8-4
 ・ 本书的内容可能会由于产品改良而进行更改,恕不另行通知。・ 本书内容方面,我们一直希望能做到万无一失,但是万一您发现有可疑之处、错误之处以及遗漏之处,请与我们联系。 ・ 本书的内容之一部分或全部,不得转载。・初版・2016年 8月 ・4版・ 2016年 10月
●我们可以随时满足您的维护请求。请联系刈谷工厂呼叫中心TEL +81-566-21-8621 +81-566-25-8291 FAX +81-566-25-5469 设备工具和机电一体化部门刈谷工厂 〒448-8652 爱知县刈谷市朝日町 1-1© 株式会社捷太格特 2016.* 产品规格可能会由于改良而进行更改,恕不另行通知。使用说明书号码T-10014Ch       * 外汇及对外贸易管理法规定,相当于战略物资等(或作用)的产品出口至日本之外时,需要日本政府的 出口许可。